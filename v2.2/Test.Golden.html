<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containting the expected output of `run`</a>
<a id="1104" class="Comment">--</a>
<a id="1107" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1175" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1250" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1303" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1375" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1449" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1517" class="Comment">--</a>
<a id="1520" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1590" class="Comment">--</a>
<a id="1593" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1664" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1695" class="Comment">--</a>
<a id="1698" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1773" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1825" class="Comment">------------------------------------------------------------------------</a>
<a id="1898" class="Comment">-- Options</a>
<a id="1909" class="Comment">--</a>
<a id="1912" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1969" class="Comment">--</a>
<a id="1972" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2053" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2128" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2220" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2293" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2358" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2432" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2492" class="Comment">--</a>
<a id="2495" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2575" class="Comment">-- arguments and constructs this for you.</a>
<a id="2617" class="Comment">--</a>

<a id="2621" class="Comment">------------------------------------------------------------------------</a>
<a id="2694" class="Comment">-- Usage</a>
<a id="2703" class="Comment">--</a>
<a id="2706" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2763" class="Comment">--</a>
<a id="2766" class="Comment">--```sh</a>
<a id="2774" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2817" class="Comment">--   [--timing]</a>
<a id="2833" class="Comment">--   [--interactive]</a>
<a id="2854" class="Comment">--   [--only-file PATH]</a>
<a id="2878" class="Comment">--   [--failure-file PATH]</a>
<a id="2905" class="Comment">--   [--no-colour]</a>
<a id="2924" class="Comment">--   [--only [NAMES]]</a>
<a id="2946" class="Comment">--```</a>
<a id="2952" class="Comment">--</a>
<a id="2955" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3036" class="Symbol">{-#</a> <a id="3040" class="Keyword">OPTIONS</a> <a id="3048" class="Pragma">--cubical-compatible</a> <a id="3069" class="Pragma">--guardedness</a> <a id="3083" class="Symbol">#-}</a>

<a id="3088" class="Keyword">module</a> <a id="3095" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3107" class="Keyword">where</a>

<a id="3114" class="Keyword">open</a> <a id="3119" class="Keyword">import</a> <a id="3126" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3141" class="Keyword">using</a> <a id="3147" class="Symbol">(</a><a id="3148" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a><a id="3152" class="Symbol">;</a> <a id="3154" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="3158" class="Symbol">;</a> <a id="3160" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="3165" class="Symbol">;</a> <a id="3167" href="Data.Bool.Base.html#1505" class="Function Operator">if_then_else_</a><a id="3180" class="Symbol">)</a>
<a id="3182" class="Keyword">import</a> <a id="3189" href="Data.Char.html" class="Module">Data.Char</a> <a id="3199" class="Symbol">as</a> <a id="3202" class="Module">Char</a>
<a id="3207" class="Keyword">open</a> <a id="3212" class="Keyword">import</a> <a id="3219" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3228" class="Keyword">using</a> <a id="3234" class="Symbol">(</a><a id="3235" href="Data.Fin.html#700" class="Function Operator">#_</a><a id="3237" class="Symbol">)</a>
<a id="3239" class="Keyword">import</a> <a id="3246" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3264" class="Symbol">as</a> <a id="3267" class="Module">ℤ</a>
<a id="3269" class="Keyword">open</a> <a id="3274" class="Keyword">import</a> <a id="3281" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3296" class="Symbol">as</a> <a id="3299" class="Module">List</a> <a id="3304" class="Keyword">using</a> <a id="3310" class="Symbol">(</a><a id="3311" href="Agda.Builtin.List.html#147" class="Datatype">List</a><a id="3315" class="Symbol">;</a> <a id="3317" href="Data.List.Base.html#7599" class="InductiveConstructor">[]</a><a id="3319" class="Symbol">;</a> <a id="3321" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">_∷_</a><a id="3324" class="Symbol">;</a> <a id="3326" href="Data.List.Base.html#1734" class="Function Operator">_++_</a><a id="3330" class="Symbol">;</a> <a id="3332" href="Data.List.Base.html#10687" class="Function">filter</a><a id="3338" class="Symbol">;</a> <a id="3340" href="Data.List.Base.html#3696" class="Function">partitionSums</a><a id="3353" class="Symbol">)</a>
<a id="3355" class="Keyword">open</a> <a id="3360" class="Keyword">import</a> <a id="3367" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3424" class="Keyword">using</a> <a id="3430" class="Symbol">(</a><a id="3431" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6694" class="Function">infix?</a><a id="3437" class="Symbol">)</a>
<a id="3439" class="Keyword">open</a> <a id="3444" class="Keyword">import</a> <a id="3451" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3480" class="Keyword">using</a> <a id="3486" class="Symbol">(</a><a id="3487" href="Data.List.Relation.Unary.Any.html#2684" class="Function">any?</a><a id="3491" class="Symbol">)</a>
<a id="3493" class="Keyword">open</a> <a id="3498" class="Keyword">import</a> <a id="3505" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3521" class="Keyword">using</a> <a id="3527" class="Symbol">(</a><a id="3528" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a><a id="3533" class="Symbol">;</a> <a id="3535" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="3539" class="Symbol">;</a> <a id="3541" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="3548" class="Symbol">;</a> <a id="3550" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a><a id="3559" class="Symbol">)</a>
<a id="3561" class="Keyword">open</a> <a id="3566" class="Keyword">import</a> <a id="3573" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3587" class="Keyword">using</a> <a id="3593" class="Symbol">(</a><a id="3594" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="3595" class="Symbol">;</a> <a id="3597" href="Data.Nat.Base.html#1289" class="Primitive Operator">_≡ᵇ_</a><a id="3601" class="Symbol">;</a> <a id="3603" href="Data.Nat.Base.html#1463" class="Primitive Operator">_&lt;ᵇ_</a><a id="3607" class="Symbol">;</a> <a id="3609" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">_+_</a><a id="3612" class="Symbol">;</a> <a id="3614" href="Data.Nat.Base.html#4462" class="Primitive Operator">_∸_</a><a id="3617" class="Symbol">)</a>
<a id="3619" class="Keyword">import</a> <a id="3626" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3640" class="Symbol">as</a> <a id="3643" class="Module">ℕ</a> <a id="3645" class="Keyword">using</a> <a id="3651" class="Symbol">(</a><a id="3652" href="Data.Nat.Show.html#1962" class="Function">show</a><a id="3656" class="Symbol">)</a>
<a id="3658" class="Keyword">open</a> <a id="3663" class="Keyword">import</a> <a id="3670" href="Data.Product.Base.html" class="Module">Data.Product.Base</a> <a id="3688" class="Keyword">using</a> <a id="3694" class="Symbol">(</a><a id="3695" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="3698" class="Symbol">;</a> <a id="3700" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="3703" class="Symbol">)</a>
<a id="3705" class="Keyword">open</a> <a id="3710" class="Keyword">import</a> <a id="3717" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="3734" class="Symbol">as</a> <a id="3737" class="Module">String</a> <a id="3744" class="Keyword">using</a> <a id="3750" class="Symbol">(</a><a id="3751" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="3757" class="Symbol">;</a> <a id="3759" href="Data.String.Base.html#5230" class="Function">lines</a><a id="3764" class="Symbol">;</a> <a id="3766" href="Data.String.Base.html#2826" class="Function">unlines</a><a id="3773" class="Symbol">;</a> <a id="3775" href="Data.String.Base.html#2768" class="Function">unwords</a><a id="3782" class="Symbol">;</a> <a id="3784" href="Data.String.Base.html#2613" class="Function">concat</a><a id="3790" class="Symbol">)</a>
<a id="3792" class="Keyword">open</a> <a id="3797" class="Keyword">import</a> <a id="3804" href="Data.String.Properties.html" class="Module">Data.String.Properties</a> <a id="3827" class="Symbol">as</a> <a id="3830" class="Module">String</a> <a id="3837" class="Keyword">using</a> <a id="3843" class="Symbol">(</a><a id="3844" href="Data.String.Properties.html#2733" class="Function Operator">_≟_</a><a id="3847" class="Symbol">)</a>
<a id="3849" class="Keyword">open</a> <a id="3854" class="Keyword">import</a> <a id="3861" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3875" class="Keyword">using</a> <a id="3881" class="Symbol">(</a><a id="3882" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="3885" class="Symbol">;</a> <a id="3887" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="3891" class="Symbol">;</a> <a id="3893" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="3897" class="Symbol">)</a>
<a id="3899" class="Keyword">open</a> <a id="3904" class="Keyword">import</a> <a id="3911" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3926" class="Keyword">using</a> <a id="3932" class="Symbol">(</a><a id="3933" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a><a id="3934" class="Symbol">)</a>

<a id="3937" class="Keyword">open</a> <a id="3942" class="Keyword">import</a> <a id="3949" href="Function.Base.html" class="Module">Function.Base</a> <a id="3963" class="Keyword">using</a> <a id="3969" class="Symbol">(</a><a id="3970" href="Function.Base.html#704" class="Function">id</a><a id="3972" class="Symbol">;</a> <a id="3974" href="Function.Base.html#1974" class="Function Operator">_$_</a><a id="3977" class="Symbol">;</a> <a id="3979" href="Function.Base.html#4042" class="Function Operator">case_of_</a><a id="3987" class="Symbol">)</a>

<a id="3990" class="Keyword">open</a> <a id="3995" class="Keyword">import</a> <a id="4002" href="Relation.Nullary.Decidable.Core.html" class="Module">Relation.Nullary.Decidable.Core</a> <a id="4034" class="Keyword">using</a> <a id="4040" class="Symbol">(</a><a id="4041" href="Relation.Nullary.Decidable.Core.html#1927" class="Field">does</a><a id="4045" class="Symbol">)</a>

<a id="4048" class="Keyword">open</a> <a id="4053" class="Keyword">import</a> <a id="4060" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="4084" class="Keyword">using</a> <a id="4090" class="Symbol">(</a><a id="4091" href="Agda.Builtin.Coinduction.html#229" class="CoinductiveConstructor Operator">♯_</a><a id="4093" class="Symbol">)</a>
<a id="4095" class="Keyword">open</a> <a id="4100" class="Keyword">import</a> <a id="4107" href="IO.html" class="Module">IO</a>

<a id="4111" class="Keyword">open</a> <a id="4116" class="Keyword">import</a> <a id="4123" href="System.Clock.html" class="Module">System.Clock</a> <a id="4136" class="Symbol">as</a> <a id="4139" class="Module">Clock</a> <a id="4145" class="Keyword">using</a> <a id="4151" class="Symbol">(</a><a id="4152" href="System.Clock.html#2776" class="Function">time′</a><a id="4157" class="Symbol">;</a> <a id="4159" href="System.Clock.html#1931" class="Record">Time</a><a id="4163" class="Symbol">;</a> <a id="4165" href="System.Clock.html#1977" class="Field">seconds</a><a id="4172" class="Symbol">)</a>
<a id="4174" class="Keyword">open</a> <a id="4179" class="Keyword">import</a> <a id="4186" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4206" class="Keyword">open</a> <a id="4211" class="Keyword">import</a> <a id="4218" href="System.Directory.html" class="Module">System.Directory</a> <a id="4235" class="Keyword">using</a> <a id="4241" class="Symbol">(</a><a id="4242" href="System.Directory.html#3068" class="Function">doesFileExist</a><a id="4255" class="Symbol">;</a> <a id="4257" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a><a id="4275" class="Symbol">)</a>
<a id="4277" class="Keyword">open</a> <a id="4282" class="Keyword">import</a> <a id="4289" href="System.Environment.html" class="Module">System.Environment</a> <a id="4308" class="Keyword">using</a> <a id="4314" class="Symbol">(</a><a id="4315" href="System.Environment.html#660" class="Function">getArgs</a><a id="4322" class="Symbol">;</a> <a id="4324" href="System.Environment.html#777" class="Function">lookupEnv</a><a id="4333" class="Symbol">)</a>
<a id="4335" class="Keyword">open</a> <a id="4340" class="Keyword">import</a> <a id="4347" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4359" class="Keyword">open</a> <a id="4364" class="Keyword">import</a> <a id="4371" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4393" class="Keyword">using</a> <a id="4399" class="Symbol">(</a><a id="4400" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a><a id="4410" class="Symbol">)</a>
<a id="4412" class="Keyword">open</a> <a id="4417" class="Keyword">import</a> <a id="4424" href="System.Process.html" class="Module">System.Process</a> <a id="4439" class="Keyword">using</a> <a id="4445" class="Symbol">(</a><a id="4446" href="System.Process.html#655" class="Function">callCommand</a><a id="4457" class="Symbol">;</a> <a id="4459" href="System.Process.html#735" class="Function">system</a><a id="4465" class="Symbol">)</a>

<a id="4468" class="Keyword">record</a> <a id="Options"></a><a id="4475" href="Test.Golden.html#4475" class="Record">Options</a> <a id="4483" class="Symbol">:</a> <a id="4485" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4489" class="Keyword">where</a>
  <a id="4497" class="Keyword">field</a>
    <a id="4507" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4555" href="Test.Golden.html#4555" class="Field">exeUnderTest</a> <a id="4568" class="Symbol">:</a> <a id="4570" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4581" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4628" href="Test.Golden.html#4628" class="Field">onlyNames</a> <a id="4638" class="Symbol">:</a> <a id="4640" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4645" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4656" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4707" href="Test.Golden.html#4707" class="Field">interactive</a> <a id="4719" class="Symbol">:</a> <a id="4721" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="4730" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4775" href="Test.Golden.html#4775" class="Field">timing</a> <a id="4782" class="Symbol">:</a> <a id="4784" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="4793" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4853" href="Test.Golden.html#4853" class="Field">failureFile</a> <a id="4865" class="Symbol">:</a> <a id="4867" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4873" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4884" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="4945" href="Test.Golden.html#4945" class="Field">colour</a> <a id="4952" class="Symbol">:</a> <a id="4954" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="4959" class="Keyword">open</a> <a id="4964" href="Test.Golden.html#4475" class="Module">Options</a>

<a id="initOptions"></a><a id="4973" href="Test.Golden.html#4973" class="Function">initOptions</a> <a id="4985" class="Symbol">:</a> <a id="4987" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="4994" class="Symbol">→</a> <a id="4996" href="Test.Golden.html#4475" class="Record">Options</a>
<a id="5004" href="Test.Golden.html#4973" class="Function">initOptions</a> <a id="5016" href="Test.Golden.html#5016" class="Bound">exe</a> <a id="5020" class="Symbol">=</a> <a id="5022" class="Keyword">record</a>
  <a id="5031" class="Symbol">{</a> <a id="5033" href="Test.Golden.html#4555" class="Field">exeUnderTest</a> <a id="5046" class="Symbol">=</a> <a id="5048" href="Test.Golden.html#5016" class="Bound">exe</a>
  <a id="5054" class="Symbol">;</a> <a id="5056" href="Test.Golden.html#4628" class="Field">onlyNames</a>    <a id="5069" class="Symbol">=</a> <a id="5071" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
  <a id="5076" class="Symbol">;</a> <a id="5078" href="Test.Golden.html#4707" class="Field">interactive</a>  <a id="5091" class="Symbol">=</a> <a id="5093" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
  <a id="5101" class="Symbol">;</a> <a id="5103" href="Test.Golden.html#4775" class="Field">timing</a>       <a id="5116" class="Symbol">=</a> <a id="5118" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
  <a id="5126" class="Symbol">;</a> <a id="5128" href="Test.Golden.html#4853" class="Field">failureFile</a>  <a id="5141" class="Symbol">=</a> <a id="5143" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
  <a id="5153" class="Symbol">;</a> <a id="5155" href="Test.Golden.html#4945" class="Field">colour</a>       <a id="5168" class="Symbol">=</a> <a id="5170" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
  <a id="5177" class="Symbol">}</a>

<a id="usage"></a><a id="5180" href="Test.Golden.html#5180" class="Function">usage</a> <a id="5186" class="Symbol">:</a> <a id="5188" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5195" href="Test.Golden.html#5180" class="Function">usage</a> <a id="5201" class="Symbol">=</a> <a id="5203" href="Data.String.Base.html#2768" class="Function">unwords</a>
  <a id="5213" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="5215" class="String">&quot;Usage:&quot;</a>
  <a id="5226" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5228" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5248" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5250" class="String">&quot;[--timing]&quot;</a>
  <a id="5265" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5267" class="String">&quot;[--interactive]&quot;</a>
  <a id="5287" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5289" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5315" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5317" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5340" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5342" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5360" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5362" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5383" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5385" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

<a id="5389" class="Keyword">data</a> <a id="Error"></a><a id="5394" href="Test.Golden.html#5394" class="Datatype">Error</a> <a id="5400" class="Symbol">:</a> <a id="5402" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="5406" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5414" href="Test.Golden.html#5414" class="InductiveConstructor">MissingExecutable</a> <a id="5432" class="Symbol">:</a> <a id="5434" href="Test.Golden.html#5394" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5442" href="Test.Golden.html#5442" class="InductiveConstructor">InvalidArgument</a> <a id="5458" class="Symbol">:</a> <a id="5460" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5467" class="Symbol">→</a> <a id="5469" href="Test.Golden.html#5394" class="Datatype">Error</a>

<a id="show"></a><a id="5476" href="Test.Golden.html#5476" class="Function">show</a> <a id="5481" class="Symbol">:</a> <a id="5483" href="Test.Golden.html#5394" class="Datatype">Error</a> <a id="5489" class="Symbol">→</a> <a id="5491" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5498" href="Test.Golden.html#5476" class="Function">show</a> <a id="5503" href="Test.Golden.html#5414" class="InductiveConstructor">MissingExecutable</a> <a id="5521" class="Symbol">=</a> <a id="5523" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5562" href="Test.Golden.html#5476" class="Function">show</a> <a id="5567" class="Symbol">(</a><a id="5568" href="Test.Golden.html#5442" class="InductiveConstructor">InvalidArgument</a> <a id="5584" href="Test.Golden.html#5584" class="Bound">arg</a><a id="5587" class="Symbol">)</a> <a id="5589" class="Symbol">=</a> <a id="5591" class="String">&quot;Invalid argument: &quot;</a> <a id="5612" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="5622" href="Test.Golden.html#5584" class="Bound">arg</a>

<a id="5627" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5663" href="Test.Golden.html#5663" class="Function">options</a> <a id="5671" class="Symbol">:</a> <a id="5673" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5678" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5685" class="Symbol">→</a> <a id="5687" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="5690" class="Symbol">(</a><a id="5691" href="Test.Golden.html#5394" class="Datatype">Error</a> <a id="5697" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5699" href="Test.Golden.html#4475" class="Record">Options</a><a id="5706" class="Symbol">)</a>
<a id="5708" href="Test.Golden.html#5663" class="Function">options</a><a id="5715" class="Symbol">(</a><a id="5716" href="Test.Golden.html#5716" class="Bound">exe</a> <a id="5720" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5722" href="Test.Golden.html#5722" class="Bound">rest</a><a id="5726" class="Symbol">)</a> <a id="5728" class="Symbol">=</a> <a id="5730" href="Test.Golden.html#6531" class="Function">mkOptions</a> <a id="5740" href="Test.Golden.html#5716" class="Bound">exe</a> <a id="5744" href="Test.Golden.html#5722" class="Bound">rest</a> <a id="5749" class="Keyword">where</a>

  <a id="5758" href="Test.Golden.html#5758" class="Function">go</a> <a id="5761" class="Symbol">:</a> <a id="5763" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5768" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5775" class="Symbol">→</a> <a id="5777" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5783" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5790" class="Symbol">→</a> <a id="5792" href="Test.Golden.html#4475" class="Record">Options</a> <a id="5800" class="Symbol">→</a> <a id="5802" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5809" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5811" class="Symbol">(</a><a id="5812" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5818" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5825" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5827" href="Test.Golden.html#4475" class="Record">Options</a><a id="5834" class="Symbol">)</a>
  <a id="5838" href="Test.Golden.html#5758" class="Function">go</a> <a id="5841" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>                             <a id="5872" href="Test.Golden.html#5872" class="Bound">mfp</a> <a id="5876" href="Test.Golden.html#5876" class="Bound">opts</a> <a id="5881" class="Symbol">=</a> <a id="5883" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="5888" class="Symbol">(</a><a id="5889" href="Test.Golden.html#5872" class="Bound">mfp</a> <a id="5893" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5895" href="Test.Golden.html#5876" class="Bound">opts</a><a id="5899" class="Symbol">)</a>
  <a id="5903" href="Test.Golden.html#5758" class="Function">go</a> <a id="5906" class="Symbol">(</a><a id="5907" class="String">&quot;--timing&quot;</a>            <a id="5929" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5931" href="Test.Golden.html#5931" class="Bound">args</a><a id="5935" class="Symbol">)</a> <a id="5937" href="Test.Golden.html#5937" class="Bound">mfp</a> <a id="5941" href="Test.Golden.html#5941" class="Bound">opts</a> <a id="5946" class="Symbol">=</a>
    <a id="5952" href="Test.Golden.html#5758" class="Function">go</a> <a id="5955" href="Test.Golden.html#5931" class="Bound">args</a> <a id="5960" href="Test.Golden.html#5937" class="Bound">mfp</a> <a id="5964" class="Symbol">(</a><a id="5965" class="Keyword">record</a> <a id="5972" href="Test.Golden.html#5941" class="Bound">opts</a> <a id="5977" class="Symbol">{</a> <a id="5979" href="Test.Golden.html#4775" class="Field">timing</a> <a id="5986" class="Symbol">=</a> <a id="5988" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="5993" class="Symbol">})</a>
  <a id="5998" href="Test.Golden.html#5758" class="Function">go</a> <a id="6001" class="Symbol">(</a><a id="6002" class="String">&quot;--interactive&quot;</a>       <a id="6024" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6026" href="Test.Golden.html#6026" class="Bound">args</a><a id="6030" class="Symbol">)</a> <a id="6032" href="Test.Golden.html#6032" class="Bound">mfp</a> <a id="6036" href="Test.Golden.html#6036" class="Bound">opts</a> <a id="6041" class="Symbol">=</a>
    <a id="6047" href="Test.Golden.html#5758" class="Function">go</a> <a id="6050" href="Test.Golden.html#6026" class="Bound">args</a> <a id="6055" href="Test.Golden.html#6032" class="Bound">mfp</a> <a id="6059" class="Symbol">(</a><a id="6060" class="Keyword">record</a> <a id="6067" href="Test.Golden.html#6036" class="Bound">opts</a> <a id="6072" class="Symbol">{</a> <a id="6074" href="Test.Golden.html#4707" class="Field">interactive</a> <a id="6086" class="Symbol">=</a> <a id="6088" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="6093" class="Symbol">})</a>
  <a id="6098" href="Test.Golden.html#5758" class="Function">go</a> <a id="6101" class="Symbol">(</a><a id="6102" class="String">&quot;--failure-file&quot;</a> <a id="6119" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6121" href="Test.Golden.html#6121" class="Bound">fp</a> <a id="6124" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6126" href="Test.Golden.html#6126" class="Bound">args</a><a id="6130" class="Symbol">)</a> <a id="6132" href="Test.Golden.html#6132" class="Bound">mfp</a> <a id="6136" href="Test.Golden.html#6136" class="Bound">opts</a> <a id="6141" class="Symbol">=</a>
    <a id="6147" href="Test.Golden.html#5758" class="Function">go</a> <a id="6150" href="Test.Golden.html#6126" class="Bound">args</a> <a id="6155" href="Test.Golden.html#6132" class="Bound">mfp</a> <a id="6159" class="Symbol">(</a><a id="6160" class="Keyword">record</a> <a id="6167" href="Test.Golden.html#6136" class="Bound">opts</a> <a id="6172" class="Symbol">{</a> <a id="6174" href="Test.Golden.html#4853" class="Field">failureFile</a> <a id="6186" class="Symbol">=</a> <a id="6188" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6193" href="Test.Golden.html#6121" class="Bound">fp</a> <a id="6196" class="Symbol">})</a>
  <a id="6201" href="Test.Golden.html#5758" class="Function">go</a> <a id="6204" class="Symbol">(</a><a id="6205" class="String">&quot;--only&quot;</a>              <a id="6227" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6229" href="Test.Golden.html#6229" class="Bound">args</a><a id="6233" class="Symbol">)</a> <a id="6235" href="Test.Golden.html#6235" class="Bound">mfp</a> <a id="6239" href="Test.Golden.html#6239" class="Bound">opts</a> <a id="6244" class="Symbol">=</a>
    <a id="6250" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6255" class="Symbol">(</a><a id="6256" href="Test.Golden.html#6235" class="Bound">mfp</a> <a id="6260" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6262" class="Symbol">(</a><a id="6263" class="Keyword">record</a> <a id="6270" href="Test.Golden.html#6239" class="Bound">opts</a> <a id="6275" class="Symbol">{</a> <a id="6277" href="Test.Golden.html#4628" class="Field">onlyNames</a> <a id="6287" class="Symbol">=</a> <a id="6289" href="Test.Golden.html#6229" class="Bound">args</a> <a id="6294" class="Symbol">}))</a>
  <a id="6300" href="Test.Golden.html#5758" class="Function">go</a> <a id="6303" class="Symbol">(</a><a id="6304" class="String">&quot;--only-file&quot;</a> <a id="6318" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6320" href="Test.Golden.html#6320" class="Bound">fp</a>    <a id="6326" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6328" href="Test.Golden.html#6328" class="Bound">args</a><a id="6332" class="Symbol">)</a> <a id="6334" href="Test.Golden.html#6334" class="Bound">mfp</a> <a id="6338" href="Test.Golden.html#6338" class="Bound">opts</a> <a id="6343" class="Symbol">=</a>
    <a id="6349" href="Test.Golden.html#5758" class="Function">go</a> <a id="6352" href="Test.Golden.html#6328" class="Bound">args</a> <a id="6357" class="Symbol">(</a><a id="6358" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6363" href="Test.Golden.html#6320" class="Bound">fp</a><a id="6365" class="Symbol">)</a> <a id="6367" class="Symbol">(</a><a id="6368" class="Keyword">record</a> <a id="6375" href="Test.Golden.html#6338" class="Bound">opts</a> <a id="6380" class="Symbol">{</a> <a id="6382" href="Test.Golden.html#4628" class="Field">onlyNames</a> <a id="6392" class="Symbol">=</a> <a id="6394" href="Test.Golden.html#6328" class="Bound">args</a> <a id="6399" class="Symbol">})</a>
  <a id="6404" href="Test.Golden.html#5758" class="Function">go</a> <a id="6407" class="Symbol">(</a><a id="6408" class="String">&quot;--no-colour&quot;</a>         <a id="6430" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6432" href="Test.Golden.html#6432" class="Bound">args</a><a id="6436" class="Symbol">)</a> <a id="6438" href="Test.Golden.html#6438" class="Bound">mfp</a> <a id="6442" href="Test.Golden.html#6442" class="Bound">opts</a> <a id="6447" class="Symbol">=</a>
    <a id="6453" href="Test.Golden.html#5758" class="Function">go</a> <a id="6456" href="Test.Golden.html#6432" class="Bound">args</a> <a id="6461" href="Test.Golden.html#6438" class="Bound">mfp</a> <a id="6465" class="Symbol">(</a><a id="6466" class="Keyword">record</a> <a id="6473" href="Test.Golden.html#6442" class="Bound">opts</a> <a id="6478" class="Symbol">{</a> <a id="6480" href="Test.Golden.html#4945" class="Field">colour</a> <a id="6487" class="Symbol">=</a> <a id="6489" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6495" class="Symbol">})</a>
  <a id="6500" href="Test.Golden.html#5758" class="CatchallClause Function">go</a><a id="6502" class="CatchallClause"> </a><a id="6503" class="CatchallClause Symbol">(</a><a id="6504" href="Test.Golden.html#6504" class="CatchallClause Bound">arg</a><a id="6507" class="CatchallClause"> </a><a id="6508" href="Agda.Builtin.List.html#199" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6509" class="CatchallClause"> </a><a id="6510" class="CatchallClause Symbol">_)</a><a id="6512" class="CatchallClause"> </a><a id="6513" class="CatchallClause Symbol">_</a><a id="6514" class="CatchallClause"> </a><a id="6515" class="CatchallClause Symbol">_</a> <a id="6517" class="Symbol">=</a> <a id="6519" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6524" href="Test.Golden.html#6504" class="Bound">arg</a>

  <a id="6531" href="Test.Golden.html#6531" class="Function">mkOptions</a> <a id="6541" class="Symbol">:</a> <a id="6543" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="6550" class="Symbol">→</a> <a id="6552" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6557" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="6564" class="Symbol">→</a> <a id="6566" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="6569" class="Symbol">(</a><a id="6570" href="Test.Golden.html#5394" class="Datatype">Error</a> <a id="6576" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6578" href="Test.Golden.html#4475" class="Record">Options</a><a id="6585" class="Symbol">)</a>
  <a id="6589" href="Test.Golden.html#6531" class="Function">mkOptions</a> <a id="6599" href="Test.Golden.html#6599" class="Bound">exe</a> <a id="6603" href="Test.Golden.html#6603" class="Bound">rest</a> <a id="6608" class="Symbol">=</a> <a id="6610" class="Keyword">do</a>
    <a id="6617" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6622" class="Symbol">(</a><a id="6623" href="Test.Golden.html#6623" class="Bound">mfp</a> <a id="6627" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6629" href="Test.Golden.html#6629" class="Bound">opts</a><a id="6633" class="Symbol">)</a> <a id="6635" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="6637" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="6642" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6644" href="Test.Golden.html#5758" class="Function">go</a> <a id="6647" href="Test.Golden.html#6603" class="Bound">rest</a> <a id="6652" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="6660" class="Symbol">(</a><a id="6661" href="Test.Golden.html#4973" class="Function">initOptions</a> <a id="6673" href="Test.Golden.html#6599" class="Bound">exe</a><a id="6676" class="Symbol">)</a>
      <a id="6684" class="Keyword">where</a> <a id="6690" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6695" href="Test.Golden.html#6695" class="Bound">arg</a> <a id="6699" class="Symbol">→</a> <a id="6701" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="6706" class="Symbol">(</a><a id="6707" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6712" class="Symbol">(</a><a id="6713" href="Test.Golden.html#5442" class="InductiveConstructor">InvalidArgument</a> <a id="6729" href="Test.Golden.html#6695" class="Bound">arg</a><a id="6732" class="Symbol">))</a>
    <a id="6739" href="Test.Golden.html#6739" class="Bound">term</a> <a id="6744" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="6746" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a> <a id="6756" class="String">&quot;&quot;</a> <a id="6759" href="IO.Base.html#1994" class="Function Operator">&lt;$&gt;</a> <a id="6763" href="System.Environment.html#777" class="Function">lookupEnv</a> <a id="6773" class="String">&quot;TERM&quot;</a>
    <a id="6784" class="Keyword">let</a> <a id="6788" href="Test.Golden.html#6788" class="Bound">opts</a> <a id="6793" class="Symbol">=</a> <a id="6795" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="6798" href="Relation.Nullary.Decidable.Core.html#1927" class="Field">does</a> <a id="6803" class="Symbol">(</a><a id="6804" href="Test.Golden.html#6739" class="Bound">term</a> <a id="6809" href="Data.String.Properties.html#2733" class="Function Operator">≟</a> <a id="6811" class="String">&quot;DUMB&quot;</a><a id="6817" class="Symbol">)</a>
               <a id="6834" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="6839" class="Keyword">record</a> <a id="6846" href="Test.Golden.html#6629" class="Bound">opts</a> <a id="6851" class="Symbol">{</a> <a id="6853" href="Test.Golden.html#4945" class="Field">colour</a> <a id="6860" class="Symbol">=</a> <a id="6862" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6868" class="Symbol">}</a>
               <a id="6885" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="6890" href="Test.Golden.html#6629" class="Bound">opts</a>
    <a id="6899" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6904" href="Test.Golden.html#6904" class="Bound">fp</a> <a id="6907" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="6909" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="6914" href="Test.Golden.html#6623" class="Bound">mfp</a>
      <a id="6924" class="Keyword">where</a> <a id="6930" class="CatchallClause Symbol">_</a> <a id="6932" class="Symbol">→</a> <a id="6934" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="6939" class="Symbol">(</a><a id="6940" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6945" href="Test.Golden.html#6788" class="Bound">opts</a><a id="6949" class="Symbol">)</a>
    <a id="6955" href="Test.Golden.html#6955" class="Bound">only</a> <a id="6960" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="6962" href="IO.html#2922" class="Function">readFiniteFile</a> <a id="6977" href="Test.Golden.html#6904" class="Bound">fp</a>
    <a id="6984" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="6989" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6991" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6996" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="6998" class="Keyword">record</a> <a id="7005" href="Test.Golden.html#6788" class="Bound">opts</a> <a id="7010" class="Symbol">{</a> <a id="7012" href="Test.Golden.html#4628" class="Field">onlyNames</a> <a id="7022" class="Symbol">=</a> <a id="7024" href="Data.String.Base.html#5230" class="Function">lines</a> <a id="7030" href="Test.Golden.html#6955" class="Bound">only</a> <a id="7035" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="7038" href="Test.Golden.html#4628" class="Field">onlyNames</a> <a id="7048" href="Test.Golden.html#6788" class="Bound">opts</a> <a id="7053" class="Symbol">}</a>

<a id="7056" href="Test.Golden.html#5663" class="Function">options</a> <a id="7064" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="7067" class="Symbol">=</a> <a id="7069" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="7074" class="Symbol">(</a><a id="7075" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7080" href="Test.Golden.html#5414" class="InductiveConstructor">MissingExecutable</a><a id="7097" class="Symbol">)</a>


<a id="7101" class="Comment">-- The result of a test run</a>
<a id="7129" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7189" href="Test.Golden.html#7189" class="Function">Result</a> <a id="7196" class="Symbol">:</a> <a id="7198" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="7202" href="Test.Golden.html#7189" class="Function">Result</a> <a id="7209" class="Symbol">=</a> <a id="7211" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="7218" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="7220" href="Agda.Builtin.String.html#335" class="Postulate">String</a>

<a id="7228" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7288" href="Test.Golden.html#7288" class="Function">runTest</a> <a id="7296" class="Symbol">:</a> <a id="7298" href="Test.Golden.html#4475" class="Record">Options</a> <a id="7306" class="Symbol">→</a> <a id="7308" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="7315" class="Symbol">→</a> <a id="7317" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="7320" href="Test.Golden.html#7189" class="Function">Result</a>
<a id="7327" href="Test.Golden.html#7288" class="Function">runTest</a> <a id="7335" href="Test.Golden.html#7335" class="Bound">opts</a> <a id="7340" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="7349" class="Symbol">=</a> <a id="7351" class="Keyword">do</a>

  <a id="7357" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="7362" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="7364" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a> <a id="7383" class="Symbol">(</a><a id="7384" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a> <a id="7395" href="Test.Golden.html#7340" class="Bound">testPath</a><a id="7403" class="Symbol">)</a>
    <a id="7409" class="Keyword">where</a> <a id="7415" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="7421" class="Symbol">→</a> <a id="7423" href="Test.Golden.html#8968" class="Function">fail</a> <a id="7428" href="Test.Golden.html#8589" class="Function">directoryNotFound</a>

  <a id="7449" href="Test.Golden.html#7449" class="Bound">time</a> <a id="7454" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="7456" href="System.Clock.html#2776" class="Function">time′</a> <a id="7462" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7464" href="System.Process.html#655" class="Function">callCommand</a> <a id="7476" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7478" href="Data.String.Base.html#2768" class="Function">unwords</a>
           <a id="7497" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="7499" class="String">&quot;cd&quot;</a> <a id="7504" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7506" href="Test.Golden.html#7340" class="Bound">testPath</a>
           <a id="7526" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7528" class="String">&quot;&amp;&amp;&quot;</a> <a id="7533" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7535" class="String">&quot;sh ./run&quot;</a> <a id="7546" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7548" href="Test.Golden.html#7335" class="Bound">opts</a> <a id="7553" class="Symbol">.</a><a id="7554" href="Test.Golden.html#4555" class="Field">exeUnderTest</a>
           <a id="7578" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7580" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7616" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7618" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="7624" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7629" href="Test.Golden.html#7629" class="Bound">out</a> <a id="7633" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="7635" href="Test.Golden.html#9069" class="Function">readLocalFile</a> <a id="7649" class="String">&quot;output&quot;</a>
    <a id="7662" class="Keyword">where</a> <a id="7668" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7676" class="Symbol">→</a> <a id="7678" href="Test.Golden.html#8968" class="Function">fail</a> <a id="7683" class="Symbol">(</a><a id="7684" href="Test.Golden.html#8768" class="Function">fileNotFound</a> <a id="7697" class="String">&quot;output&quot;</a><a id="7705" class="Symbol">)</a>
  <a id="7709" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7714" href="Test.Golden.html#7714" class="Bound">exp</a> <a id="7718" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="7720" href="Test.Golden.html#9069" class="Function">readLocalFile</a> <a id="7734" class="String">&quot;expected&quot;</a>
    <a id="7749" class="Keyword">where</a> <a id="7755" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7763" class="Symbol">→</a> <a id="7765" class="Keyword">do</a> <a id="7768" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="7771" href="Test.Golden.html#7335" class="Bound">opts</a> <a id="7776" class="Symbol">.</a><a id="7777" href="Test.Golden.html#4707" class="Field">interactive</a>
                         <a id="7814" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="7819" href="Test.Golden.html#9836" class="Function">mayOverwrite</a> <a id="7832" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7840" href="Test.Golden.html#7629" class="Bound">out</a>
                         <a id="7869" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="7874" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="7883" class="Symbol">(</a><a id="7884" href="Test.Golden.html#8768" class="Function">fileNotFound</a> <a id="7897" class="String">&quot;expected&quot;</a><a id="7907" class="Symbol">)</a>
                       <a id="7932" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="7937" class="Symbol">(</a><a id="7938" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7943" href="Test.Golden.html#7340" class="Bound">testPath</a><a id="7951" class="Symbol">)</a>

  <a id="7956" class="Keyword">let</a> <a id="7960" href="Test.Golden.html#7960" class="Bound">result</a> <a id="7967" class="Symbol">=</a> <a id="7969" href="Relation.Nullary.Decidable.Core.html#1927" class="Field">does</a> <a id="7974" class="Symbol">(</a><a id="7975" href="Test.Golden.html#7629" class="Bound">out</a> <a id="7979" href="Data.String.Properties.html#2733" class="Function Operator">String.≟</a> <a id="7988" href="Test.Golden.html#7714" class="Bound">exp</a><a id="7991" class="Symbol">)</a>

  <a id="7996" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="7999" href="Test.Golden.html#7960" class="Bound">result</a>
    <a id="8010" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8015" href="Test.Golden.html#10652" class="Function">printTiming</a> <a id="8027" class="Symbol">(</a><a id="8028" href="Test.Golden.html#7335" class="Bound">opts</a> <a id="8033" class="Symbol">.</a><a id="8034" href="Test.Golden.html#4775" class="Field">timing</a><a id="8040" class="Symbol">)</a> <a id="8042" href="Test.Golden.html#7449" class="Bound">time</a>
           <a id="8058" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8060" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="8063" href="Test.Golden.html#7335" class="Bound">opts</a> <a id="8068" class="Symbol">.</a><a id="8069" href="Test.Golden.html#4945" class="Field">colour</a>
               <a id="8091" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8096" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8108" class="Symbol">(</a><a id="8109" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8119" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8130" href="System.Console.ANSI.html#699" class="InductiveConstructor">classic</a> <a id="8138" href="System.Console.ANSI.html#623" class="InductiveConstructor">green</a><a id="8143" class="Symbol">)</a>
               <a id="8160" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8165" href="Function.Base.html#704" class="Function">id</a>
           <a id="8179" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8181" class="String">&quot;success&quot;</a>
    <a id="8195" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8200" class="Keyword">do</a> <a id="8203" href="Test.Golden.html#10652" class="Function">printTiming</a> <a id="8215" class="Symbol">(</a><a id="8216" href="Test.Golden.html#7335" class="Bound">opts</a> <a id="8221" class="Symbol">.</a><a id="8222" href="Test.Golden.html#4775" class="Field">timing</a><a id="8228" class="Symbol">)</a> <a id="8230" href="Test.Golden.html#7449" class="Bound">time</a>
             <a id="8248" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8250" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="8253" href="Test.Golden.html#7335" class="Bound">opts</a> <a id="8258" class="Symbol">.</a><a id="8259" href="Test.Golden.html#4945" class="Field">colour</a>
               <a id="8281" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8286" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8298" class="Symbol">(</a><a id="8299" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8309" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8320" href="System.Console.ANSI.html#707" class="InductiveConstructor">bright</a> <a id="8327" href="System.Console.ANSI.html#619" class="InductiveConstructor">red</a><a id="8330" class="Symbol">)</a>
               <a id="8347" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8352" href="Function.Base.html#704" class="Function">id</a>
             <a id="8368" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8370" class="String">&quot;FAILURE&quot;</a>
            <a id="8392" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="8395" href="Test.Golden.html#7335" class="Bound">opts</a> <a id="8400" class="Symbol">.</a><a id="8401" href="Test.Golden.html#4707" class="Field">interactive</a>
              <a id="8427" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8432" href="Test.Golden.html#9836" class="Function">mayOverwrite</a> <a id="8445" class="Symbol">(</a><a id="8446" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8451" href="Test.Golden.html#7714" class="Bound">exp</a><a id="8454" class="Symbol">)</a> <a id="8456" href="Test.Golden.html#7629" class="Bound">out</a>
              <a id="8474" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8479" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="8488" class="Symbol">(</a><a id="8489" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="8497" class="Symbol">(</a><a id="8498" href="Test.Golden.html#9602" class="Function">expVsOut</a> <a id="8507" href="Test.Golden.html#7714" class="Bound">exp</a> <a id="8511" href="Test.Golden.html#7629" class="Bound">out</a><a id="8514" class="Symbol">))</a>

  <a id="8520" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="8525" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8527" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="8530" href="Test.Golden.html#7960" class="Bound">result</a> <a id="8537" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="8542" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8547" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="8556" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="8561" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8566" href="Test.Golden.html#7340" class="Bound">testPath</a>

  <a id="8578" class="Keyword">where</a>

    <a id="8589" href="Test.Golden.html#8589" class="Function">directoryNotFound</a> <a id="8607" class="Symbol">:</a> <a id="8609" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8620" href="Test.Golden.html#8589" class="Function">directoryNotFound</a> <a id="8638" class="Symbol">=</a> <a id="8640" href="Data.String.Base.html#2768" class="Function">unwords</a>
                      <a id="8670" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8672" class="String">&quot;Directory&quot;</a>
                      <a id="8706" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8708" href="Test.Golden.html#7340" class="Bound">testPath</a>
                      <a id="8739" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8741" class="String">&quot;does not exist&quot;</a> <a id="8758" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8760" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="8768" href="Test.Golden.html#8768" class="Function">fileNotFound</a> <a id="8781" class="Symbol">:</a> <a id="8783" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="8790" class="Symbol">→</a> <a id="8792" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8803" href="Test.Golden.html#8768" class="Function">fileNotFound</a> <a id="8816" href="Test.Golden.html#8816" class="Bound">name</a> <a id="8821" class="Symbol">=</a> <a id="8823" href="Data.String.Base.html#2768" class="Function">unwords</a>
                      <a id="8853" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="8855" class="String">&quot;File&quot;</a>
                      <a id="8884" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8886" class="Symbol">(</a><a id="8887" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="8896" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="8906" class="String">&quot;/output&quot;</a><a id="8915" class="Symbol">)</a>
                      <a id="8939" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8941" class="String">&quot;does not exist&quot;</a> <a id="8958" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8960" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="8968" href="Test.Golden.html#8968" class="Function">fail</a> <a id="8973" class="Symbol">:</a> <a id="8975" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="8982" class="Symbol">→</a> <a id="8984" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="8987" href="Test.Golden.html#7189" class="Function">Result</a>
    <a id="8998" href="Test.Golden.html#8968" class="Function">fail</a> <a id="9003" href="Test.Golden.html#9003" class="Bound">msg</a> <a id="9007" class="Symbol">=</a> <a id="9009" class="Keyword">do</a> <a id="9012" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="9021" href="Test.Golden.html#9003" class="Bound">msg</a>
                  <a id="9043" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="9048" class="Symbol">(</a><a id="9049" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="9054" href="Test.Golden.html#7340" class="Bound">testPath</a><a id="9062" class="Symbol">)</a>

    <a id="9069" href="Test.Golden.html#9069" class="Function">readLocalFile</a> <a id="9083" class="Symbol">:</a> <a id="9085" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9092" class="Symbol">→</a> <a id="9094" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="9097" class="Symbol">(</a><a id="9098" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9104" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="9110" class="Symbol">)</a>
    <a id="9116" href="Test.Golden.html#9069" class="Function">readLocalFile</a> <a id="9130" href="Test.Golden.html#9130" class="Bound">name</a> <a id="9135" class="Symbol">=</a> <a id="9137" class="Keyword">do</a>
      <a id="9146" class="Keyword">let</a> <a id="9150" href="Test.Golden.html#9150" class="Bound">fp</a> <a id="9153" class="Symbol">=</a> <a id="9155" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="9162" class="Symbol">(</a><a id="9163" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="9172" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9174" class="String">&quot;/&quot;</a> <a id="9178" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9180" href="Test.Golden.html#9130" class="Bound">name</a> <a id="9185" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9187" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="9189" class="Symbol">)</a>
      <a id="9197" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="9202" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="9204" href="System.Directory.html#3068" class="Function">doesFileExist</a> <a id="9218" class="Symbol">(</a><a id="9219" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a> <a id="9230" href="Test.Golden.html#9150" class="Bound">fp</a><a id="9232" class="Symbol">)</a>
        <a id="9242" class="Keyword">where</a> <a id="9248" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9254" class="Symbol">→</a> <a id="9256" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="9261" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
      <a id="9275" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9280" href="IO.Base.html#1994" class="Function Operator">&lt;$&gt;</a> <a id="9284" href="IO.html#2922" class="Function">readFiniteFile</a> <a id="9299" href="Test.Golden.html#9150" class="Bound">fp</a>

    <a id="9307" href="Test.Golden.html#9307" class="Function">getAnswer</a> <a id="9317" class="Symbol">:</a> <a id="9319" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="9322" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="9331" href="Test.Golden.html#9307" class="Function">getAnswer</a> <a id="9341" class="Symbol">=</a> <a id="9343" href="IO.Base.html#4271" class="Function">untilJust</a> <a id="9353" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9355" class="Keyword">do</a>
      <a id="9364" href="Test.Golden.html#9364" class="Bound">str</a> <a id="9368" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="9370" href="IO.Finite.html#1050" class="Function">getLine</a>
      <a id="9384" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="9389" href="Test.Golden.html#9364" class="Bound">str</a> <a id="9393" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="9396" class="Symbol">λ</a> <a id="9398" class="Keyword">where</a>
        <a id="9412" class="String">&quot;y&quot;</a> <a id="9416" class="Symbol">→</a> <a id="9418" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="9423" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9425" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9430" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
        <a id="9443" class="String">&quot;n&quot;</a> <a id="9447" class="Symbol">→</a> <a id="9449" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="9454" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9456" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9461" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
        <a id="9475" class="String">&quot;&quot;</a>  <a id="9479" class="Symbol">→</a> <a id="9481" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="9486" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9488" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9493" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9499" class="Comment">-- default answer is no</a>
        <a id="9531" class="Symbol">_</a>   <a id="9535" class="Symbol">→</a> <a id="9537" class="Keyword">do</a> <a id="9540" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="9549" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9584" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="9589" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

    <a id="9602" href="Test.Golden.html#9602" class="Function">expVsOut</a> <a id="9611" class="Symbol">:</a> <a id="9613" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9620" class="Symbol">→</a> <a id="9622" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9629" class="Symbol">→</a> <a id="9631" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9636" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="9647" href="Test.Golden.html#9602" class="Function">expVsOut</a> <a id="9656" href="Test.Golden.html#9656" class="Bound">exp</a> <a id="9660" href="Test.Golden.html#9660" class="Bound">out</a> <a id="9664" class="Symbol">=</a> <a id="9666" class="String">&quot;Expected:&quot;</a> <a id="9678" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9680" href="Test.Golden.html#9656" class="Bound">exp</a> <a id="9684" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9686" class="String">&quot;Given:&quot;</a> <a id="9695" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9697" href="Test.Golden.html#9660" class="Bound">out</a> <a id="9701" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9703" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="9711" href="Test.Golden.html#9711" class="Function">hasFailed</a> <a id="9721" class="Symbol">:</a> <a id="9723" href="System.Exit.Primitive.html#402" class="Datatype">ExitCode</a> <a id="9732" class="Symbol">→</a> <a id="9734" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="9743" href="Test.Golden.html#9711" class="Function">hasFailed</a> <a id="9753" href="System.Exit.Primitive.html#425" class="InductiveConstructor">ExitSuccess</a>        <a id="9772" class="Symbol">=</a> <a id="9774" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
    <a id="9784" href="Test.Golden.html#9711" class="Function">hasFailed</a> <a id="9794" class="Symbol">(</a><a id="9795" href="System.Exit.Primitive.html#450" class="InductiveConstructor">ExitFailure</a> <a id="9807" href="Test.Golden.html#9807" class="Bound">code</a><a id="9811" class="Symbol">)</a> <a id="9813" class="Symbol">=</a> <a id="9815" href="Test.Golden.html#9807" class="Bound">code</a> <a id="9820" href="Data.Integer.Base.html#2628" class="Function Operator">ℤ.≤ᵇ</a> <a id="9825" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="9829" class="Number">0</a>

    <a id="9836" href="Test.Golden.html#9836" class="Function">mayOverwrite</a> <a id="9849" class="Symbol">:</a> <a id="9851" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9857" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9864" class="Symbol">→</a> <a id="9866" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9873" class="Symbol">→</a> <a id="9875" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="9878" class="Symbol">_</a>
    <a id="9884" href="Test.Golden.html#9836" class="Function">mayOverwrite</a> <a id="9897" href="Test.Golden.html#9897" class="Bound">mexp</a> <a id="9902" href="Test.Golden.html#9902" class="Bound">out</a> <a id="9906" class="Symbol">=</a> <a id="9908" class="Keyword">do</a>
      <a id="9917" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="9922" href="Test.Golden.html#9897" class="Bound">mexp</a> <a id="9927" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="9930" class="Symbol">λ</a> <a id="9932" class="Keyword">where</a>
        <a id="9946" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9954" class="Symbol">→</a> <a id="9956" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="9965" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9967" href="Data.String.Base.html#2826" class="Function">unlines</a>
          <a id="9985" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="9987" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="10054" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10056" href="Test.Golden.html#9902" class="Bound">out</a>
          <a id="10070" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10072" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10115" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10117" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
        <a id="10128" class="Symbol">(</a><a id="10129" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="10134" href="Test.Golden.html#10134" class="Bound">exp</a><a id="10137" class="Symbol">)</a> <a id="10139" class="Symbol">→</a> <a id="10141" class="Keyword">do</a>
          <a id="10154" href="Test.Golden.html#10154" class="Bound">code</a> <a id="10159" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="10161" href="System.Process.html#735" class="Function">system</a> <a id="10168" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10170" href="Data.String.Base.html#2613" class="Function">concat</a>
            <a id="10189" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10191" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10256" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10258" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="10267" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10269" class="String">&quot;/expected &quot;</a>
            <a id="10294" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10296" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="10305" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10307" class="String">&quot;/output&quot;</a>
            <a id="10329" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10331" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
          <a id="10344" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="10353" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10355" href="Data.String.Base.html#2826" class="Function">unlines</a>
            <a id="10375" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10377" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10431" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10433" class="Symbol">(</a><a id="10434" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="10437" href="Test.Golden.html#9711" class="Function">hasFailed</a> <a id="10447" href="Test.Golden.html#10154" class="Bound">code</a> <a id="10452" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="10457" href="Test.Golden.html#9602" class="Function">expVsOut</a> <a id="10466" href="Test.Golden.html#10134" class="Bound">exp</a> <a id="10470" href="Test.Golden.html#9902" class="Bound">out</a> <a id="10474" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="10479" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10481" class="Symbol">)</a>
            <a id="10495" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="10498" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10559" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10561" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="10571" href="Test.Golden.html#10571" class="Bound">b</a> <a id="10573" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="10575" href="Test.Golden.html#9307" class="Function">getAnswer</a>
      <a id="10591" href="IO.Base.html#3476" class="Function">when</a> <a id="10596" href="Test.Golden.html#10571" class="Bound">b</a> <a id="10598" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10600" href="IO.Finite.html#1281" class="Function">writeFile</a> <a id="10610" class="Symbol">(</a><a id="10611" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="10620" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="10630" class="String">&quot;/expected&quot;</a><a id="10641" class="Symbol">)</a> <a id="10643" href="Test.Golden.html#9902" class="Bound">out</a>

    <a id="10652" href="Test.Golden.html#10652" class="Function">printTiming</a> <a id="10664" class="Symbol">:</a> <a id="10666" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="10671" class="Symbol">→</a> <a id="10673" href="System.Clock.html#1931" class="Record">Time</a> <a id="10678" class="Symbol">→</a> <a id="10680" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="10687" class="Symbol">→</a> <a id="10689" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="10692" class="Symbol">_</a>
    <a id="10698" href="Test.Golden.html#10652" class="Function">printTiming</a> <a id="10710" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="10716" class="Symbol">_</a>    <a id="10721" href="Test.Golden.html#10721" class="Bound">msg</a> <a id="10725" class="Symbol">=</a> <a id="10727" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="10736" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="10738" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="10745" class="Symbol">(</a><a id="10746" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="10755" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10757" class="String">&quot;: &quot;</a> <a id="10762" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10764" href="Test.Golden.html#10721" class="Bound">msg</a> <a id="10768" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10770" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10772" class="Symbol">)</a>
    <a id="10778" href="Test.Golden.html#10652" class="Function">printTiming</a> <a id="10790" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>  <a id="10796" href="Test.Golden.html#10796" class="Bound">time</a> <a id="10801" href="Test.Golden.html#10801" class="Bound">msg</a> <a id="10805" class="Symbol">=</a>
      <a id="10813" class="Keyword">let</a> <a id="10817" href="Test.Golden.html#10817" class="Bound">time</a>  <a id="10823" class="Symbol">=</a> <a id="10825" href="Data.Nat.Show.html#1962" class="Function">ℕ.show</a> <a id="10832" class="Symbol">(</a><a id="10833" href="Test.Golden.html#10796" class="Bound">time</a> <a id="10838" class="Symbol">.</a><a id="10839" href="System.Clock.html#1977" class="Field">seconds</a><a id="10846" class="Symbol">)</a> <a id="10848" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="10858" class="String">&quot;s&quot;</a>
          <a id="10872" href="Test.Golden.html#10872" class="Bound">spent</a> <a id="10878" class="Symbol">=</a> <a id="10880" class="Number">9</a> <a id="10882" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="10884" href="Data.List.Base.html#4964" class="Function">List.sum</a> <a id="10893" class="Symbol">(</a><a id="10894" href="Data.List.Base.html#1634" class="Function">List.map</a> <a id="10903" href="Data.String.Base.html#2489" class="Function">String.length</a> <a id="10917" class="Symbol">(</a><a id="10918" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="10927" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10929" href="Test.Golden.html#10817" class="Bound">time</a> <a id="10934" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10936" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10938" class="Symbol">))</a>
               <a id="10956" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="11032" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11115" href="Test.Golden.html#11115" class="Bound">pad</a>   <a id="11121" class="Symbol">=</a> <a id="11123" href="Data.String.Base.html#2540" class="Function">String.replicate</a> <a id="11140" class="Symbol">(</a><a id="11141" class="Number">72</a> <a id="11144" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="11146" href="Test.Golden.html#10872" class="Bound">spent</a><a id="11151" class="Symbol">)</a> <a id="11153" class="String">&#39; &#39;</a>
      <a id="11163" class="Keyword">in</a> <a id="11166" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="11175" class="Symbol">(</a><a id="11176" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="11183" class="Symbol">(</a><a id="11184" href="Test.Golden.html#7340" class="Bound">testPath</a> <a id="11193" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11195" class="String">&quot;: &quot;</a> <a id="11200" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11202" href="Test.Golden.html#10801" class="Bound">msg</a> <a id="11206" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11208" href="Test.Golden.html#11115" class="Bound">pad</a> <a id="11212" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11214" href="Test.Golden.html#10817" class="Bound">time</a> <a id="11219" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11221" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="11223" class="Symbol">))</a>

<a id="11227" class="Comment">-- A test pool is characterised by</a>
<a id="11262" class="Comment">--  + a name</a>
<a id="11275" class="Comment">--  + and a list of directory paths</a>
<a id="11311" class="Keyword">record</a> <a id="TestPool"></a><a id="11318" href="Test.Golden.html#11318" class="Record">TestPool</a> <a id="11327" class="Symbol">:</a> <a id="11329" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="11333" class="Keyword">where</a>
  <a id="11341" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11353" href="Test.Golden.html#11353" class="InductiveConstructor">mkTestPool</a>
  <a id="11366" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11376" href="Test.Golden.html#11376" class="Field">poolName</a> <a id="11385" class="Symbol">:</a> <a id="11387" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11398" href="Test.Golden.html#11398" class="Field">testCases</a> <a id="11408" class="Symbol">:</a> <a id="11410" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11415" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="11422" class="Keyword">open</a> <a id="11427" href="Test.Golden.html#11318" class="Module">TestPool</a>

<a id="11437" class="Keyword">module</a> <a id="Summary"></a><a id="11444" href="Test.Golden.html#11444" class="Module">Summary</a> <a id="11452" class="Keyword">where</a>

  <a id="11461" class="Comment">-- The summary of a test pool run</a>
  <a id="11497" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11504" href="Test.Golden.html#11504" class="Record">Summary</a> <a id="11512" class="Symbol">:</a> <a id="11514" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="11518" class="Keyword">where</a>
    <a id="11528" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11540" href="Test.Golden.html#11540" class="InductiveConstructor">mkSummary</a>
    <a id="11554" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11566" href="Test.Golden.html#11566" class="Field">success</a> <a id="11574" class="Symbol">:</a> <a id="11576" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11581" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11594" href="Test.Golden.html#11594" class="Field">failure</a> <a id="11602" class="Symbol">:</a> <a id="11604" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11609" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="11618" class="Keyword">open</a> <a id="11623" href="Test.Golden.html#11504" class="Module">Summary</a> <a id="11631" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11641" href="Test.Golden.html#11641" class="Function">init</a> <a id="11646" class="Symbol">:</a> <a id="11648" href="Test.Golden.html#11504" class="Record">Summary</a>
  <a id="11658" href="Test.Golden.html#11641" class="Function">init</a> <a id="11663" class="Symbol">=</a> <a id="11665" href="Test.Golden.html#11540" class="InductiveConstructor">mkSummary</a> <a id="11675" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="11678" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11684" href="Test.Golden.html#11684" class="Function">merge</a> <a id="11690" class="Symbol">:</a> <a id="11692" href="Test.Golden.html#11504" class="Record">Summary</a> <a id="11700" class="Symbol">→</a> <a id="11702" href="Test.Golden.html#11504" class="Record">Summary</a> <a id="11710" class="Symbol">→</a> <a id="11712" href="Test.Golden.html#11504" class="Record">Summary</a>
  <a id="11722" href="Test.Golden.html#11684" class="Function">merge</a> <a id="11728" class="Symbol">(</a><a id="11729" href="Test.Golden.html#11540" class="InductiveConstructor">mkSummary</a> <a id="11739" href="Test.Golden.html#11739" class="Bound">ws1</a> <a id="11743" href="Test.Golden.html#11743" class="Bound">ls1</a><a id="11746" class="Symbol">)</a> <a id="11748" class="Symbol">(</a><a id="11749" href="Test.Golden.html#11540" class="InductiveConstructor">mkSummary</a> <a id="11759" href="Test.Golden.html#11759" class="Bound">ws2</a> <a id="11763" href="Test.Golden.html#11763" class="Bound">ls2</a><a id="11766" class="Symbol">)</a> <a id="11768" class="Symbol">=</a>
   <a id="11773" href="Test.Golden.html#11540" class="InductiveConstructor">mkSummary</a> <a id="11783" class="Symbol">(</a><a id="11784" href="Test.Golden.html#11759" class="Bound">ws2</a> <a id="11788" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="11791" href="Test.Golden.html#11739" class="Bound">ws1</a><a id="11794" class="Symbol">)</a> <a id="11796" class="Symbol">(</a><a id="11797" href="Test.Golden.html#11763" class="Bound">ls2</a> <a id="11801" href="Data.List.Base.html#1734" class="Function Operator">++</a> <a id="11804" href="Test.Golden.html#11743" class="Bound">ls1</a><a id="11807" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11812" href="Test.Golden.html#11812" class="Function">update</a> <a id="11819" class="Symbol">:</a> <a id="11821" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11826" href="Test.Golden.html#7189" class="Function">Result</a> <a id="11833" class="Symbol">→</a> <a id="11835" href="Test.Golden.html#11504" class="Record">Summary</a> <a id="11843" class="Symbol">→</a> <a id="11845" href="Test.Golden.html#11504" class="Record">Summary</a>
  <a id="11855" href="Test.Golden.html#11812" class="Function">update</a> <a id="11862" href="Test.Golden.html#11862" class="Bound">res</a> <a id="11866" href="Test.Golden.html#11866" class="Bound">sum</a> <a id="11870" class="Symbol">=</a>
    <a id="11876" class="Keyword">let</a> <a id="11880" class="Symbol">(</a><a id="11881" href="Test.Golden.html#11881" class="Bound">ls2</a> <a id="11885" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11887" href="Test.Golden.html#11887" class="Bound">ws2</a><a id="11890" class="Symbol">)</a> <a id="11892" class="Symbol">=</a> <a id="11894" href="Data.List.Base.html#3696" class="Function">partitionSums</a> <a id="11908" href="Test.Golden.html#11862" class="Bound">res</a> <a id="11912" class="Keyword">in</a>
    <a id="11919" href="Test.Golden.html#11684" class="Function">merge</a> <a id="11925" href="Test.Golden.html#11866" class="Bound">sum</a> <a id="11929" class="Symbol">(</a><a id="11930" href="Test.Golden.html#11540" class="InductiveConstructor">mkSummary</a> <a id="11940" href="Test.Golden.html#11887" class="Bound">ws2</a> <a id="11944" href="Test.Golden.html#11881" class="Bound">ls2</a><a id="11947" class="Symbol">)</a>

<a id="11950" class="Keyword">open</a> <a id="11955" href="Test.Golden.html#11444" class="Module">Summary</a> <a id="11963" class="Keyword">using</a> <a id="11969" class="Symbol">(</a><a id="11970" href="Test.Golden.html#11504" class="Record">Summary</a><a id="11977" class="Symbol">)</a> <a id="11979" class="Keyword">hiding</a> <a id="11986" class="Symbol">(</a><a id="11987" class="Keyword">module</a> <a id="11994" href="Test.Golden.html#11504" class="Module">Summary</a><a id="12001" class="Symbol">)</a>

<a id="12004" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="12052" href="Test.Golden.html#12052" class="Function">filterTests</a> <a id="12064" class="Symbol">:</a> <a id="12066" href="Test.Golden.html#4475" class="Record">Options</a> <a id="12074" class="Symbol">→</a> <a id="12076" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12081" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="12088" class="Symbol">→</a> <a id="12090" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12095" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="12102" href="Test.Golden.html#12052" class="Function">filterTests</a> <a id="12114" href="Test.Golden.html#12114" class="Bound">opts</a> <a id="12119" class="Symbol">=</a> <a id="12121" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="12126" href="Test.Golden.html#4628" class="Field">onlyNames</a> <a id="12136" href="Test.Golden.html#12114" class="Bound">opts</a> <a id="12141" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="12144" class="Symbol">λ</a> <a id="12146" class="Keyword">where</a>
  <a id="12154" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12157" class="Symbol">→</a> <a id="12159" href="Function.Base.html#704" class="Function">id</a>
  <a id="12164" href="Test.Golden.html#12164" class="CatchallClause Bound">xs</a> <a id="12167" class="Symbol">→</a> <a id="12169" class="Keyword">let</a> <a id="12173" href="Test.Golden.html#12173" class="Bound">names</a> <a id="12179" class="Symbol">=</a> <a id="12181" href="Data.List.Base.html#1634" class="Function">List.map</a> <a id="12190" href="Data.String.Base.html#1558" class="Primitive">String.toList</a> <a id="12204" href="Test.Golden.html#12164" class="Bound">xs</a> <a id="12207" class="Keyword">in</a>
       <a id="12217" href="Data.List.Base.html#10687" class="Function">filter</a> <a id="12224" class="Symbol">(λ</a> <a id="12227" href="Test.Golden.html#12227" class="Bound">n</a> <a id="12229" class="Symbol">→</a> <a id="12231" href="Data.List.Relation.Unary.Any.html#2684" class="Function">any?</a> <a id="12236" class="Symbol">(λ</a> <a id="12239" href="Test.Golden.html#12239" class="Bound">m</a> <a id="12241" class="Symbol">→</a> <a id="12243" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6694" class="Function">infix?</a> <a id="12250" href="Data.Char.Properties.html#2078" class="Function Operator">Char._≟_</a> <a id="12259" href="Test.Golden.html#12239" class="Bound">m</a> <a id="12261" class="Symbol">(</a><a id="12262" href="Data.String.Base.html#1558" class="Primitive">String.toList</a> <a id="12276" href="Test.Golden.html#12227" class="Bound">n</a><a id="12277" class="Symbol">))</a> <a id="12280" href="Test.Golden.html#12173" class="Bound">names</a><a id="12285" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12288" href="Test.Golden.html#12288" class="Function">poolRunner</a> <a id="12299" class="Symbol">:</a> <a id="12301" href="Test.Golden.html#4475" class="Record">Options</a> <a id="12309" class="Symbol">→</a> <a id="12311" href="Test.Golden.html#11318" class="Record">TestPool</a> <a id="12320" class="Symbol">→</a> <a id="12322" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="12325" href="Test.Golden.html#11504" class="Record">Summary</a>
<a id="12333" href="Test.Golden.html#12288" class="Function">poolRunner</a> <a id="12344" href="Test.Golden.html#12344" class="Bound">opts</a> <a id="12349" href="Test.Golden.html#12349" class="Bound">pool</a> <a id="12354" class="Symbol">=</a> <a id="12356" class="Keyword">do</a>
  <a id="12361" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12422" class="Keyword">let</a> <a id="12426" href="Test.Golden.html#12426" class="Bound">tests</a> <a id="12432" class="Symbol">=</a> <a id="12434" href="Test.Golden.html#12052" class="Function">filterTests</a> <a id="12446" href="Test.Golden.html#12344" class="Bound">opts</a> <a id="12451" class="Symbol">(</a><a id="12452" href="Test.Golden.html#12349" class="Bound">pool</a> <a id="12457" class="Symbol">.</a><a id="12458" href="Test.Golden.html#11398" class="Field">testCases</a><a id="12467" class="Symbol">)</a>
  <a id="12471" class="Symbol">(_</a> <a id="12474" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12476" class="Symbol">_)</a> <a id="12479" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="12481" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="12486" href="Test.Golden.html#12426" class="Bound">tests</a>
    <a id="12496" class="Keyword">where</a> <a id="12502" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12505" class="Symbol">→</a> <a id="12507" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="12512" href="Test.Golden.html#11641" class="Function">Summary.init</a>

  <a id="12528" class="Comment">-- announce the test pool and run them</a>
  <a id="12569" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="12578" href="Test.Golden.html#12683" class="Function">banner</a>
  <a id="12587" href="Test.Golden.html#12813" class="Function">loop</a> <a id="12592" href="Test.Golden.html#11641" class="Function">Summary.init</a> <a id="12605" href="Test.Golden.html#12426" class="Bound">tests</a>

  <a id="12614" class="Keyword">where</a>

  <a id="12623" href="Test.Golden.html#12623" class="Function">separator</a> <a id="12633" class="Symbol">:</a> <a id="12635" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="12644" href="Test.Golden.html#12623" class="Function">separator</a> <a id="12654" class="Symbol">=</a> <a id="12656" href="Data.String.Base.html#2540" class="Function">String.replicate</a> <a id="12673" class="Number">72</a> <a id="12676" class="String">&#39;-&#39;</a>

  <a id="12683" href="Test.Golden.html#12683" class="Function">banner</a> <a id="12690" class="Symbol">:</a> <a id="12692" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="12701" href="Test.Golden.html#12683" class="Function">banner</a> <a id="12708" class="Symbol">=</a> <a id="12710" href="Data.String.Base.html#2826" class="Function">unlines</a>
         <a id="12727" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="12729" class="String">&quot;&quot;</a> <a id="12732" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12734" href="Test.Golden.html#12623" class="Function">separator</a>
         <a id="12753" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12755" href="Test.Golden.html#12349" class="Bound">pool</a> <a id="12760" class="Symbol">.</a><a id="12761" href="Test.Golden.html#11376" class="Field">poolName</a>
         <a id="12779" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12781" href="Test.Golden.html#12623" class="Function">separator</a> <a id="12791" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12793" class="String">&quot;&quot;</a>
         <a id="12805" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12807" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="12813" href="Test.Golden.html#12813" class="Function">loop</a> <a id="12818" class="Symbol">:</a> <a id="12820" href="Test.Golden.html#11504" class="Record">Summary</a> <a id="12828" class="Symbol">→</a> <a id="12830" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12835" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="12842" class="Symbol">→</a> <a id="12844" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="12847" href="Test.Golden.html#11504" class="Record">Summary</a>
  <a id="12857" href="Test.Golden.html#12813" class="Function">loop</a> <a id="12862" href="Test.Golden.html#12862" class="Bound">acc</a> <a id="12866" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12869" class="Symbol">=</a> <a id="12871" href="IO.Base.html#1270" class="InductiveConstructor">pure</a> <a id="12876" href="Test.Golden.html#12862" class="Bound">acc</a>
  <a id="12882" href="Test.Golden.html#12813" class="Function">loop</a> <a id="12887" href="Test.Golden.html#12887" class="Bound">acc</a> <a id="12891" class="Symbol">(</a><a id="12892" href="Test.Golden.html#12892" class="Bound">test</a> <a id="12897" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12899" href="Test.Golden.html#12899" class="Bound">tests</a><a id="12904" class="Symbol">)</a> <a id="12906" class="Symbol">=</a> <a id="12908" class="Keyword">do</a>
    <a id="12915" href="Test.Golden.html#12915" class="Bound">res</a> <a id="12919" href="IO.Base.html#2105" class="Function Operator">&lt;-</a> <a id="12922" href="Test.Golden.html#7288" class="Function">runTest</a> <a id="12930" href="Test.Golden.html#12344" class="Bound">opts</a> <a id="12935" href="Test.Golden.html#12892" class="Bound">test</a>
    <a id="12944" href="Test.Golden.html#12813" class="Function">loop</a> <a id="12949" class="Symbol">(</a><a id="12950" href="Test.Golden.html#11812" class="Function">Summary.update</a> <a id="12965" class="Symbol">(</a><a id="12966" href="Test.Golden.html#12915" class="Bound">res</a> <a id="12970" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12972" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="12974" class="Symbol">)</a> <a id="12976" href="Test.Golden.html#12887" class="Bound">acc</a><a id="12979" class="Symbol">)</a> <a id="12981" href="Test.Golden.html#12899" class="Bound">tests</a>

<a id="runner"></a><a id="12988" href="Test.Golden.html#12988" class="Function">runner</a> <a id="12995" class="Symbol">:</a> <a id="12997" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="13002" href="Test.Golden.html#11318" class="Record">TestPool</a> <a id="13011" class="Symbol">→</a> <a id="13013" href="IO.Base.html#1201" class="Datatype">IO</a> <a id="13016" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="13018" href="Test.Golden.html#12988" class="Function">runner</a> <a id="13025" href="Test.Golden.html#13025" class="Bound">tests</a> <a id="13031" class="Symbol">=</a> <a id="13033" class="Keyword">do</a>
  <a id="13038" class="Comment">-- figure out the options</a>
  <a id="13066" href="Test.Golden.html#13066" class="Bound">args</a> <a id="13071" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="13073" href="System.Environment.html#660" class="Function">getArgs</a>
  <a id="13083" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="13088" href="Test.Golden.html#13088" class="Bound">opts</a> <a id="13093" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="13095" href="Test.Golden.html#5663" class="Function">options</a> <a id="13103" href="Test.Golden.html#13066" class="Bound">args</a>
    <a id="13112" class="Keyword">where</a> <a id="13118" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="13123" href="Test.Golden.html#13123" class="Bound">err</a> <a id="13127" class="Symbol">→</a> <a id="13129" href="System.Exit.html#1366" class="Function">die</a> <a id="13133" class="Symbol">(</a><a id="13134" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="13142" class="Symbol">(</a><a id="13143" href="Test.Golden.html#5476" class="Function">show</a> <a id="13148" href="Test.Golden.html#13123" class="Bound">err</a> <a id="13152" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13154" href="Test.Golden.html#5180" class="Function">usage</a> <a id="13160" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13162" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="13164" class="Symbol">))</a>

  <a id="13170" class="Comment">-- run the tests</a>
  <a id="13189" href="Test.Golden.html#13189" class="Bound">ress</a> <a id="13194" href="IO.Base.html#2105" class="Function Operator">←</a> <a id="13196" href="IO.html#2094" class="Function">List.mapM</a> <a id="13206" class="Symbol">(</a><a id="13207" href="Test.Golden.html#12288" class="Function">poolRunner</a> <a id="13218" href="Test.Golden.html#13088" class="Bound">opts</a><a id="13222" class="Symbol">)</a> <a id="13224" href="Test.Golden.html#13025" class="Bound">tests</a>
  <a id="13232" class="Keyword">let</a> <a id="13236" class="Keyword">open</a> <a id="13241" href="Test.Golden.html#11444" class="Module">Summary</a>
  <a id="13251" class="Keyword">let</a> <a id="13255" href="Test.Golden.html#13255" class="Bound">res</a> <a id="13259" class="Symbol">=</a> <a id="13261" href="Data.List.Base.html#4249" class="Function">List.foldl</a> <a id="13272" href="Test.Golden.html#11684" class="Function">merge</a> <a id="13278" href="Test.Golden.html#11641" class="Function">init</a> <a id="13283" href="Test.Golden.html#13189" class="Bound">ress</a>

  <a id="13291" class="Comment">-- report the result</a>
  <a id="13314" class="Keyword">let</a> <a id="13318" href="Test.Golden.html#13318" class="Bound">nsucc</a> <a id="13324" class="Symbol">=</a> <a id="13326" href="Data.List.Base.html#5044" class="Function">List.length</a> <a id="13338" class="Symbol">(</a><a id="13339" href="Test.Golden.html#13255" class="Bound">res</a> <a id="13343" class="Symbol">.</a><a id="13344" href="Test.Golden.html#11566" class="Field">success</a><a id="13351" class="Symbol">)</a>
  <a id="13355" class="Keyword">let</a> <a id="13359" href="Test.Golden.html#13359" class="Bound">nfail</a> <a id="13365" class="Symbol">=</a> <a id="13367" href="Data.List.Base.html#5044" class="Function">List.length</a> <a id="13379" class="Symbol">(</a><a id="13380" href="Test.Golden.html#13255" class="Bound">res</a> <a id="13384" class="Symbol">.</a><a id="13385" href="Test.Golden.html#11594" class="Field">failure</a><a id="13392" class="Symbol">)</a>
  <a id="13396" class="Keyword">let</a> <a id="13400" href="Test.Golden.html#13400" class="Bound">ntotal</a> <a id="13407" class="Symbol">=</a> <a id="13409" href="Test.Golden.html#13318" class="Bound">nsucc</a> <a id="13415" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="13417" href="Test.Golden.html#13359" class="Bound">nfail</a>
  <a id="13425" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="13434" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="13436" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="13443" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="13445" href="Data.Nat.Show.html#1962" class="Function">ℕ.show</a> <a id="13452" href="Test.Golden.html#13318" class="Bound">nsucc</a> <a id="13458" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13460" class="String">&quot;/&quot;</a> <a id="13464" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13466" href="Data.Nat.Show.html#1962" class="Function">ℕ.show</a> <a id="13473" href="Test.Golden.html#13400" class="Bound">ntotal</a> <a id="13480" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13482" class="String">&quot; tests successful&quot;</a> <a id="13502" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13504" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="13510" class="Comment">-- deal with failures</a>
  <a id="13534" class="Keyword">let</a> <a id="13538" href="Test.Golden.html#13538" class="Bound">list</a> <a id="13543" class="Symbol">=</a> <a id="13545" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="13553" class="Symbol">(</a><a id="13554" href="Test.Golden.html#13255" class="Bound">res</a> <a id="13558" class="Symbol">.</a><a id="13559" href="Test.Golden.html#11594" class="Field">failure</a><a id="13566" class="Symbol">)</a>
  <a id="13570" href="IO.Base.html#3476" class="Function">when</a> <a id="13575" class="Symbol">(</a><a id="13576" class="Number">0</a> <a id="13578" href="Data.Nat.Base.html#1463" class="Primitive Operator">&lt;ᵇ</a> <a id="13581" href="Test.Golden.html#13359" class="Bound">nfail</a><a id="13586" class="Symbol">)</a> <a id="13588" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="13590" class="Keyword">do</a>
    <a id="13597" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="13606" class="String">&quot;Failing tests:&quot;</a>
    <a id="13627" href="IO.Finite.html#1511" class="Function">putStrLn</a> <a id="13636" href="Test.Golden.html#13538" class="Bound">list</a>
  <a id="13643" href="IO.Base.html#3706" class="Function">whenJust</a> <a id="13652" class="Symbol">(</a><a id="13653" href="Test.Golden.html#13088" class="Bound">opts</a> <a id="13658" class="Symbol">.</a><a id="13659" href="Test.Golden.html#4853" class="Field">failureFile</a><a id="13670" class="Symbol">)</a> <a id="13672" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="13674" class="Symbol">λ</a> <a id="13676" href="Test.Golden.html#13676" class="Bound">fp</a> <a id="13679" class="Symbol">→</a> <a id="13681" href="IO.Finite.html#1281" class="Function">writeFile</a> <a id="13691" href="Test.Golden.html#13676" class="Bound">fp</a> <a id="13694" href="Test.Golden.html#13538" class="Bound">list</a>

  <a id="13702" class="Comment">-- exit</a>
  <a id="13712" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="13715" class="Number">0</a> <a id="13717" href="Data.Nat.Base.html#1289" class="Primitive Operator">≡ᵇ</a> <a id="13720" href="Test.Golden.html#13359" class="Bound">nfail</a>
   <a id="13729" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="13734" href="System.Exit.html#1311" class="Function">exitSuccess</a>
   <a id="13749" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="13754" href="System.Exit.html#1248" class="Function">exitFailure</a>
</pre></body></html>