<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Relation.Binary.Reasoning.Base.Partial</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- The basic code for equational reasoning with a partial relation</a>
<a id="173" class="Comment">------------------------------------------------------------------------</a>

<a id="247" class="Symbol">{-#</a> <a id="251" class="Keyword">OPTIONS</a> <a id="259" class="Pragma">--without-K</a> <a id="271" class="Pragma">--safe</a> <a id="278" class="Symbol">#-}</a>

<a id="283" class="Keyword">open</a> <a id="288" class="Keyword">import</a> <a id="295" href="Relation.Binary.html" class="Module">Relation.Binary</a>

<a id="312" class="Keyword">module</a> <a id="319" href="Relation.Binary.Reasoning.Base.Partial.html" class="Module">Relation.Binary.Reasoning.Base.Partial</a>
  <a id="360" class="Symbol">{</a><a id="361" href="Relation.Binary.Reasoning.Base.Partial.html#361" class="Bound">a</a> <a id="363" href="Relation.Binary.Reasoning.Base.Partial.html#363" class="Bound">ℓ</a><a id="364" class="Symbol">}</a> <a id="366" class="Symbol">{</a><a id="367" href="Relation.Binary.Reasoning.Base.Partial.html#367" class="Bound">A</a> <a id="369" class="Symbol">:</a> <a id="371" class="PrimitiveType">Set</a> <a id="375" href="Relation.Binary.Reasoning.Base.Partial.html#361" class="Bound">a</a><a id="376" class="Symbol">}</a> <a id="378" class="Symbol">(</a><a id="379" href="Relation.Binary.Reasoning.Base.Partial.html#379" class="Bound Operator">_∼_</a> <a id="383" class="Symbol">:</a> <a id="385" href="Relation.Binary.Core.html#845" class="Function">Rel</a> <a id="389" href="Relation.Binary.Reasoning.Base.Partial.html#367" class="Bound">A</a> <a id="391" href="Relation.Binary.Reasoning.Base.Partial.html#363" class="Bound">ℓ</a><a id="392" class="Symbol">)</a> <a id="394" class="Symbol">(</a><a id="395" href="Relation.Binary.Reasoning.Base.Partial.html#395" class="Bound">trans</a> <a id="401" class="Symbol">:</a> <a id="403" href="Relation.Binary.Definitions.html#1866" class="Function">Transitive</a> <a id="414" href="Relation.Binary.Reasoning.Base.Partial.html#379" class="Bound Operator">_∼_</a><a id="417" class="Symbol">)</a>
  <a id="421" class="Keyword">where</a>

<a id="428" class="Keyword">open</a> <a id="433" class="Keyword">import</a> <a id="440" href="Level.html" class="Module">Level</a> <a id="446" class="Keyword">using</a> <a id="452" class="Symbol">(</a><a id="453" href="Agda.Primitive.html#636" class="Primitive Operator">_⊔_</a><a id="456" class="Symbol">)</a>
<a id="458" class="Keyword">open</a> <a id="463" class="Keyword">import</a> <a id="470" href="Relation.Binary.PropositionalEquality.Core.html" class="Module">Relation.Binary.PropositionalEquality.Core</a> <a id="513" class="Symbol">as</a> <a id="516" class="Module">P</a>
  <a id="520" class="Keyword">using</a> <a id="526" class="Symbol">(</a><a id="527" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="530" class="Symbol">)</a>

<a id="533" class="Keyword">infix</a>  <a id="540" class="Number">4</a> <a id="542" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">_IsRelatedTo_</a>
<a id="556" class="Keyword">infix</a>  <a id="563" class="Number">3</a> <a id="565" href="Relation.Binary.Reasoning.Base.Partial.html#2304" class="Function Operator">_∎⟨_⟩</a>
<a id="571" class="Keyword">infixr</a> <a id="578" class="Number">2</a> <a id="580" href="Relation.Binary.Reasoning.Base.Partial.html#1762" class="Function">step-∼</a> <a id="587" href="Relation.Binary.Reasoning.Base.Partial.html#1926" class="Function">step-≡</a> <a id="594" href="Relation.Binary.Reasoning.Base.Partial.html#2075" class="Function">step-≡˘</a>
<a id="602" class="Keyword">infixr</a> <a id="609" class="Number">2</a> <a id="611" href="Relation.Binary.Reasoning.Base.Partial.html#2214" class="Function Operator">_≡⟨⟩_</a>
<a id="617" class="Keyword">infix</a>  <a id="624" class="Number">1</a> <a id="626" href="Relation.Binary.Reasoning.Base.Partial.html#1660" class="Function Operator">begin_</a>

<a id="634" class="Comment">------------------------------------------------------------------------</a>
<a id="707" class="Comment">-- Definition of &quot;related to&quot;</a>

<a id="738" class="Comment">-- This seemingly unnecessary type is used to make it possible to</a>
<a id="804" class="Comment">-- infer arguments even if the underlying equality evaluates.</a>

<a id="867" class="Keyword">data</a> <a id="_IsRelatedTo_"></a><a id="872" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">_IsRelatedTo_</a> <a id="886" class="Symbol">(</a><a id="887" href="Relation.Binary.Reasoning.Base.Partial.html#887" class="Bound">x</a> <a id="889" href="Relation.Binary.Reasoning.Base.Partial.html#889" class="Bound">y</a> <a id="891" class="Symbol">:</a> <a id="893" href="Relation.Binary.Reasoning.Base.Partial.html#367" class="Bound">A</a><a id="894" class="Symbol">)</a> <a id="896" class="Symbol">:</a> <a id="898" class="PrimitiveType">Set</a> <a id="902" href="Relation.Binary.Reasoning.Base.Partial.html#363" class="Bound">ℓ</a> <a id="904" class="Keyword">where</a>
  <a id="_IsRelatedTo_.relTo"></a><a id="912" href="Relation.Binary.Reasoning.Base.Partial.html#912" class="InductiveConstructor">relTo</a> <a id="918" class="Symbol">:</a> <a id="920" class="Symbol">(</a><a id="921" href="Relation.Binary.Reasoning.Base.Partial.html#921" class="Bound">x∼y</a> <a id="925" class="Symbol">:</a> <a id="927" href="Relation.Binary.Reasoning.Base.Partial.html#887" class="Bound">x</a> <a id="929" href="Relation.Binary.Reasoning.Base.Partial.html#379" class="Bound Operator">∼</a> <a id="931" href="Relation.Binary.Reasoning.Base.Partial.html#889" class="Bound">y</a><a id="932" class="Symbol">)</a> <a id="934" class="Symbol">→</a> <a id="936" href="Relation.Binary.Reasoning.Base.Partial.html#887" class="Bound">x</a> <a id="938" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="950" href="Relation.Binary.Reasoning.Base.Partial.html#889" class="Bound">y</a>

<a id="953" class="Comment">------------------------------------------------------------------------</a>
<a id="1026" class="Comment">-- Reasoning combinators</a>

<a id="1052" class="Comment">-- Note that the arguments to the `step`s are not provided in their</a>
<a id="1120" class="Comment">-- &quot;natural&quot; order and syntax declarations are later used to re-order</a>
<a id="1190" class="Comment">-- them. This is because the `step` ordering allows the type-checker to</a>
<a id="1262" class="Comment">-- better infer the middle argument `y` from the `_IsRelatedTo_`</a>
<a id="1327" class="Comment">-- argument (see issue 622).</a>
<a id="1356" class="Comment">--</a>
<a id="1359" class="Comment">-- This has two practical benefits. First it speeds up type-checking by</a>
<a id="1431" class="Comment">-- approximately a factor of 5. Secondly it allows the combinators to be</a>
<a id="1504" class="Comment">-- used with macros that use reflection, e.g. `Tactic.RingSolver`, where</a>
<a id="1577" class="Comment">-- they need to be able to extract `y` using reflection.</a>

<a id="1635" class="Comment">-- Beginning of a proof</a>

<a id="begin_"></a><a id="1660" href="Relation.Binary.Reasoning.Base.Partial.html#1660" class="Function Operator">begin_</a> <a id="1667" class="Symbol">:</a> <a id="1669" class="Symbol">∀</a> <a id="1671" class="Symbol">{</a><a id="1672" href="Relation.Binary.Reasoning.Base.Partial.html#1672" class="Bound">x</a> <a id="1674" href="Relation.Binary.Reasoning.Base.Partial.html#1674" class="Bound">y</a><a id="1675" class="Symbol">}</a> <a id="1677" class="Symbol">→</a> <a id="1679" href="Relation.Binary.Reasoning.Base.Partial.html#1672" class="Bound">x</a> <a id="1681" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="1693" href="Relation.Binary.Reasoning.Base.Partial.html#1674" class="Bound">y</a> <a id="1695" class="Symbol">→</a> <a id="1697" href="Relation.Binary.Reasoning.Base.Partial.html#1672" class="Bound">x</a> <a id="1699" href="Relation.Binary.Reasoning.Base.Partial.html#379" class="Bound Operator">∼</a> <a id="1701" href="Relation.Binary.Reasoning.Base.Partial.html#1674" class="Bound">y</a>
<a id="1703" href="Relation.Binary.Reasoning.Base.Partial.html#1660" class="Function Operator">begin</a> <a id="1709" href="Relation.Binary.Reasoning.Base.Partial.html#912" class="InductiveConstructor">relTo</a> <a id="1715" href="Relation.Binary.Reasoning.Base.Partial.html#1715" class="Bound">x∼y</a> <a id="1719" class="Symbol">=</a> <a id="1721" href="Relation.Binary.Reasoning.Base.Partial.html#1715" class="Bound">x∼y</a>

<a id="1726" class="Comment">-- Standard step with the relation</a>

<a id="step-∼"></a><a id="1762" href="Relation.Binary.Reasoning.Base.Partial.html#1762" class="Function">step-∼</a> <a id="1769" class="Symbol">:</a> <a id="1771" class="Symbol">∀</a> <a id="1773" href="Relation.Binary.Reasoning.Base.Partial.html#1773" class="Bound">x</a> <a id="1775" class="Symbol">{</a><a id="1776" href="Relation.Binary.Reasoning.Base.Partial.html#1776" class="Bound">y</a> <a id="1778" href="Relation.Binary.Reasoning.Base.Partial.html#1778" class="Bound">z</a><a id="1779" class="Symbol">}</a> <a id="1781" class="Symbol">→</a> <a id="1783" href="Relation.Binary.Reasoning.Base.Partial.html#1776" class="Bound">y</a> <a id="1785" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="1797" href="Relation.Binary.Reasoning.Base.Partial.html#1778" class="Bound">z</a> <a id="1799" class="Symbol">→</a> <a id="1801" href="Relation.Binary.Reasoning.Base.Partial.html#1773" class="Bound">x</a> <a id="1803" href="Relation.Binary.Reasoning.Base.Partial.html#379" class="Bound Operator">∼</a> <a id="1805" href="Relation.Binary.Reasoning.Base.Partial.html#1776" class="Bound">y</a> <a id="1807" class="Symbol">→</a> <a id="1809" href="Relation.Binary.Reasoning.Base.Partial.html#1773" class="Bound">x</a> <a id="1811" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="1823" href="Relation.Binary.Reasoning.Base.Partial.html#1778" class="Bound">z</a>
<a id="1825" href="Relation.Binary.Reasoning.Base.Partial.html#1762" class="Function">step-∼</a> <a id="1832" class="Symbol">_</a> <a id="1834" class="Symbol">(</a><a id="1835" href="Relation.Binary.Reasoning.Base.Partial.html#912" class="InductiveConstructor">relTo</a> <a id="1841" href="Relation.Binary.Reasoning.Base.Partial.html#1841" class="Bound">y∼z</a><a id="1844" class="Symbol">)</a> <a id="1846" href="Relation.Binary.Reasoning.Base.Partial.html#1846" class="Bound">x∼y</a> <a id="1850" class="Symbol">=</a> <a id="1852" href="Relation.Binary.Reasoning.Base.Partial.html#912" class="InductiveConstructor">relTo</a> <a id="1858" class="Symbol">(</a><a id="1859" href="Relation.Binary.Reasoning.Base.Partial.html#395" class="Bound">trans</a> <a id="1865" href="Relation.Binary.Reasoning.Base.Partial.html#1846" class="Bound">x∼y</a> <a id="1869" href="Relation.Binary.Reasoning.Base.Partial.html#1841" class="Bound">y∼z</a><a id="1872" class="Symbol">)</a>

<a id="1875" class="Comment">-- Step with a non-trivial propositional equality</a>

<a id="step-≡"></a><a id="1926" href="Relation.Binary.Reasoning.Base.Partial.html#1926" class="Function">step-≡</a> <a id="1933" class="Symbol">:</a> <a id="1935" class="Symbol">∀</a> <a id="1937" href="Relation.Binary.Reasoning.Base.Partial.html#1937" class="Bound">x</a> <a id="1939" class="Symbol">{</a><a id="1940" href="Relation.Binary.Reasoning.Base.Partial.html#1940" class="Bound">y</a> <a id="1942" href="Relation.Binary.Reasoning.Base.Partial.html#1942" class="Bound">z</a><a id="1943" class="Symbol">}</a> <a id="1945" class="Symbol">→</a> <a id="1947" href="Relation.Binary.Reasoning.Base.Partial.html#1940" class="Bound">y</a> <a id="1949" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="1961" href="Relation.Binary.Reasoning.Base.Partial.html#1942" class="Bound">z</a> <a id="1963" class="Symbol">→</a> <a id="1965" href="Relation.Binary.Reasoning.Base.Partial.html#1937" class="Bound">x</a> <a id="1967" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1969" href="Relation.Binary.Reasoning.Base.Partial.html#1940" class="Bound">y</a> <a id="1971" class="Symbol">→</a> <a id="1973" href="Relation.Binary.Reasoning.Base.Partial.html#1937" class="Bound">x</a> <a id="1975" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="1987" href="Relation.Binary.Reasoning.Base.Partial.html#1942" class="Bound">z</a>
<a id="1989" href="Relation.Binary.Reasoning.Base.Partial.html#1926" class="Function">step-≡</a> <a id="1996" class="Symbol">_</a> <a id="1998" href="Relation.Binary.Reasoning.Base.Partial.html#1998" class="Bound">x∼z</a> <a id="2002" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">P.refl</a> <a id="2009" class="Symbol">=</a> <a id="2011" href="Relation.Binary.Reasoning.Base.Partial.html#1998" class="Bound">x∼z</a>

<a id="2016" class="Comment">-- Step with a flipped non-trivial propositional equality</a>

<a id="step-≡˘"></a><a id="2075" href="Relation.Binary.Reasoning.Base.Partial.html#2075" class="Function">step-≡˘</a> <a id="2083" class="Symbol">:</a> <a id="2085" class="Symbol">∀</a> <a id="2087" href="Relation.Binary.Reasoning.Base.Partial.html#2087" class="Bound">x</a> <a id="2089" class="Symbol">{</a><a id="2090" href="Relation.Binary.Reasoning.Base.Partial.html#2090" class="Bound">y</a> <a id="2092" href="Relation.Binary.Reasoning.Base.Partial.html#2092" class="Bound">z</a><a id="2093" class="Symbol">}</a> <a id="2095" class="Symbol">→</a> <a id="2097" href="Relation.Binary.Reasoning.Base.Partial.html#2090" class="Bound">y</a> <a id="2099" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="2111" href="Relation.Binary.Reasoning.Base.Partial.html#2092" class="Bound">z</a> <a id="2113" class="Symbol">→</a> <a id="2115" href="Relation.Binary.Reasoning.Base.Partial.html#2090" class="Bound">y</a> <a id="2117" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="2119" href="Relation.Binary.Reasoning.Base.Partial.html#2087" class="Bound">x</a> <a id="2121" class="Symbol">→</a> <a id="2123" href="Relation.Binary.Reasoning.Base.Partial.html#2087" class="Bound">x</a> <a id="2125" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="2137" href="Relation.Binary.Reasoning.Base.Partial.html#2092" class="Bound">z</a>
<a id="2139" href="Relation.Binary.Reasoning.Base.Partial.html#2075" class="Function">step-≡˘</a> <a id="2147" class="Symbol">_</a> <a id="2149" href="Relation.Binary.Reasoning.Base.Partial.html#2149" class="Bound">x∼z</a> <a id="2153" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">P.refl</a> <a id="2160" class="Symbol">=</a> <a id="2162" href="Relation.Binary.Reasoning.Base.Partial.html#2149" class="Bound">x∼z</a>

<a id="2167" class="Comment">-- Step with a trivial propositional equality</a>

<a id="_≡⟨⟩_"></a><a id="2214" href="Relation.Binary.Reasoning.Base.Partial.html#2214" class="Function Operator">_≡⟨⟩_</a> <a id="2220" class="Symbol">:</a> <a id="2222" class="Symbol">∀</a> <a id="2224" href="Relation.Binary.Reasoning.Base.Partial.html#2224" class="Bound">x</a> <a id="2226" class="Symbol">{</a><a id="2227" href="Relation.Binary.Reasoning.Base.Partial.html#2227" class="Bound">y</a><a id="2228" class="Symbol">}</a> <a id="2230" class="Symbol">→</a> <a id="2232" href="Relation.Binary.Reasoning.Base.Partial.html#2224" class="Bound">x</a> <a id="2234" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="2246" href="Relation.Binary.Reasoning.Base.Partial.html#2227" class="Bound">y</a> <a id="2248" class="Symbol">→</a> <a id="2250" href="Relation.Binary.Reasoning.Base.Partial.html#2224" class="Bound">x</a> <a id="2252" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="2264" href="Relation.Binary.Reasoning.Base.Partial.html#2227" class="Bound">y</a>
<a id="2266" class="Symbol">_</a> <a id="2268" href="Relation.Binary.Reasoning.Base.Partial.html#2214" class="Function Operator">≡⟨⟩</a> <a id="2272" href="Relation.Binary.Reasoning.Base.Partial.html#2272" class="Bound">x∼y</a> <a id="2276" class="Symbol">=</a> <a id="2278" href="Relation.Binary.Reasoning.Base.Partial.html#2272" class="Bound">x∼y</a>

<a id="2283" class="Comment">-- Termination step</a>

<a id="_∎⟨_⟩"></a><a id="2304" href="Relation.Binary.Reasoning.Base.Partial.html#2304" class="Function Operator">_∎⟨_⟩</a> <a id="2310" class="Symbol">:</a> <a id="2312" class="Symbol">∀</a> <a id="2314" href="Relation.Binary.Reasoning.Base.Partial.html#2314" class="Bound">x</a> <a id="2316" class="Symbol">→</a> <a id="2318" href="Relation.Binary.Reasoning.Base.Partial.html#2314" class="Bound">x</a> <a id="2320" href="Relation.Binary.Reasoning.Base.Partial.html#379" class="Bound Operator">∼</a> <a id="2322" href="Relation.Binary.Reasoning.Base.Partial.html#2314" class="Bound">x</a> <a id="2324" class="Symbol">→</a> <a id="2326" href="Relation.Binary.Reasoning.Base.Partial.html#2314" class="Bound">x</a> <a id="2328" href="Relation.Binary.Reasoning.Base.Partial.html#872" class="Datatype Operator">IsRelatedTo</a> <a id="2340" href="Relation.Binary.Reasoning.Base.Partial.html#2314" class="Bound">x</a>
<a id="2342" class="Symbol">_</a> <a id="2344" href="Relation.Binary.Reasoning.Base.Partial.html#2304" class="Function Operator">∎⟨</a> <a id="2347" href="Relation.Binary.Reasoning.Base.Partial.html#2347" class="Bound">x∼x</a> <a id="2351" href="Relation.Binary.Reasoning.Base.Partial.html#2304" class="Function Operator">⟩</a>  <a id="2354" class="Symbol">=</a> <a id="2356" href="Relation.Binary.Reasoning.Base.Partial.html#912" class="InductiveConstructor">relTo</a> <a id="2362" href="Relation.Binary.Reasoning.Base.Partial.html#2347" class="Bound">x∼x</a>

<a id="2367" class="Comment">-- Syntax declarations</a>

<a id="2391" class="Keyword">syntax</a> <a id="2398" href="Relation.Binary.Reasoning.Base.Partial.html#1762" class="Function">step-∼</a>  <a id="2406" class="Bound">x</a> <a id="2408" class="Bound">y∼z</a> <a id="2412" class="Bound">x∼y</a> <a id="2416" class="Symbol">=</a> <a id="2418" class="Bound">x</a> <a id="2420" class="Function">∼⟨</a>  <a id="2424" class="Bound">x∼y</a> <a id="2428" class="Function">⟩</a> <a id="2430" class="Bound">y∼z</a>
<a id="2434" class="Keyword">syntax</a> <a id="2441" href="Relation.Binary.Reasoning.Base.Partial.html#1926" class="Function">step-≡</a>  <a id="2449" class="Bound">x</a> <a id="2451" class="Bound">y≡z</a> <a id="2455" class="Bound">x≡y</a> <a id="2459" class="Symbol">=</a> <a id="2461" class="Bound">x</a> <a id="2463" class="Function">≡⟨</a>  <a id="2467" class="Bound">x≡y</a> <a id="2471" class="Function">⟩</a> <a id="2473" class="Bound">y≡z</a>
<a id="2477" class="Keyword">syntax</a> <a id="2484" href="Relation.Binary.Reasoning.Base.Partial.html#2075" class="Function">step-≡˘</a> <a id="2492" class="Bound">x</a> <a id="2494" class="Bound">y≡z</a> <a id="2498" class="Bound">y≡x</a> <a id="2502" class="Symbol">=</a> <a id="2504" class="Bound">x</a> <a id="2506" class="Function">≡˘⟨</a> <a id="2510" class="Bound">y≡x</a> <a id="2514" class="Function">⟩</a> <a id="2516" class="Bound">y≡z</a>
</pre></body></html>