<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Reflection.External</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Support for system calls as part of reflection</a>
<a id="156" class="Comment">------------------------------------------------------------------------</a>

<a id="230" class="Symbol">{-#</a> <a id="234" class="Keyword">OPTIONS</a> <a id="242" class="Pragma">--cubical-compatible</a> <a id="263" class="Pragma">--safe</a> <a id="270" class="Symbol">#-}</a>

<a id="275" class="Keyword">module</a> <a id="282" href="Reflection.External.html" class="Module">Reflection.External</a> <a id="302" class="Keyword">where</a>

<a id="309" class="Keyword">import</a> <a id="316" href="Agda.Builtin.Reflection.External.html" class="Module">Agda.Builtin.Reflection.External</a> <a id="349" class="Symbol">as</a> <a id="352" class="Module">Builtin</a>

<a id="361" class="Keyword">open</a> <a id="366" class="Keyword">import</a> <a id="373" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="387" class="Keyword">using</a> <a id="393" class="Symbol">(</a><a id="394" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="395" class="Symbol">;</a> <a id="397" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a><a id="400" class="Symbol">;</a> <a id="402" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a><a id="406" class="Symbol">;</a> <a id="408" href="Data.Nat.Base.html#3260" class="Record">NonZero</a><a id="415" class="Symbol">)</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="444" class="Keyword">using</a> <a id="450" class="Symbol">(</a><a id="451" href="Agda.Builtin.List.html#147" class="Datatype">List</a><a id="455" class="Symbol">;</a> <a id="457" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">_∷_</a><a id="460" class="Symbol">;</a> <a id="462" href="Data.List.Base.html#7793" class="InductiveConstructor">[]</a><a id="464" class="Symbol">)</a>
<a id="466" class="Keyword">open</a> <a id="471" class="Keyword">import</a> <a id="478" href="Data.Product.Base.html" class="Module">Data.Product.Base</a> <a id="496" class="Keyword">using</a> <a id="502" class="Symbol">(</a><a id="503" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="506" class="Symbol">;</a> <a id="508" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="511" class="Symbol">)</a>
<a id="513" class="Keyword">open</a> <a id="518" class="Keyword">import</a> <a id="525" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="542" class="Symbol">as</a> <a id="545" class="Module">String</a> <a id="552" class="Keyword">using</a> <a id="558" class="Symbol">(</a><a id="559" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="565" class="Symbol">;</a> <a id="567" href="Data.String.Base.html#2404" class="Function Operator">_++_</a><a id="571" class="Symbol">)</a>
<a id="573" class="Keyword">open</a> <a id="578" class="Keyword">import</a> <a id="585" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="599" class="Keyword">using</a> <a id="605" class="Symbol">(</a><a id="606" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="609" class="Symbol">;</a> <a id="611" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="615" class="Symbol">;</a> <a id="617" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="621" class="Symbol">;</a> <a id="623" href="Data.Sum.Base.html#811" class="Function Operator">[_,_]</a><a id="628" class="Symbol">)</a>
<a id="630" class="Keyword">open</a> <a id="635" class="Keyword">import</a> <a id="642" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="657" class="Keyword">using</a> <a id="663" class="Symbol">(</a><a id="664" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a><a id="665" class="Symbol">;</a> <a id="667" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a><a id="669" class="Symbol">)</a>
<a id="671" class="Keyword">open</a> <a id="676" class="Keyword">import</a> <a id="683" href="Function.Base.html" class="Module">Function.Base</a> <a id="697" class="Keyword">using</a> <a id="703" class="Symbol">(</a><a id="704" href="Function.Base.html#4042" class="Function Operator">case_of_</a><a id="712" class="Symbol">;</a> <a id="714" href="Function.Base.html#1974" class="Function Operator">_$_</a><a id="717" class="Symbol">;</a> <a id="719" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="722" class="Symbol">)</a>
<a id="724" class="Keyword">open</a> <a id="729" class="Keyword">import</a> <a id="736" href="Reflection.html" class="Module">Reflection</a> <a id="747" class="Keyword">hiding</a> <a id="754" class="Symbol">(</a><a id="755" href="Agda.Builtin.Reflection.html#4589" class="InductiveConstructor">name</a><a id="759" class="Symbol">)</a>

<a id="762" class="Comment">-- Type aliases for the various strings.</a>

<a id="CmdName"></a><a id="804" href="Reflection.External.html#804" class="Function">CmdName</a> <a id="812" class="Symbol">=</a> <a id="814" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="StdIn"></a><a id="821" href="Reflection.External.html#821" class="Function">StdIn</a>   <a id="829" class="Symbol">=</a> <a id="831" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="StdErr"></a><a id="838" href="Reflection.External.html#838" class="Function">StdErr</a>  <a id="846" class="Symbol">=</a> <a id="848" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="StdOut"></a><a id="855" href="Reflection.External.html#855" class="Function">StdOut</a>  <a id="863" class="Symbol">=</a> <a id="865" href="Agda.Builtin.String.html#335" class="Postulate">String</a>

<a id="873" class="Comment">-- Representation for exit codes, assuming 0 is consistently used to</a>
<a id="942" class="Comment">-- indicate success across platforms.</a>
<a id="980" class="Keyword">data</a> <a id="ExitCode"></a><a id="985" href="Reflection.External.html#985" class="Datatype">ExitCode</a> <a id="994" class="Symbol">:</a> <a id="996" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1000" class="Keyword">where</a>
  <a id="ExitCode.exitSuccess"></a><a id="1008" href="Reflection.External.html#1008" class="InductiveConstructor">exitSuccess</a> <a id="1020" class="Symbol">:</a> <a id="1022" href="Reflection.External.html#985" class="Datatype">ExitCode</a>
  <a id="ExitCode.exitFailure"></a><a id="1033" href="Reflection.External.html#1033" class="InductiveConstructor">exitFailure</a> <a id="1045" class="Symbol">:</a> <a id="1047" class="Symbol">(</a><a id="1048" href="Reflection.External.html#1048" class="Bound">n</a> <a id="1050" class="Symbol">:</a> <a id="1052" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="1053" class="Symbol">)</a> <a id="1055" class="Symbol">{</a><a id="1056" href="Reflection.External.html#1056" class="Bound">n≢0</a> <a id="1060" class="Symbol">:</a> <a id="1062" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="1070" href="Reflection.External.html#1048" class="Bound">n</a><a id="1071" class="Symbol">}</a> <a id="1073" class="Symbol">→</a> <a id="1075" href="Reflection.External.html#985" class="Datatype">ExitCode</a>

<a id="1085" class="Comment">-- Specification for a command.</a>
<a id="1117" class="Keyword">record</a> <a id="CmdSpec"></a><a id="1124" href="Reflection.External.html#1124" class="Record">CmdSpec</a> <a id="1132" class="Symbol">:</a> <a id="1134" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1138" class="Keyword">where</a>
  <a id="1146" class="Keyword">constructor</a> <a id="cmdSpec"></a><a id="1158" href="Reflection.External.html#1158" class="InductiveConstructor">cmdSpec</a>
  <a id="1168" class="Keyword">field</a>
    <a id="CmdSpec.name"></a><a id="1178" href="Reflection.External.html#1178" class="Field">name</a>  <a id="1184" class="Symbol">:</a> <a id="1186" href="Reflection.External.html#804" class="Function">CmdName</a>     <a id="1198" class="Comment">-- ^ Executable name (see ~/.agda/executables)</a>
    <a id="CmdSpec.args"></a><a id="1249" href="Reflection.External.html#1249" class="Field">args</a>  <a id="1255" class="Symbol">:</a> <a id="1257" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1262" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="1269" class="Comment">-- ^ Command-line arguments for executable</a>
    <a id="CmdSpec.input"></a><a id="1316" href="Reflection.External.html#1316" class="Field">input</a> <a id="1322" class="Symbol">:</a> <a id="1324" href="Reflection.External.html#821" class="Function">StdIn</a>       <a id="1336" class="Comment">-- ^ Contents of standard input</a>

<a id="1369" class="Comment">-- Result of running a command.</a>
<a id="1401" class="Keyword">record</a> <a id="Result"></a><a id="1408" href="Reflection.External.html#1408" class="Record">Result</a> <a id="1415" class="Symbol">:</a> <a id="1417" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1421" class="Keyword">where</a>
  <a id="1429" class="Keyword">constructor</a> <a id="result"></a><a id="1441" href="Reflection.External.html#1441" class="InductiveConstructor">result</a>
  <a id="1450" class="Keyword">field</a>
    <a id="Result.exitCode"></a><a id="1460" href="Reflection.External.html#1460" class="Field">exitCode</a> <a id="1469" class="Symbol">:</a> <a id="1471" href="Reflection.External.html#985" class="Datatype">ExitCode</a> <a id="1480" class="Comment">-- ^ Exit code returned by the process</a>
    <a id="Result.output"></a><a id="1523" href="Reflection.External.html#1523" class="Field">output</a>   <a id="1532" class="Symbol">:</a> <a id="1534" href="Reflection.External.html#855" class="Function">StdOut</a>   <a id="1543" class="Comment">-- ^ Contents of standard output</a>
    <a id="Result.error"></a><a id="1580" href="Reflection.External.html#1580" class="Field">error</a>    <a id="1589" class="Symbol">:</a> <a id="1591" href="Reflection.External.html#838" class="Function">StdErr</a>   <a id="1600" class="Comment">-- ^ Contents of standard error</a>

<a id="1633" class="Comment">-- Convert a natural number to an exit code.</a>
<a id="toExitCode"></a><a id="1678" href="Reflection.External.html#1678" class="Function">toExitCode</a> <a id="1689" class="Symbol">:</a> <a id="1691" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="1693" class="Symbol">→</a> <a id="1695" href="Reflection.External.html#985" class="Datatype">ExitCode</a>
<a id="1704" href="Reflection.External.html#1678" class="Function">toExitCode</a> <a id="1715" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a>    <a id="1723" class="Symbol">=</a> <a id="1725" href="Reflection.External.html#1008" class="InductiveConstructor">exitSuccess</a>
<a id="1737" href="Reflection.External.html#1678" class="Function">toExitCode</a> <a id="1748" class="Symbol">(</a><a id="1749" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1753" href="Reflection.External.html#1753" class="Bound">n</a><a id="1754" class="Symbol">)</a> <a id="1756" class="Symbol">=</a> <a id="1758" href="Reflection.External.html#1033" class="InductiveConstructor">exitFailure</a> <a id="1770" class="Symbol">(</a><a id="1771" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="1775" href="Reflection.External.html#1753" class="Bound">n</a><a id="1776" class="Symbol">)</a>

<a id="1779" class="Comment">-- Quote an exit code as an Agda term.</a>
<a id="quoteExitCode"></a><a id="1818" href="Reflection.External.html#1818" class="Function">quoteExitCode</a> <a id="1832" class="Symbol">:</a> <a id="1834" href="Reflection.External.html#985" class="Datatype">ExitCode</a> <a id="1843" class="Symbol">→</a> <a id="1845" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
<a id="1850" href="Reflection.External.html#1818" class="Function">quoteExitCode</a> <a id="1864" href="Reflection.External.html#1008" class="InductiveConstructor">exitSuccess</a> <a id="1876" class="Symbol">=</a>
  <a id="1880" href="Agda.Builtin.Reflection.html#5194" class="InductiveConstructor">con</a> <a id="1884" class="Symbol">(</a><a id="1885" class="Keyword">quote</a> <a id="1891" href="Reflection.External.html#1008" class="InductiveConstructor">exitSuccess</a><a id="1902" class="Symbol">)</a> <a id="1904" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
<a id="1907" href="Reflection.External.html#1818" class="Function">quoteExitCode</a> <a id="1921" class="Symbol">(</a><a id="1922" href="Reflection.External.html#1033" class="InductiveConstructor">exitFailure</a> <a id="1934" href="Reflection.External.html#1934" class="Bound">n</a><a id="1935" class="Symbol">)</a> <a id="1937" class="Symbol">=</a>
  <a id="1941" href="Agda.Builtin.Reflection.html#5194" class="InductiveConstructor">con</a> <a id="1945" class="Symbol">(</a><a id="1946" class="Keyword">quote</a> <a id="1952" href="Reflection.External.html#1033" class="InductiveConstructor">exitFailure</a><a id="1963" class="Symbol">)</a> <a id="1965" class="Symbol">(</a><a id="1966" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="1971" class="Symbol">(</a><a id="1972" href="Agda.Builtin.Reflection.html#5509" class="InductiveConstructor">lit</a> <a id="1976" class="Symbol">(</a><a id="1977" href="Agda.Builtin.Reflection.html#4419" class="InductiveConstructor">nat</a> <a id="1981" href="Reflection.External.html#1934" class="Bound">n</a><a id="1982" class="Symbol">))</a> <a id="1985" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1987" href="Reflection.AST.Argument.html#1391" class="InductiveConstructor">hArg</a> <a id="1992" class="Symbol">(</a><a id="1993" href="Agda.Builtin.Reflection.html#5194" class="InductiveConstructor">con</a> <a id="1997" class="Symbol">(</a><a id="1998" class="Keyword">quote</a> <a id="2004" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a><a id="2006" class="Symbol">)</a> <a id="2008" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="2010" class="Symbol">)</a> <a id="2012" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2014" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="2016" class="Symbol">)</a>

<a id="2019" class="Comment">-- Quote a result as an Agda term.</a>
<a id="quoteResult"></a><a id="2054" href="Reflection.External.html#2054" class="Function">quoteResult</a> <a id="2066" class="Symbol">:</a> <a id="2068" href="Reflection.External.html#1408" class="Record">Result</a> <a id="2075" class="Symbol">→</a> <a id="2077" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
<a id="2082" href="Reflection.External.html#2054" class="Function">quoteResult</a> <a id="2094" class="Symbol">(</a><a id="2095" href="Reflection.External.html#1441" class="InductiveConstructor">result</a> <a id="2102" href="Reflection.External.html#2102" class="Bound">exitCode</a> <a id="2111" href="Reflection.External.html#2111" class="Bound">output</a> <a id="2118" href="Reflection.External.html#2118" class="Bound">error</a><a id="2123" class="Symbol">)</a> <a id="2125" class="Symbol">=</a>
  <a id="2129" href="Agda.Builtin.Reflection.html#5194" class="InductiveConstructor">con</a> <a id="2133" class="Symbol">(</a><a id="2134" class="Keyword">quote</a> <a id="2140" href="Reflection.External.html#1441" class="InductiveConstructor">result</a><a id="2146" class="Symbol">)</a> <a id="2148" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2150" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2155" class="Symbol">(</a><a id="2156" href="Reflection.External.html#1818" class="Function">quoteExitCode</a> <a id="2170" href="Reflection.External.html#2102" class="Bound">exitCode</a><a id="2178" class="Symbol">)</a>
                     <a id="2201" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2203" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2208" class="Symbol">(</a><a id="2209" href="Agda.Builtin.Reflection.html#5509" class="InductiveConstructor">lit</a> <a id="2213" class="Symbol">(</a><a id="2214" href="Agda.Builtin.Reflection.html#4555" class="InductiveConstructor">string</a> <a id="2221" href="Reflection.External.html#2111" class="Bound">output</a><a id="2227" class="Symbol">))</a>
                     <a id="2251" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2253" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2258" class="Symbol">(</a><a id="2259" href="Agda.Builtin.Reflection.html#5509" class="InductiveConstructor">lit</a> <a id="2263" class="Symbol">(</a><a id="2264" href="Agda.Builtin.Reflection.html#4555" class="InductiveConstructor">string</a> <a id="2271" href="Reflection.External.html#2118" class="Bound">error</a><a id="2276" class="Symbol">))</a>
                     <a id="2300" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2302" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

<a id="2306" class="Comment">-- Run command from specification and return the full result.</a>
<a id="2368" class="Comment">--</a>
<a id="2371" class="Comment">-- NOTE: If the command fails, this macro still succeeds, and returns the</a>
<a id="2445" class="Comment">--       full result, including exit code and the contents of stderr.</a>
<a id="2515" class="Comment">--</a>
<a id="unsafeRunCmdTC"></a><a id="2518" href="Reflection.External.html#2518" class="Function">unsafeRunCmdTC</a> <a id="2533" class="Symbol">:</a> <a id="2535" href="Reflection.External.html#1124" class="Record">CmdSpec</a> <a id="2543" class="Symbol">→</a> <a id="2545" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="2548" href="Reflection.External.html#1408" class="Record">Result</a>
<a id="2555" href="Reflection.External.html#2518" class="Function">unsafeRunCmdTC</a> <a id="2570" href="Reflection.External.html#2570" class="Bound">c</a> <a id="2572" class="Symbol">=</a> <a id="2574" class="Keyword">do</a>
  <a id="2579" class="Symbol">(</a><a id="2580" href="Reflection.External.html#2580" class="Bound">exitCode</a> <a id="2589" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2591" class="Symbol">(</a><a id="2592" href="Reflection.External.html#2592" class="Bound">stdOut</a> <a id="2599" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2601" href="Reflection.External.html#2601" class="Bound">stdErr</a><a id="2607" class="Symbol">))</a>
    <a id="2614" href="Reflection.TCM.Syntax.html#623" class="Function Operator">←</a> <a id="2616" href="Agda.Builtin.Reflection.External.html#315" class="Postulate">Builtin.execTC</a> <a id="2631" class="Symbol">(</a><a id="2632" href="Reflection.External.html#1178" class="Field">CmdSpec.name</a> <a id="2645" href="Reflection.External.html#2570" class="Bound">c</a><a id="2646" class="Symbol">)</a> <a id="2648" class="Symbol">(</a><a id="2649" href="Reflection.External.html#1249" class="Field">CmdSpec.args</a> <a id="2662" href="Reflection.External.html#2570" class="Bound">c</a><a id="2663" class="Symbol">)</a> <a id="2665" class="Symbol">(</a><a id="2666" href="Reflection.External.html#1316" class="Field">CmdSpec.input</a> <a id="2680" href="Reflection.External.html#2570" class="Bound">c</a><a id="2681" class="Symbol">)</a>
  <a id="2685" href="Reflection.TCM.html#1087" class="Postulate">pure</a> <a id="2690" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2692" href="Reflection.External.html#1441" class="InductiveConstructor">result</a> <a id="2699" class="Symbol">(</a><a id="2700" href="Reflection.External.html#1678" class="Function">toExitCode</a> <a id="2711" href="Reflection.External.html#2580" class="Bound">exitCode</a><a id="2719" class="Symbol">)</a> <a id="2721" href="Reflection.External.html#2592" class="Bound">stdOut</a> <a id="2728" href="Reflection.External.html#2601" class="Bound">stdErr</a>

<a id="2736" class="Keyword">macro</a>
  <a id="unsafeRunCmd"></a><a id="2744" href="Reflection.External.html#2744" class="Function">unsafeRunCmd</a> <a id="2757" class="Symbol">:</a> <a id="2759" href="Reflection.External.html#1124" class="Record">CmdSpec</a> <a id="2767" class="Symbol">→</a> <a id="2769" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2774" class="Symbol">→</a> <a id="2776" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="2779" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
  <a id="2783" href="Reflection.External.html#2744" class="Function">unsafeRunCmd</a> <a id="2796" href="Reflection.External.html#2796" class="Bound">c</a> <a id="2798" href="Reflection.External.html#2798" class="Bound">hole</a> <a id="2803" class="Symbol">=</a> <a id="2805" href="Reflection.External.html#2518" class="Function">unsafeRunCmdTC</a> <a id="2820" href="Reflection.External.html#2796" class="Bound">c</a> <a id="2822" href="Reflection.TCM.Syntax.html#623" class="Function Operator">&gt;&gt;=</a> <a id="2826" href="Agda.Builtin.Reflection.html#8775" class="Postulate">unify</a> <a id="2832" href="Reflection.External.html#2798" class="Bound">hole</a> <a id="2837" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2839" href="Reflection.External.html#2054" class="Function">quoteResult</a>


<a id="2853" class="Comment">-- Show a command for the user.</a>
<a id="showCmdSpec"></a><a id="2885" href="Reflection.External.html#2885" class="Function">showCmdSpec</a> <a id="2897" class="Symbol">:</a> <a id="2899" href="Reflection.External.html#1124" class="Record">CmdSpec</a> <a id="2907" class="Symbol">→</a> <a id="2909" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="2916" href="Reflection.External.html#2885" class="Function">showCmdSpec</a> <a id="2928" href="Reflection.External.html#2928" class="Bound">c</a> <a id="2930" class="Symbol">=</a> <a id="2932" href="Data.String.Base.html#2747" class="Function">String.unwords</a> <a id="2947" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="2949" href="Reflection.External.html#1178" class="Field">CmdSpec.name</a> <a id="2962" href="Reflection.External.html#2928" class="Bound">c</a> <a id="2964" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2966" href="Reflection.External.html#1249" class="Field">CmdSpec.args</a> <a id="2979" href="Reflection.External.html#2928" class="Bound">c</a>


<a id="2983" class="Keyword">private</a>
  <a id="2993" class="Comment">-- Helper function for throwing an error from reflection.</a>
  <a id="userError"></a><a id="3053" href="Reflection.External.html#3053" class="Function">userError</a> <a id="3063" class="Symbol">:</a> <a id="3065" class="Symbol">∀</a> <a id="3067" class="Symbol">{</a><a id="3068" href="Reflection.External.html#3068" class="Bound">a</a><a id="3069" class="Symbol">}</a> <a id="3071" class="Symbol">{</a><a id="3072" href="Reflection.External.html#3072" class="Bound">A</a> <a id="3074" class="Symbol">:</a> <a id="3076" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3080" href="Reflection.External.html#3068" class="Bound">a</a><a id="3081" class="Symbol">}</a> <a id="3083" class="Symbol">→</a> <a id="3085" href="Reflection.External.html#1124" class="Record">CmdSpec</a> <a id="3093" class="Symbol">→</a> <a id="3095" href="Reflection.External.html#855" class="Function">StdOut</a> <a id="3102" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3104" href="Reflection.External.html#838" class="Function">StdErr</a> <a id="3111" class="Symbol">→</a> <a id="3113" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="3116" href="Reflection.External.html#3072" class="Bound">A</a>
  <a id="3120" href="Reflection.External.html#3053" class="Function">userError</a> <a id="3130" href="Reflection.External.html#3130" class="Bound">c</a> <a id="3132" class="Symbol">(</a><a id="3133" href="Reflection.External.html#3133" class="Bound">stdout</a> <a id="3140" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3142" href="Reflection.External.html#3142" class="Bound">stderr</a><a id="3148" class="Symbol">)</a> <a id="3150" class="Symbol">=</a> <a id="3152" href="Agda.Builtin.Reflection.html#8815" class="Postulate">typeError</a> <a id="3162" class="Symbol">(</a><a id="3163" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="3170" href="Reflection.External.html#3199" class="Function">errMsg</a> <a id="3177" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3179" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="3181" class="Symbol">)</a>
    <a id="3187" class="Keyword">where</a>
      <a id="3199" href="Reflection.External.html#3199" class="Function">errMsg</a> <a id="3206" class="Symbol">:</a> <a id="3208" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
      <a id="3221" href="Reflection.External.html#3199" class="Function">errMsg</a> <a id="3228" class="Symbol">=</a> <a id="3230" href="Data.String.Base.html#2805" class="Function">String.unlines</a>
             <a id="3258" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3260" class="Symbol">(</a><a id="3261" class="String">&quot;Error while running command &#39;&quot;</a> <a id="3293" href="Data.String.Base.html#2404" class="Function Operator">++</a> <a id="3296" href="Reflection.External.html#2885" class="Function">showCmdSpec</a> <a id="3308" href="Reflection.External.html#3130" class="Bound">c</a> <a id="3310" href="Data.String.Base.html#2404" class="Function Operator">++</a> <a id="3313" class="String">&quot;&#39;&quot;</a><a id="3316" class="Symbol">)</a>
             <a id="3331" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3333" class="Symbol">(</a><a id="3334" class="String">&quot;Input:\n&quot;</a> <a id="3345" href="Data.String.Base.html#2404" class="Function Operator">++</a> <a id="3348" href="Reflection.External.html#1316" class="Field">CmdSpec.input</a> <a id="3362" href="Reflection.External.html#3130" class="Bound">c</a><a id="3363" class="Symbol">)</a>
             <a id="3378" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3380" class="Symbol">(</a><a id="3381" class="String">&quot;Output:\n&quot;</a> <a id="3393" href="Data.String.Base.html#2404" class="Function Operator">++</a> <a id="3396" href="Reflection.External.html#3133" class="Bound">stdout</a><a id="3402" class="Symbol">)</a>
             <a id="3417" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3419" class="Symbol">(</a><a id="3420" class="String">&quot;Error:\n&quot;</a> <a id="3431" href="Data.String.Base.html#2404" class="Function Operator">++</a> <a id="3434" href="Reflection.External.html#3142" class="Bound">stderr</a><a id="3440" class="Symbol">)</a>
             <a id="3455" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3457" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>


<a id="3462" class="Comment">-- Run command from specification. If the command succeeds, it returns the</a>
<a id="3537" class="Comment">-- contents of stdout. Otherwise, it throws a type error with the contents</a>
<a id="3612" class="Comment">-- of stderr.</a>
<a id="runCmdTC"></a><a id="3626" href="Reflection.External.html#3626" class="Function">runCmdTC</a> <a id="3635" class="Symbol">:</a> <a id="3637" href="Reflection.External.html#1124" class="Record">CmdSpec</a> <a id="3645" class="Symbol">→</a> <a id="3647" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="3650" href="Reflection.External.html#855" class="Function">StdOut</a>
<a id="3657" href="Reflection.External.html#3626" class="Function">runCmdTC</a> <a id="3666" href="Reflection.External.html#3666" class="Bound">c</a> <a id="3668" class="Symbol">=</a> <a id="3670" class="Keyword">do</a>
  <a id="3675" href="Reflection.External.html#3675" class="Bound">r</a> <a id="3677" href="Reflection.TCM.Syntax.html#623" class="Function Operator">←</a> <a id="3679" href="Reflection.External.html#2518" class="Function">unsafeRunCmdTC</a> <a id="3694" href="Reflection.External.html#3666" class="Bound">c</a>
  <a id="3698" class="Keyword">let</a> <a id="3702" href="Reflection.External.html#3702" class="Bound">debugPrefix</a> <a id="3714" class="Symbol">=</a> <a id="3716" class="Symbol">(</a><a id="3717" class="String">&quot;user.&quot;</a> <a id="3725" href="Data.String.Base.html#2404" class="Function Operator">++</a> <a id="3728" href="Reflection.External.html#1178" class="Field">CmdSpec.name</a> <a id="3741" href="Reflection.External.html#3666" class="Bound">c</a><a id="3742" class="Symbol">)</a>
  <a id="3746" href="Function.Base.html#4042" class="Function Operator">case</a> <a id="3751" href="Reflection.External.html#1460" class="Field">Result.exitCode</a> <a id="3767" href="Reflection.External.html#3675" class="Bound">r</a> <a id="3769" href="Function.Base.html#4042" class="Function Operator">of</a> <a id="3772" class="Symbol">λ</a>
    <a id="3778" class="Symbol">{</a> <a id="3780" href="Reflection.External.html#1008" class="InductiveConstructor">exitSuccess</a> <a id="3792" class="Symbol">→</a> <a id="3794" class="Keyword">do</a>
      <a id="3803" href="Agda.Builtin.Reflection.html#11057" class="Postulate">debugPrint</a> <a id="3814" class="Symbol">(</a><a id="3815" href="Reflection.External.html#3702" class="Bound">debugPrefix</a> <a id="3827" href="Data.String.Base.html#2404" class="Function Operator">++</a> <a id="3830" class="String">&quot;.stderr&quot;</a><a id="3839" class="Symbol">)</a> <a id="3841" class="Number">10</a> <a id="3844" class="Symbol">(</a><a id="3845" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="3852" class="Symbol">(</a><a id="3853" href="Reflection.External.html#1580" class="Field">Result.error</a> <a id="3866" href="Reflection.External.html#3675" class="Bound">r</a><a id="3867" class="Symbol">)</a> <a id="3869" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3871" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="3873" class="Symbol">)</a>
      <a id="3881" href="Reflection.TCM.html#1087" class="Postulate">pure</a> <a id="3886" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3888" href="Reflection.External.html#1523" class="Field">Result.output</a> <a id="3902" href="Reflection.External.html#3675" class="Bound">r</a>
    <a id="3908" class="Symbol">;</a> <a id="3910" class="Symbol">(</a><a id="3911" href="Reflection.External.html#1033" class="InductiveConstructor">exitFailure</a> <a id="3923" href="Reflection.External.html#3923" class="Bound">n</a><a id="3924" class="Symbol">)</a> <a id="3926" class="Symbol">→</a> <a id="3928" class="Keyword">do</a>
      <a id="3937" href="Reflection.External.html#3053" class="Function">userError</a> <a id="3947" href="Reflection.External.html#3666" class="Bound">c</a> <a id="3949" class="Symbol">(</a><a id="3950" href="Reflection.External.html#1523" class="Field">Result.output</a> <a id="3964" href="Reflection.External.html#3675" class="Bound">r</a> <a id="3966" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3968" href="Reflection.External.html#1580" class="Field">Result.error</a> <a id="3981" href="Reflection.External.html#3675" class="Bound">r</a><a id="3982" class="Symbol">)</a>
    <a id="3988" class="Symbol">}</a>

<a id="3991" class="Keyword">macro</a>
  <a id="runCmd"></a><a id="3999" href="Reflection.External.html#3999" class="Function">runCmd</a> <a id="4006" class="Symbol">:</a> <a id="4008" href="Reflection.External.html#1124" class="Record">CmdSpec</a> <a id="4016" class="Symbol">→</a> <a id="4018" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="4023" class="Symbol">→</a> <a id="4025" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="4028" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
  <a id="4032" href="Reflection.External.html#3999" class="Function">runCmd</a> <a id="4039" href="Reflection.External.html#4039" class="Bound">c</a> <a id="4041" href="Reflection.External.html#4041" class="Bound">hole</a> <a id="4046" class="Symbol">=</a> <a id="4048" href="Reflection.External.html#3626" class="Function">runCmdTC</a> <a id="4057" href="Reflection.External.html#4039" class="Bound">c</a> <a id="4059" href="Reflection.TCM.Syntax.html#623" class="Function Operator">&gt;&gt;=</a> <a id="4063" href="Agda.Builtin.Reflection.html#8775" class="Postulate">unify</a> <a id="4069" href="Reflection.External.html#4041" class="Bound">hole</a> <a id="4074" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4076" href="Agda.Builtin.Reflection.html#5509" class="InductiveConstructor">lit</a> <a id="4080" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4082" href="Agda.Builtin.Reflection.html#4555" class="InductiveConstructor">string</a>
</pre></body></html>