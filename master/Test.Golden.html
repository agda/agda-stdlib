<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containing the expected output of `run`</a>
<a id="1103" class="Comment">--</a>
<a id="1106" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1174" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1249" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1302" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1374" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1448" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1516" class="Comment">--</a>
<a id="1519" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1589" class="Comment">--</a>
<a id="1592" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1663" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1694" class="Comment">--</a>
<a id="1697" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1772" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1824" class="Comment">------------------------------------------------------------------------</a>
<a id="1897" class="Comment">-- Options</a>
<a id="1908" class="Comment">--</a>
<a id="1911" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1968" class="Comment">--</a>
<a id="1971" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2052" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2127" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2219" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2292" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2357" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2431" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2491" class="Comment">--</a>
<a id="2494" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2574" class="Comment">-- arguments and constructs this for you.</a>
<a id="2616" class="Comment">--</a>

<a id="2620" class="Comment">------------------------------------------------------------------------</a>
<a id="2693" class="Comment">-- Usage</a>
<a id="2702" class="Comment">--</a>
<a id="2705" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2762" class="Comment">--</a>
<a id="2765" class="Comment">--```sh</a>
<a id="2773" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2816" class="Comment">--   [--timing]</a>
<a id="2832" class="Comment">--   [--interactive]</a>
<a id="2853" class="Comment">--   [--only-file PATH]</a>
<a id="2877" class="Comment">--   [--failure-file PATH]</a>
<a id="2904" class="Comment">--   [--no-colour]</a>
<a id="2923" class="Comment">--   [--only [NAMES]]</a>
<a id="2945" class="Comment">--```</a>
<a id="2951" class="Comment">--</a>
<a id="2954" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3035" class="Symbol">{-#</a> <a id="3039" class="Keyword">OPTIONS</a> <a id="3047" class="Pragma">--cubical-compatible</a> <a id="3068" class="Pragma">--guardedness</a> <a id="3082" class="Symbol">#-}</a>

<a id="3087" class="Keyword">module</a> <a id="3094" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3106" class="Keyword">where</a>

<a id="3113" class="Keyword">open</a> <a id="3118" class="Keyword">import</a> <a id="3125" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3140" class="Keyword">using</a> <a id="3146" class="Symbol">(</a><a id="3147" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a><a id="3151" class="Symbol">;</a> <a id="3153" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="3157" class="Symbol">;</a> <a id="3159" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="3164" class="Symbol">;</a> <a id="3166" href="Data.Bool.Base.html#1515" class="Function Operator">if_then_else_</a><a id="3179" class="Symbol">)</a>
<a id="3181" class="Keyword">import</a> <a id="3188" href="Data.Char.html" class="Module">Data.Char</a> <a id="3198" class="Symbol">as</a> <a id="3201" class="Module">Char</a>
<a id="3206" class="Keyword">open</a> <a id="3211" class="Keyword">import</a> <a id="3218" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3227" class="Keyword">using</a> <a id="3233" class="Symbol">(</a><a id="3234" href="Data.Fin.html#700" class="Function Operator">#_</a><a id="3236" class="Symbol">)</a>
<a id="3238" class="Keyword">import</a> <a id="3245" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3263" class="Symbol">as</a> <a id="3266" class="Module">ℤ</a>
<a id="3268" class="Keyword">open</a> <a id="3273" class="Keyword">import</a> <a id="3280" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3295" class="Symbol">as</a> <a id="3298" class="Module">List</a> <a id="3303" class="Keyword">using</a> <a id="3309" class="Symbol">(</a><a id="3310" href="Agda.Builtin.List.html#147" class="Datatype">List</a><a id="3314" class="Symbol">;</a> <a id="3316" href="Data.List.Base.html#7301" class="InductiveConstructor">[]</a><a id="3318" class="Symbol">;</a> <a id="3320" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">_∷_</a><a id="3323" class="Symbol">;</a> <a id="3325" href="Data.List.Base.html#1712" class="Function Operator">_++_</a><a id="3329" class="Symbol">;</a> <a id="3331" href="Data.List.Base.html#10389" class="Function">filter</a><a id="3337" class="Symbol">;</a> <a id="3339" href="Data.List.Base.html#3674" class="Function">partitionSums</a><a id="3352" class="Symbol">)</a>
<a id="3354" class="Keyword">open</a> <a id="3359" class="Keyword">import</a> <a id="3366" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3423" class="Keyword">using</a> <a id="3429" class="Symbol">(</a><a id="3430" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6760" class="Function">infix?</a><a id="3436" class="Symbol">)</a>
<a id="3438" class="Keyword">open</a> <a id="3443" class="Keyword">import</a> <a id="3450" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3479" class="Keyword">using</a> <a id="3485" class="Symbol">(</a><a id="3486" href="Data.List.Relation.Unary.Any.html#2691" class="Function">any?</a><a id="3490" class="Symbol">)</a>
<a id="3492" class="Keyword">open</a> <a id="3497" class="Keyword">import</a> <a id="3504" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3520" class="Keyword">using</a> <a id="3526" class="Symbol">(</a><a id="3527" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a><a id="3532" class="Symbol">;</a> <a id="3534" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="3538" class="Symbol">;</a> <a id="3540" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="3547" class="Symbol">;</a> <a id="3549" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a><a id="3558" class="Symbol">)</a>
<a id="3560" class="Keyword">open</a> <a id="3565" class="Keyword">import</a> <a id="3572" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3586" class="Keyword">using</a> <a id="3592" class="Symbol">(</a><a id="3593" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="3594" class="Symbol">;</a> <a id="3596" href="Data.Nat.Base.html#1289" class="Primitive Operator">_≡ᵇ_</a><a id="3600" class="Symbol">;</a> <a id="3602" href="Data.Nat.Base.html#1463" class="Primitive Operator">_&lt;ᵇ_</a><a id="3606" class="Symbol">;</a> <a id="3608" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">_+_</a><a id="3611" class="Symbol">;</a> <a id="3613" href="Data.Nat.Base.html#4462" class="Primitive Operator">_∸_</a><a id="3616" class="Symbol">)</a>
<a id="3618" class="Keyword">open</a> <a id="3623" class="Keyword">import</a> <a id="3630" href="Data.Nat.ListAction.html" class="Module">Data.Nat.ListAction</a> <a id="3650" class="Keyword">using</a> <a id="3656" class="Symbol">(</a><a id="3657" href="Data.Nat.ListAction.html#612" class="Function">sum</a><a id="3660" class="Symbol">)</a>
<a id="3662" class="Keyword">import</a> <a id="3669" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3683" class="Symbol">as</a> <a id="3686" class="Module">ℕ</a> <a id="3688" class="Keyword">using</a> <a id="3694" class="Symbol">(</a><a id="3695" href="Data.Nat.Show.html#2025" class="Function">show</a><a id="3699" class="Symbol">)</a>
<a id="3701" class="Keyword">open</a> <a id="3706" class="Keyword">import</a> <a id="3713" href="Data.Product.Base.html" class="Module">Data.Product.Base</a> <a id="3731" class="Keyword">using</a> <a id="3737" class="Symbol">(</a><a id="3738" href="Data.Product.Base.html#1752" class="Function Operator">_×_</a><a id="3741" class="Symbol">;</a> <a id="3743" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="3746" class="Symbol">)</a>
<a id="3748" class="Keyword">open</a> <a id="3753" class="Keyword">import</a> <a id="3760" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="3777" class="Symbol">as</a> <a id="3780" class="Module">String</a> <a id="3787" class="Keyword">using</a> <a id="3793" class="Symbol">(</a><a id="3794" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="3800" class="Symbol">;</a> <a id="3802" href="Data.String.Base.html#5230" class="Function">lines</a><a id="3807" class="Symbol">;</a> <a id="3809" href="Data.String.Base.html#2826" class="Function">unlines</a><a id="3816" class="Symbol">;</a> <a id="3818" href="Data.String.Base.html#2768" class="Function">unwords</a><a id="3825" class="Symbol">;</a> <a id="3827" href="Data.String.Base.html#2613" class="Function">concat</a><a id="3833" class="Symbol">)</a>
<a id="3835" class="Keyword">open</a> <a id="3840" class="Keyword">import</a> <a id="3847" href="Data.String.Properties.html" class="Module">Data.String.Properties</a> <a id="3870" class="Symbol">as</a> <a id="3873" class="Module">String</a> <a id="3880" class="Keyword">using</a> <a id="3886" class="Symbol">(</a><a id="3887" href="Data.String.Properties.html#2741" class="Function Operator">_≟_</a><a id="3890" class="Symbol">)</a>
<a id="3892" class="Keyword">open</a> <a id="3897" class="Keyword">import</a> <a id="3904" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3918" class="Keyword">using</a> <a id="3924" class="Symbol">(</a><a id="3925" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="3928" class="Symbol">;</a> <a id="3930" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="3934" class="Symbol">;</a> <a id="3936" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="3940" class="Symbol">)</a>
<a id="3942" class="Keyword">open</a> <a id="3947" class="Keyword">import</a> <a id="3954" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3969" class="Keyword">using</a> <a id="3975" class="Symbol">(</a><a id="3976" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a><a id="3977" class="Symbol">)</a>

<a id="3980" class="Keyword">open</a> <a id="3985" class="Keyword">import</a> <a id="3992" href="Function.Base.html" class="Module">Function.Base</a> <a id="4006" class="Keyword">using</a> <a id="4012" class="Symbol">(</a><a id="4013" href="Function.Base.html#704" class="Function">id</a><a id="4015" class="Symbol">;</a> <a id="4017" href="Function.Base.html#1993" class="Function Operator">_$_</a><a id="4020" class="Symbol">;</a> <a id="4022" href="Function.Base.html#4061" class="Function Operator">case_of_</a><a id="4030" class="Symbol">)</a>

<a id="4033" class="Keyword">open</a> <a id="4038" class="Keyword">import</a> <a id="4045" href="Relation.Nullary.Decidable.Core.html" class="Module">Relation.Nullary.Decidable.Core</a> <a id="4077" class="Keyword">using</a> <a id="4083" class="Symbol">(</a><a id="4084" href="Relation.Nullary.Decidable.Core.html#2038" class="Field">does</a><a id="4088" class="Symbol">)</a>

<a id="4091" class="Keyword">open</a> <a id="4096" class="Keyword">import</a> <a id="4103" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="4127" class="Keyword">using</a> <a id="4133" class="Symbol">(</a><a id="4134" href="Agda.Builtin.Coinduction.html#229" class="CoinductiveConstructor Operator">♯_</a><a id="4136" class="Symbol">)</a>
<a id="4138" class="Keyword">open</a> <a id="4143" class="Keyword">import</a> <a id="4150" href="IO.html" class="Module">IO</a>
<a id="4153" class="Keyword">open</a> <a id="4158" class="Keyword">import</a> <a id="4165" href="IO.Handle.html" class="Module">IO.Handle</a>

<a id="4176" class="Keyword">open</a> <a id="4181" class="Keyword">import</a> <a id="4188" href="System.Clock.html" class="Module">System.Clock</a> <a id="4201" class="Symbol">as</a> <a id="4204" class="Module">Clock</a> <a id="4210" class="Keyword">using</a> <a id="4216" class="Symbol">(</a><a id="4217" href="System.Clock.html#2491" class="Function">time′</a><a id="4222" class="Symbol">;</a> <a id="4224" href="System.Clock.html#1646" class="Record">Time</a><a id="4228" class="Symbol">;</a> <a id="4230" href="System.Clock.html#1692" class="Field">seconds</a><a id="4237" class="Symbol">)</a>
<a id="4239" class="Keyword">open</a> <a id="4244" class="Keyword">import</a> <a id="4251" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4271" class="Keyword">open</a> <a id="4276" class="Keyword">import</a> <a id="4283" href="System.Directory.html" class="Module">System.Directory</a> <a id="4300" class="Keyword">using</a> <a id="4306" class="Symbol">(</a><a id="4307" href="System.Directory.html#3068" class="Function">doesFileExist</a><a id="4320" class="Symbol">;</a> <a id="4322" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a><a id="4340" class="Symbol">)</a>
<a id="4342" class="Keyword">open</a> <a id="4347" class="Keyword">import</a> <a id="4354" href="System.Environment.html" class="Module">System.Environment</a> <a id="4373" class="Keyword">using</a> <a id="4379" class="Symbol">(</a><a id="4380" href="System.Environment.html#660" class="Function">getArgs</a><a id="4387" class="Symbol">;</a> <a id="4389" href="System.Environment.html#777" class="Function">lookupEnv</a><a id="4398" class="Symbol">)</a>
<a id="4400" class="Keyword">open</a> <a id="4405" class="Keyword">import</a> <a id="4412" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4424" class="Keyword">open</a> <a id="4429" class="Keyword">import</a> <a id="4436" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4458" class="Keyword">using</a> <a id="4464" class="Symbol">(</a><a id="4465" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a><a id="4475" class="Symbol">)</a>
<a id="4477" class="Keyword">open</a> <a id="4482" class="Keyword">import</a> <a id="4489" href="System.Process.html" class="Module">System.Process</a> <a id="4504" class="Keyword">using</a> <a id="4510" class="Symbol">(</a><a id="4511" href="System.Process.html#655" class="Function">callCommand</a><a id="4522" class="Symbol">;</a> <a id="4524" href="System.Process.html#735" class="Function">system</a><a id="4530" class="Symbol">)</a>

<a id="4533" class="Keyword">record</a> <a id="Options"></a><a id="4540" href="Test.Golden.html#4540" class="Record">Options</a> <a id="4548" class="Symbol">:</a> <a id="4550" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4554" class="Keyword">where</a>
  <a id="4562" class="Keyword">field</a>
    <a id="4572" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4620" href="Test.Golden.html#4620" class="Field">exeUnderTest</a> <a id="4633" class="Symbol">:</a> <a id="4635" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4646" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4693" href="Test.Golden.html#4693" class="Field">onlyNames</a> <a id="4703" class="Symbol">:</a> <a id="4705" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4710" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4721" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4772" href="Test.Golden.html#4772" class="Field">interactive</a> <a id="4784" class="Symbol">:</a> <a id="4786" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="4795" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4840" href="Test.Golden.html#4840" class="Field">timing</a> <a id="4847" class="Symbol">:</a> <a id="4849" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="4858" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4918" href="Test.Golden.html#4918" class="Field">failureFile</a> <a id="4930" class="Symbol">:</a> <a id="4932" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4938" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4949" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="5010" href="Test.Golden.html#5010" class="Field">colour</a> <a id="5017" class="Symbol">:</a> <a id="5019" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="5024" class="Keyword">open</a> <a id="5029" href="Test.Golden.html#4540" class="Module">Options</a>

<a id="initOptions"></a><a id="5038" href="Test.Golden.html#5038" class="Function">initOptions</a> <a id="5050" class="Symbol">:</a> <a id="5052" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5059" class="Symbol">→</a> <a id="5061" href="Test.Golden.html#4540" class="Record">Options</a>
<a id="5069" href="Test.Golden.html#5038" class="Function">initOptions</a> <a id="5081" href="Test.Golden.html#5081" class="Bound">exe</a> <a id="5085" class="Symbol">=</a> <a id="5087" class="Keyword">record</a>
  <a id="5096" class="Symbol">{</a> <a id="5098" href="Test.Golden.html#4620" class="Field">exeUnderTest</a> <a id="5111" class="Symbol">=</a> <a id="5113" href="Test.Golden.html#5081" class="Bound">exe</a>
  <a id="5119" class="Symbol">;</a> <a id="5121" href="Test.Golden.html#4693" class="Field">onlyNames</a>    <a id="5134" class="Symbol">=</a> <a id="5136" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
  <a id="5141" class="Symbol">;</a> <a id="5143" href="Test.Golden.html#4772" class="Field">interactive</a>  <a id="5156" class="Symbol">=</a> <a id="5158" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
  <a id="5166" class="Symbol">;</a> <a id="5168" href="Test.Golden.html#4840" class="Field">timing</a>       <a id="5181" class="Symbol">=</a> <a id="5183" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
  <a id="5191" class="Symbol">;</a> <a id="5193" href="Test.Golden.html#4918" class="Field">failureFile</a>  <a id="5206" class="Symbol">=</a> <a id="5208" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
  <a id="5218" class="Symbol">;</a> <a id="5220" href="Test.Golden.html#5010" class="Field">colour</a>       <a id="5233" class="Symbol">=</a> <a id="5235" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
  <a id="5242" class="Symbol">}</a>

<a id="usage"></a><a id="5245" href="Test.Golden.html#5245" class="Function">usage</a> <a id="5251" class="Symbol">:</a> <a id="5253" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5260" href="Test.Golden.html#5245" class="Function">usage</a> <a id="5266" class="Symbol">=</a> <a id="5268" href="Data.String.Base.html#2768" class="Function">unwords</a>
  <a id="5278" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="5280" class="String">&quot;Usage:&quot;</a>
  <a id="5291" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5293" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5313" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5315" class="String">&quot;[--timing]&quot;</a>
  <a id="5330" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5332" class="String">&quot;[--interactive]&quot;</a>
  <a id="5352" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5354" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5380" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5382" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5405" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5407" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5425" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5427" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5448" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5450" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

<a id="5454" class="Keyword">data</a> <a id="Error"></a><a id="5459" href="Test.Golden.html#5459" class="Datatype">Error</a> <a id="5465" class="Symbol">:</a> <a id="5467" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="5471" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5479" href="Test.Golden.html#5479" class="InductiveConstructor">MissingExecutable</a> <a id="5497" class="Symbol">:</a> <a id="5499" href="Test.Golden.html#5459" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5507" href="Test.Golden.html#5507" class="InductiveConstructor">InvalidArgument</a> <a id="5523" class="Symbol">:</a> <a id="5525" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5532" class="Symbol">→</a> <a id="5534" href="Test.Golden.html#5459" class="Datatype">Error</a>

<a id="show"></a><a id="5541" href="Test.Golden.html#5541" class="Function">show</a> <a id="5546" class="Symbol">:</a> <a id="5548" href="Test.Golden.html#5459" class="Datatype">Error</a> <a id="5554" class="Symbol">→</a> <a id="5556" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5563" href="Test.Golden.html#5541" class="Function">show</a> <a id="5568" href="Test.Golden.html#5479" class="InductiveConstructor">MissingExecutable</a> <a id="5586" class="Symbol">=</a> <a id="5588" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5627" href="Test.Golden.html#5541" class="Function">show</a> <a id="5632" class="Symbol">(</a><a id="5633" href="Test.Golden.html#5507" class="InductiveConstructor">InvalidArgument</a> <a id="5649" href="Test.Golden.html#5649" class="Bound">arg</a><a id="5652" class="Symbol">)</a> <a id="5654" class="Symbol">=</a> <a id="5656" class="String">&quot;Invalid argument: &quot;</a> <a id="5677" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="5687" href="Test.Golden.html#5649" class="Bound">arg</a>

<a id="5692" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5728" href="Test.Golden.html#5728" class="Function">options</a> <a id="5736" class="Symbol">:</a> <a id="5738" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5743" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5750" class="Symbol">→</a> <a id="5752" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="5755" class="Symbol">(</a><a id="5756" href="Test.Golden.html#5459" class="Datatype">Error</a> <a id="5762" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5764" href="Test.Golden.html#4540" class="Record">Options</a><a id="5771" class="Symbol">)</a>
<a id="5773" href="Test.Golden.html#5728" class="Function">options</a><a id="5780" class="Symbol">(</a><a id="5781" href="Test.Golden.html#5781" class="Bound">exe</a> <a id="5785" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5787" href="Test.Golden.html#5787" class="Bound">rest</a><a id="5791" class="Symbol">)</a> <a id="5793" class="Symbol">=</a> <a id="5795" href="Test.Golden.html#6596" class="Function">mkOptions</a> <a id="5805" href="Test.Golden.html#5781" class="Bound">exe</a> <a id="5809" href="Test.Golden.html#5787" class="Bound">rest</a> <a id="5814" class="Keyword">where</a>

  <a id="5823" href="Test.Golden.html#5823" class="Function">go</a> <a id="5826" class="Symbol">:</a> <a id="5828" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5833" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5840" class="Symbol">→</a> <a id="5842" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5848" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5855" class="Symbol">→</a> <a id="5857" href="Test.Golden.html#4540" class="Record">Options</a> <a id="5865" class="Symbol">→</a> <a id="5867" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5874" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5876" class="Symbol">(</a><a id="5877" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5883" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5890" href="Data.Product.Base.html#1752" class="Function Operator">×</a> <a id="5892" href="Test.Golden.html#4540" class="Record">Options</a><a id="5899" class="Symbol">)</a>
  <a id="5903" href="Test.Golden.html#5823" class="Function">go</a> <a id="5906" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>                             <a id="5937" href="Test.Golden.html#5937" class="Bound">mfp</a> <a id="5941" href="Test.Golden.html#5941" class="Bound">opts</a> <a id="5946" class="Symbol">=</a> <a id="5948" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="5953" class="Symbol">(</a><a id="5954" href="Test.Golden.html#5937" class="Bound">mfp</a> <a id="5958" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5960" href="Test.Golden.html#5941" class="Bound">opts</a><a id="5964" class="Symbol">)</a>
  <a id="5968" href="Test.Golden.html#5823" class="Function">go</a> <a id="5971" class="Symbol">(</a><a id="5972" class="String">&quot;--timing&quot;</a>            <a id="5994" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5996" href="Test.Golden.html#5996" class="Bound">args</a><a id="6000" class="Symbol">)</a> <a id="6002" href="Test.Golden.html#6002" class="Bound">mfp</a> <a id="6006" href="Test.Golden.html#6006" class="Bound">opts</a> <a id="6011" class="Symbol">=</a>
    <a id="6017" href="Test.Golden.html#5823" class="Function">go</a> <a id="6020" href="Test.Golden.html#5996" class="Bound">args</a> <a id="6025" href="Test.Golden.html#6002" class="Bound">mfp</a> <a id="6029" class="Symbol">(</a><a id="6030" class="Keyword">record</a> <a id="6037" href="Test.Golden.html#6006" class="Bound">opts</a> <a id="6042" class="Symbol">{</a> <a id="6044" href="Test.Golden.html#4840" class="Field">timing</a> <a id="6051" class="Symbol">=</a> <a id="6053" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="6058" class="Symbol">})</a>
  <a id="6063" href="Test.Golden.html#5823" class="Function">go</a> <a id="6066" class="Symbol">(</a><a id="6067" class="String">&quot;--interactive&quot;</a>       <a id="6089" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6091" href="Test.Golden.html#6091" class="Bound">args</a><a id="6095" class="Symbol">)</a> <a id="6097" href="Test.Golden.html#6097" class="Bound">mfp</a> <a id="6101" href="Test.Golden.html#6101" class="Bound">opts</a> <a id="6106" class="Symbol">=</a>
    <a id="6112" href="Test.Golden.html#5823" class="Function">go</a> <a id="6115" href="Test.Golden.html#6091" class="Bound">args</a> <a id="6120" href="Test.Golden.html#6097" class="Bound">mfp</a> <a id="6124" class="Symbol">(</a><a id="6125" class="Keyword">record</a> <a id="6132" href="Test.Golden.html#6101" class="Bound">opts</a> <a id="6137" class="Symbol">{</a> <a id="6139" href="Test.Golden.html#4772" class="Field">interactive</a> <a id="6151" class="Symbol">=</a> <a id="6153" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="6158" class="Symbol">})</a>
  <a id="6163" href="Test.Golden.html#5823" class="Function">go</a> <a id="6166" class="Symbol">(</a><a id="6167" class="String">&quot;--failure-file&quot;</a> <a id="6184" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6186" href="Test.Golden.html#6186" class="Bound">fp</a> <a id="6189" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6191" href="Test.Golden.html#6191" class="Bound">args</a><a id="6195" class="Symbol">)</a> <a id="6197" href="Test.Golden.html#6197" class="Bound">mfp</a> <a id="6201" href="Test.Golden.html#6201" class="Bound">opts</a> <a id="6206" class="Symbol">=</a>
    <a id="6212" href="Test.Golden.html#5823" class="Function">go</a> <a id="6215" href="Test.Golden.html#6191" class="Bound">args</a> <a id="6220" href="Test.Golden.html#6197" class="Bound">mfp</a> <a id="6224" class="Symbol">(</a><a id="6225" class="Keyword">record</a> <a id="6232" href="Test.Golden.html#6201" class="Bound">opts</a> <a id="6237" class="Symbol">{</a> <a id="6239" href="Test.Golden.html#4918" class="Field">failureFile</a> <a id="6251" class="Symbol">=</a> <a id="6253" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6258" href="Test.Golden.html#6186" class="Bound">fp</a> <a id="6261" class="Symbol">})</a>
  <a id="6266" href="Test.Golden.html#5823" class="Function">go</a> <a id="6269" class="Symbol">(</a><a id="6270" class="String">&quot;--only&quot;</a>              <a id="6292" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6294" href="Test.Golden.html#6294" class="Bound">args</a><a id="6298" class="Symbol">)</a> <a id="6300" href="Test.Golden.html#6300" class="Bound">mfp</a> <a id="6304" href="Test.Golden.html#6304" class="Bound">opts</a> <a id="6309" class="Symbol">=</a>
    <a id="6315" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6320" class="Symbol">(</a><a id="6321" href="Test.Golden.html#6300" class="Bound">mfp</a> <a id="6325" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6327" class="Symbol">(</a><a id="6328" class="Keyword">record</a> <a id="6335" href="Test.Golden.html#6304" class="Bound">opts</a> <a id="6340" class="Symbol">{</a> <a id="6342" href="Test.Golden.html#4693" class="Field">onlyNames</a> <a id="6352" class="Symbol">=</a> <a id="6354" href="Test.Golden.html#6294" class="Bound">args</a> <a id="6359" class="Symbol">}))</a>
  <a id="6365" href="Test.Golden.html#5823" class="Function">go</a> <a id="6368" class="Symbol">(</a><a id="6369" class="String">&quot;--only-file&quot;</a> <a id="6383" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6385" href="Test.Golden.html#6385" class="Bound">fp</a>    <a id="6391" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6393" href="Test.Golden.html#6393" class="Bound">args</a><a id="6397" class="Symbol">)</a> <a id="6399" href="Test.Golden.html#6399" class="Bound">mfp</a> <a id="6403" href="Test.Golden.html#6403" class="Bound">opts</a> <a id="6408" class="Symbol">=</a>
    <a id="6414" href="Test.Golden.html#5823" class="Function">go</a> <a id="6417" href="Test.Golden.html#6393" class="Bound">args</a> <a id="6422" class="Symbol">(</a><a id="6423" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6428" href="Test.Golden.html#6385" class="Bound">fp</a><a id="6430" class="Symbol">)</a> <a id="6432" class="Symbol">(</a><a id="6433" class="Keyword">record</a> <a id="6440" href="Test.Golden.html#6403" class="Bound">opts</a> <a id="6445" class="Symbol">{</a> <a id="6447" href="Test.Golden.html#4693" class="Field">onlyNames</a> <a id="6457" class="Symbol">=</a> <a id="6459" href="Test.Golden.html#6393" class="Bound">args</a> <a id="6464" class="Symbol">})</a>
  <a id="6469" href="Test.Golden.html#5823" class="Function">go</a> <a id="6472" class="Symbol">(</a><a id="6473" class="String">&quot;--no-colour&quot;</a>         <a id="6495" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6497" href="Test.Golden.html#6497" class="Bound">args</a><a id="6501" class="Symbol">)</a> <a id="6503" href="Test.Golden.html#6503" class="Bound">mfp</a> <a id="6507" href="Test.Golden.html#6507" class="Bound">opts</a> <a id="6512" class="Symbol">=</a>
    <a id="6518" href="Test.Golden.html#5823" class="Function">go</a> <a id="6521" href="Test.Golden.html#6497" class="Bound">args</a> <a id="6526" href="Test.Golden.html#6503" class="Bound">mfp</a> <a id="6530" class="Symbol">(</a><a id="6531" class="Keyword">record</a> <a id="6538" href="Test.Golden.html#6507" class="Bound">opts</a> <a id="6543" class="Symbol">{</a> <a id="6545" href="Test.Golden.html#5010" class="Field">colour</a> <a id="6552" class="Symbol">=</a> <a id="6554" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6560" class="Symbol">})</a>
  <a id="6565" href="Test.Golden.html#5823" class="CatchallClause Function">go</a><a id="6567" class="CatchallClause"> </a><a id="6568" class="CatchallClause Symbol">(</a><a id="6569" href="Test.Golden.html#6569" class="CatchallClause Bound">arg</a><a id="6572" class="CatchallClause"> </a><a id="6573" href="Agda.Builtin.List.html#199" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6574" class="CatchallClause"> </a><a id="6575" class="CatchallClause Symbol">_)</a><a id="6577" class="CatchallClause"> </a><a id="6578" class="CatchallClause Symbol">_</a><a id="6579" class="CatchallClause"> </a><a id="6580" class="CatchallClause Symbol">_</a> <a id="6582" class="Symbol">=</a> <a id="6584" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6589" href="Test.Golden.html#6569" class="Bound">arg</a>

  <a id="6596" href="Test.Golden.html#6596" class="Function">mkOptions</a> <a id="6606" class="Symbol">:</a> <a id="6608" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="6615" class="Symbol">→</a> <a id="6617" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6622" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="6629" class="Symbol">→</a> <a id="6631" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="6634" class="Symbol">(</a><a id="6635" href="Test.Golden.html#5459" class="Datatype">Error</a> <a id="6641" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6643" href="Test.Golden.html#4540" class="Record">Options</a><a id="6650" class="Symbol">)</a>
  <a id="6654" href="Test.Golden.html#6596" class="Function">mkOptions</a> <a id="6664" href="Test.Golden.html#6664" class="Bound">exe</a> <a id="6668" href="Test.Golden.html#6668" class="Bound">rest</a> <a id="6673" class="Symbol">=</a> <a id="6675" class="Keyword">do</a>
    <a id="6682" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6687" class="Symbol">(</a><a id="6688" href="Test.Golden.html#6688" class="Bound">mfp</a> <a id="6692" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6694" href="Test.Golden.html#6694" class="Bound">opts</a><a id="6698" class="Symbol">)</a> <a id="6700" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="6702" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="6707" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="6709" href="Test.Golden.html#5823" class="Function">go</a> <a id="6712" href="Test.Golden.html#6668" class="Bound">rest</a> <a id="6717" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="6725" class="Symbol">(</a><a id="6726" href="Test.Golden.html#5038" class="Function">initOptions</a> <a id="6738" href="Test.Golden.html#6664" class="Bound">exe</a><a id="6741" class="Symbol">)</a>
      <a id="6749" class="Keyword">where</a> <a id="6755" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6760" href="Test.Golden.html#6760" class="Bound">arg</a> <a id="6764" class="Symbol">→</a> <a id="6766" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="6771" class="Symbol">(</a><a id="6772" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6777" class="Symbol">(</a><a id="6778" href="Test.Golden.html#5507" class="InductiveConstructor">InvalidArgument</a> <a id="6794" href="Test.Golden.html#6760" class="Bound">arg</a><a id="6797" class="Symbol">))</a>
    <a id="6804" href="Test.Golden.html#6804" class="Bound">term</a> <a id="6809" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="6811" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a> <a id="6821" class="String">&quot;&quot;</a> <a id="6824" href="IO.Base.html#2098" class="Function Operator">&lt;$&gt;</a> <a id="6828" href="System.Environment.html#777" class="Function">lookupEnv</a> <a id="6838" class="String">&quot;TERM&quot;</a>
    <a id="6849" class="Keyword">let</a> <a id="6853" href="Test.Golden.html#6853" class="Bound">opts</a> <a id="6858" class="Symbol">=</a> <a id="6860" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="6863" href="Relation.Nullary.Decidable.Core.html#2038" class="Field">does</a> <a id="6868" class="Symbol">(</a><a id="6869" href="Test.Golden.html#6804" class="Bound">term</a> <a id="6874" href="Data.String.Properties.html#2741" class="Function Operator">≟</a> <a id="6876" class="String">&quot;DUMB&quot;</a><a id="6882" class="Symbol">)</a>
               <a id="6899" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="6904" class="Keyword">record</a> <a id="6911" href="Test.Golden.html#6694" class="Bound">opts</a> <a id="6916" class="Symbol">{</a> <a id="6918" href="Test.Golden.html#5010" class="Field">colour</a> <a id="6925" class="Symbol">=</a> <a id="6927" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6933" class="Symbol">}</a>
               <a id="6950" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="6955" href="Test.Golden.html#6694" class="Bound">opts</a>
    <a id="6964" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6969" href="Test.Golden.html#6969" class="Bound">fp</a> <a id="6972" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="6974" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="6979" href="Test.Golden.html#6688" class="Bound">mfp</a>
      <a id="6989" class="Keyword">where</a> <a id="6995" class="CatchallClause Symbol">_</a> <a id="6997" class="Symbol">→</a> <a id="6999" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="7004" class="Symbol">(</a><a id="7005" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="7010" href="Test.Golden.html#6853" class="Bound">opts</a><a id="7014" class="Symbol">)</a>
    <a id="7020" href="Test.Golden.html#7020" class="Bound">only</a> <a id="7025" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7027" href="IO.html#2922" class="Function">readFiniteFile</a> <a id="7042" href="Test.Golden.html#6969" class="Bound">fp</a>
    <a id="7049" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="7054" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7056" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="7061" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7063" class="Keyword">record</a> <a id="7070" href="Test.Golden.html#6853" class="Bound">opts</a> <a id="7075" class="Symbol">{</a> <a id="7077" href="Test.Golden.html#4693" class="Field">onlyNames</a> <a id="7087" class="Symbol">=</a> <a id="7089" href="Data.String.Base.html#5230" class="Function">lines</a> <a id="7095" href="Test.Golden.html#7020" class="Bound">only</a> <a id="7100" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="7103" href="Test.Golden.html#4693" class="Field">onlyNames</a> <a id="7113" href="Test.Golden.html#6853" class="Bound">opts</a> <a id="7118" class="Symbol">}</a>

<a id="7121" href="Test.Golden.html#5728" class="Function">options</a> <a id="7129" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="7132" class="Symbol">=</a> <a id="7134" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="7139" class="Symbol">(</a><a id="7140" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7145" href="Test.Golden.html#5479" class="InductiveConstructor">MissingExecutable</a><a id="7162" class="Symbol">)</a>


<a id="7166" class="Comment">-- The result of a test run</a>
<a id="7194" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7254" href="Test.Golden.html#7254" class="Function">Result</a> <a id="7261" class="Symbol">:</a> <a id="7263" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="7267" href="Test.Golden.html#7254" class="Function">Result</a> <a id="7274" class="Symbol">=</a> <a id="7276" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="7283" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="7285" href="Agda.Builtin.String.html#335" class="Postulate">String</a>

<a id="7293" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7353" href="Test.Golden.html#7353" class="Function">runTest</a> <a id="7361" class="Symbol">:</a> <a id="7363" href="Test.Golden.html#4540" class="Record">Options</a> <a id="7371" class="Symbol">→</a> <a id="7373" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="7380" class="Symbol">→</a> <a id="7382" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="7385" href="Test.Golden.html#7254" class="Function">Result</a>
<a id="7392" href="Test.Golden.html#7353" class="Function">runTest</a> <a id="7400" href="Test.Golden.html#7400" class="Bound">opts</a> <a id="7405" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="7414" class="Symbol">=</a> <a id="7416" class="Keyword">do</a>

  <a id="7422" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="7427" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7429" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a> <a id="7448" class="Symbol">(</a><a id="7449" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a> <a id="7460" href="Test.Golden.html#7405" class="Bound">testPath</a><a id="7468" class="Symbol">)</a>
    <a id="7474" class="Keyword">where</a> <a id="7480" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="7486" class="Symbol">→</a> <a id="7488" href="Test.Golden.html#9104" class="Function">fail</a> <a id="7493" href="Test.Golden.html#8725" class="Function">directoryNotFound</a>

  <a id="7514" href="IO.Finite.html#1639" class="Function">putStr</a> <a id="7521" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7523" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="7530" class="Symbol">(</a><a id="7531" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="7540" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7542" class="String">&quot;: &quot;</a> <a id="7547" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7549" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="7551" class="Symbol">)</a>
  <a id="7555" href="Test.Golden.html#7555" class="Bound">time</a> <a id="7560" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7562" href="System.Clock.html#2491" class="Function">time′</a> <a id="7568" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7570" href="System.Process.html#655" class="Function">callCommand</a> <a id="7582" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7584" href="Data.String.Base.html#2768" class="Function">unwords</a>
           <a id="7603" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7605" class="String">&quot;cd&quot;</a> <a id="7610" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7612" href="Test.Golden.html#7405" class="Bound">testPath</a>
           <a id="7632" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7634" class="String">&quot;&amp;&amp;&quot;</a> <a id="7639" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7641" class="String">&quot;sh ./run&quot;</a> <a id="7652" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7654" class="Symbol">(</a><a id="7655" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="7662" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7664" class="String">&quot;\&quot;&quot;</a> <a id="7669" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7671" href="Test.Golden.html#7400" class="Bound">opts</a> <a id="7676" class="Symbol">.</a><a id="7677" href="Test.Golden.html#4620" class="Field">exeUnderTest</a> <a id="7690" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7692" class="String">&quot;\&quot;&quot;</a> <a id="7697" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7699" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="7701" class="Symbol">)</a>
           <a id="7714" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7716" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7752" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7754" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="7760" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7765" href="Test.Golden.html#7765" class="Bound">out</a> <a id="7769" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7771" href="Test.Golden.html#9205" class="Function">readLocalFile</a> <a id="7785" class="String">&quot;output&quot;</a>
    <a id="7798" class="Keyword">where</a> <a id="7804" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7812" class="Symbol">→</a> <a id="7814" href="Test.Golden.html#9104" class="Function">fail</a> <a id="7819" class="Symbol">(</a><a id="7820" href="Test.Golden.html#8904" class="Function">fileNotFound</a> <a id="7833" class="String">&quot;output&quot;</a><a id="7841" class="Symbol">)</a>
  <a id="7845" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7850" href="Test.Golden.html#7850" class="Bound">exp</a> <a id="7854" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7856" href="Test.Golden.html#9205" class="Function">readLocalFile</a> <a id="7870" class="String">&quot;expected&quot;</a>
    <a id="7885" class="Keyword">where</a> <a id="7891" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7899" class="Symbol">→</a> <a id="7901" class="Keyword">do</a> <a id="7904" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="7907" href="Test.Golden.html#7400" class="Bound">opts</a> <a id="7912" class="Symbol">.</a><a id="7913" href="Test.Golden.html#4772" class="Field">interactive</a>
                         <a id="7950" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="7955" href="Test.Golden.html#9972" class="Function">mayOverwrite</a> <a id="7968" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7976" href="Test.Golden.html#7765" class="Bound">out</a>
                         <a id="8005" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8010" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="8019" class="Symbol">(</a><a id="8020" href="Test.Golden.html#8904" class="Function">fileNotFound</a> <a id="8033" class="String">&quot;expected&quot;</a><a id="8043" class="Symbol">)</a>
                       <a id="8068" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="8073" class="Symbol">(</a><a id="8074" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8079" href="Test.Golden.html#7405" class="Bound">testPath</a><a id="8087" class="Symbol">)</a>

  <a id="8092" class="Keyword">let</a> <a id="8096" href="Test.Golden.html#8096" class="Bound">result</a> <a id="8103" class="Symbol">=</a> <a id="8105" href="Relation.Nullary.Decidable.Core.html#2038" class="Field">does</a> <a id="8110" class="Symbol">(</a><a id="8111" href="Test.Golden.html#7765" class="Bound">out</a> <a id="8115" href="Data.String.Properties.html#2741" class="Function Operator">String.≟</a> <a id="8124" href="Test.Golden.html#7850" class="Bound">exp</a><a id="8127" class="Symbol">)</a>

  <a id="8132" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8135" href="Test.Golden.html#8096" class="Bound">result</a>
    <a id="8146" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8151" href="Test.Golden.html#10788" class="Function">printTiming</a> <a id="8163" class="Symbol">(</a><a id="8164" href="Test.Golden.html#7400" class="Bound">opts</a> <a id="8169" class="Symbol">.</a><a id="8170" href="Test.Golden.html#4840" class="Field">timing</a><a id="8176" class="Symbol">)</a> <a id="8178" href="Test.Golden.html#7555" class="Bound">time</a>
           <a id="8194" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8196" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8199" href="Test.Golden.html#7400" class="Bound">opts</a> <a id="8204" class="Symbol">.</a><a id="8205" href="Test.Golden.html#5010" class="Field">colour</a>
               <a id="8227" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8232" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8244" class="Symbol">(</a><a id="8245" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8255" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8266" href="System.Console.ANSI.html#699" class="InductiveConstructor">classic</a> <a id="8274" href="System.Console.ANSI.html#623" class="InductiveConstructor">green</a><a id="8279" class="Symbol">)</a>
               <a id="8296" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8301" href="Function.Base.html#704" class="Function">id</a>
           <a id="8315" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8317" class="String">&quot;success&quot;</a>
    <a id="8331" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8336" class="Keyword">do</a> <a id="8339" href="Test.Golden.html#10788" class="Function">printTiming</a> <a id="8351" class="Symbol">(</a><a id="8352" href="Test.Golden.html#7400" class="Bound">opts</a> <a id="8357" class="Symbol">.</a><a id="8358" href="Test.Golden.html#4840" class="Field">timing</a><a id="8364" class="Symbol">)</a> <a id="8366" href="Test.Golden.html#7555" class="Bound">time</a>
             <a id="8384" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8386" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8389" href="Test.Golden.html#7400" class="Bound">opts</a> <a id="8394" class="Symbol">.</a><a id="8395" href="Test.Golden.html#5010" class="Field">colour</a>
               <a id="8417" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8422" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8434" class="Symbol">(</a><a id="8435" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8445" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8456" href="System.Console.ANSI.html#707" class="InductiveConstructor">bright</a> <a id="8463" href="System.Console.ANSI.html#619" class="InductiveConstructor">red</a><a id="8466" class="Symbol">)</a>
               <a id="8483" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8488" href="Function.Base.html#704" class="Function">id</a>
             <a id="8504" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8506" class="String">&quot;FAILURE&quot;</a>
            <a id="8528" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8531" href="Test.Golden.html#7400" class="Bound">opts</a> <a id="8536" class="Symbol">.</a><a id="8537" href="Test.Golden.html#4772" class="Field">interactive</a>
              <a id="8563" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8568" href="Test.Golden.html#9972" class="Function">mayOverwrite</a> <a id="8581" class="Symbol">(</a><a id="8582" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8587" href="Test.Golden.html#7850" class="Bound">exp</a><a id="8590" class="Symbol">)</a> <a id="8592" href="Test.Golden.html#7765" class="Bound">out</a>
              <a id="8610" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8615" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="8624" class="Symbol">(</a><a id="8625" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="8633" class="Symbol">(</a><a id="8634" href="Test.Golden.html#9738" class="Function">expVsOut</a> <a id="8643" href="Test.Golden.html#7850" class="Bound">exp</a> <a id="8647" href="Test.Golden.html#7765" class="Bound">out</a><a id="8650" class="Symbol">))</a>

  <a id="8656" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="8661" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8663" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8666" href="Test.Golden.html#8096" class="Bound">result</a> <a id="8673" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8678" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8683" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="8692" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8697" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8702" href="Test.Golden.html#7405" class="Bound">testPath</a>

  <a id="8714" class="Keyword">where</a>

    <a id="8725" href="Test.Golden.html#8725" class="Function">directoryNotFound</a> <a id="8743" class="Symbol">:</a> <a id="8745" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8756" href="Test.Golden.html#8725" class="Function">directoryNotFound</a> <a id="8774" class="Symbol">=</a> <a id="8776" href="Data.String.Base.html#2768" class="Function">unwords</a>
                      <a id="8806" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8808" class="String">&quot;Directory&quot;</a>
                      <a id="8842" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8844" href="Test.Golden.html#7405" class="Bound">testPath</a>
                      <a id="8875" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8877" class="String">&quot;does not exist&quot;</a> <a id="8894" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8896" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="8904" href="Test.Golden.html#8904" class="Function">fileNotFound</a> <a id="8917" class="Symbol">:</a> <a id="8919" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="8926" class="Symbol">→</a> <a id="8928" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8939" href="Test.Golden.html#8904" class="Function">fileNotFound</a> <a id="8952" href="Test.Golden.html#8952" class="Bound">name</a> <a id="8957" class="Symbol">=</a> <a id="8959" href="Data.String.Base.html#2768" class="Function">unwords</a>
                      <a id="8989" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8991" class="String">&quot;File&quot;</a>
                      <a id="9020" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9022" class="Symbol">(</a><a id="9023" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="9032" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="9042" class="String">&quot;/output&quot;</a><a id="9051" class="Symbol">)</a>
                      <a id="9075" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9077" class="String">&quot;does not exist&quot;</a> <a id="9094" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9096" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="9104" href="Test.Golden.html#9104" class="Function">fail</a> <a id="9109" class="Symbol">:</a> <a id="9111" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9118" class="Symbol">→</a> <a id="9120" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="9123" href="Test.Golden.html#7254" class="Function">Result</a>
    <a id="9134" href="Test.Golden.html#9104" class="Function">fail</a> <a id="9139" href="Test.Golden.html#9139" class="Bound">msg</a> <a id="9143" class="Symbol">=</a> <a id="9145" class="Keyword">do</a> <a id="9148" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="9157" href="Test.Golden.html#9139" class="Bound">msg</a>
                  <a id="9179" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9184" class="Symbol">(</a><a id="9185" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="9190" href="Test.Golden.html#7405" class="Bound">testPath</a><a id="9198" class="Symbol">)</a>

    <a id="9205" href="Test.Golden.html#9205" class="Function">readLocalFile</a> <a id="9219" class="Symbol">:</a> <a id="9221" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9228" class="Symbol">→</a> <a id="9230" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="9233" class="Symbol">(</a><a id="9234" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9240" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="9246" class="Symbol">)</a>
    <a id="9252" href="Test.Golden.html#9205" class="Function">readLocalFile</a> <a id="9266" href="Test.Golden.html#9266" class="Bound">name</a> <a id="9271" class="Symbol">=</a> <a id="9273" class="Keyword">do</a>
      <a id="9282" class="Keyword">let</a> <a id="9286" href="Test.Golden.html#9286" class="Bound">fp</a> <a id="9289" class="Symbol">=</a> <a id="9291" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="9298" class="Symbol">(</a><a id="9299" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="9308" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9310" class="String">&quot;/&quot;</a> <a id="9314" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9316" href="Test.Golden.html#9266" class="Bound">name</a> <a id="9321" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9323" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="9325" class="Symbol">)</a>
      <a id="9333" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="9338" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="9340" href="System.Directory.html#3068" class="Function">doesFileExist</a> <a id="9354" class="Symbol">(</a><a id="9355" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a> <a id="9366" href="Test.Golden.html#9286" class="Bound">fp</a><a id="9368" class="Symbol">)</a>
        <a id="9378" class="Keyword">where</a> <a id="9384" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9390" class="Symbol">→</a> <a id="9392" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9397" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
      <a id="9411" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9416" href="IO.Base.html#2098" class="Function Operator">&lt;$&gt;</a> <a id="9420" href="IO.html#2922" class="Function">readFiniteFile</a> <a id="9435" href="Test.Golden.html#9286" class="Bound">fp</a>

    <a id="9443" href="Test.Golden.html#9443" class="Function">getAnswer</a> <a id="9453" class="Symbol">:</a> <a id="9455" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="9458" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="9467" href="Test.Golden.html#9443" class="Function">getAnswer</a> <a id="9477" class="Symbol">=</a> <a id="9479" href="IO.Base.html#4375" class="Function">untilJust</a> <a id="9489" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="9491" class="Keyword">do</a>
      <a id="9500" href="Test.Golden.html#9500" class="Bound">str</a> <a id="9504" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="9506" href="IO.Finite.html#1239" class="Function">getLine</a>
      <a id="9520" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="9525" href="Test.Golden.html#9500" class="Bound">str</a> <a id="9529" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="9532" class="Symbol">λ</a> <a id="9534" class="Keyword">where</a>
        <a id="9548" class="String">&quot;y&quot;</a> <a id="9552" class="Symbol">→</a> <a id="9554" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9559" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="9561" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9566" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
        <a id="9579" class="String">&quot;n&quot;</a> <a id="9583" class="Symbol">→</a> <a id="9585" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9590" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="9592" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9597" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
        <a id="9611" class="String">&quot;&quot;</a>  <a id="9615" class="Symbol">→</a> <a id="9617" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9622" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="9624" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9629" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9635" class="Comment">-- default answer is no</a>
        <a id="9667" class="Symbol">_</a>   <a id="9671" class="Symbol">→</a> <a id="9673" class="Keyword">do</a> <a id="9676" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="9685" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9720" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9725" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

    <a id="9738" href="Test.Golden.html#9738" class="Function">expVsOut</a> <a id="9747" class="Symbol">:</a> <a id="9749" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9756" class="Symbol">→</a> <a id="9758" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9765" class="Symbol">→</a> <a id="9767" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9772" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="9783" href="Test.Golden.html#9738" class="Function">expVsOut</a> <a id="9792" href="Test.Golden.html#9792" class="Bound">exp</a> <a id="9796" href="Test.Golden.html#9796" class="Bound">out</a> <a id="9800" class="Symbol">=</a> <a id="9802" class="String">&quot;Expected:&quot;</a> <a id="9814" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9816" href="Test.Golden.html#9792" class="Bound">exp</a> <a id="9820" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9822" class="String">&quot;Given:&quot;</a> <a id="9831" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9833" href="Test.Golden.html#9796" class="Bound">out</a> <a id="9837" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9839" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="9847" href="Test.Golden.html#9847" class="Function">hasFailed</a> <a id="9857" class="Symbol">:</a> <a id="9859" href="System.Exit.Primitive.html#402" class="Datatype">ExitCode</a> <a id="9868" class="Symbol">→</a> <a id="9870" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="9879" href="Test.Golden.html#9847" class="Function">hasFailed</a> <a id="9889" href="System.Exit.Primitive.html#425" class="InductiveConstructor">ExitSuccess</a>        <a id="9908" class="Symbol">=</a> <a id="9910" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
    <a id="9920" href="Test.Golden.html#9847" class="Function">hasFailed</a> <a id="9930" class="Symbol">(</a><a id="9931" href="System.Exit.Primitive.html#450" class="InductiveConstructor">ExitFailure</a> <a id="9943" href="Test.Golden.html#9943" class="Bound">code</a><a id="9947" class="Symbol">)</a> <a id="9949" class="Symbol">=</a> <a id="9951" href="Test.Golden.html#9943" class="Bound">code</a> <a id="9956" href="Data.Integer.Base.html#2628" class="Function Operator">ℤ.≤ᵇ</a> <a id="9961" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="9965" class="Number">0</a>

    <a id="9972" href="Test.Golden.html#9972" class="Function">mayOverwrite</a> <a id="9985" class="Symbol">:</a> <a id="9987" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9993" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="10000" class="Symbol">→</a> <a id="10002" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="10009" class="Symbol">→</a> <a id="10011" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="10014" class="Symbol">_</a>
    <a id="10020" href="Test.Golden.html#9972" class="Function">mayOverwrite</a> <a id="10033" href="Test.Golden.html#10033" class="Bound">mexp</a> <a id="10038" href="Test.Golden.html#10038" class="Bound">out</a> <a id="10042" class="Symbol">=</a> <a id="10044" class="Keyword">do</a>
      <a id="10053" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="10058" href="Test.Golden.html#10033" class="Bound">mexp</a> <a id="10063" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="10066" class="Symbol">λ</a> <a id="10068" class="Keyword">where</a>
        <a id="10082" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="10090" class="Symbol">→</a> <a id="10092" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="10101" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10103" href="Data.String.Base.html#2826" class="Function">unlines</a>
          <a id="10121" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10123" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="10190" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10192" href="Test.Golden.html#10038" class="Bound">out</a>
          <a id="10206" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10208" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10251" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10253" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
        <a id="10264" class="Symbol">(</a><a id="10265" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="10270" href="Test.Golden.html#10270" class="Bound">exp</a><a id="10273" class="Symbol">)</a> <a id="10275" class="Symbol">→</a> <a id="10277" class="Keyword">do</a>
          <a id="10290" href="Test.Golden.html#10290" class="Bound">code</a> <a id="10295" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="10297" href="System.Process.html#735" class="Function">system</a> <a id="10304" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10306" href="Data.String.Base.html#2613" class="Function">concat</a>
            <a id="10325" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10327" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10392" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10394" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="10403" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10405" class="String">&quot;/expected &quot;</a>
            <a id="10430" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10432" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="10441" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10443" class="String">&quot;/output&quot;</a>
            <a id="10465" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10467" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
          <a id="10480" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="10489" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10491" href="Data.String.Base.html#2826" class="Function">unlines</a>
            <a id="10511" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10513" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10567" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10569" class="Symbol">(</a><a id="10570" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="10573" href="Test.Golden.html#9847" class="Function">hasFailed</a> <a id="10583" href="Test.Golden.html#10290" class="Bound">code</a> <a id="10588" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="10593" href="Test.Golden.html#9738" class="Function">expVsOut</a> <a id="10602" href="Test.Golden.html#10270" class="Bound">exp</a> <a id="10606" href="Test.Golden.html#10038" class="Bound">out</a> <a id="10610" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="10615" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10617" class="Symbol">)</a>
            <a id="10631" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="10634" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10695" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10697" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="10707" href="Test.Golden.html#10707" class="Bound">b</a> <a id="10709" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="10711" href="Test.Golden.html#9443" class="Function">getAnswer</a>
      <a id="10727" href="IO.Base.html#3580" class="Function">when</a> <a id="10732" href="Test.Golden.html#10707" class="Bound">b</a> <a id="10734" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10736" href="IO.Finite.html#1470" class="Function">writeFile</a> <a id="10746" class="Symbol">(</a><a id="10747" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="10756" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="10766" class="String">&quot;/expected&quot;</a><a id="10777" class="Symbol">)</a> <a id="10779" href="Test.Golden.html#10038" class="Bound">out</a>

    <a id="10788" href="Test.Golden.html#10788" class="Function">printTiming</a> <a id="10800" class="Symbol">:</a> <a id="10802" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="10807" class="Symbol">→</a> <a id="10809" href="System.Clock.html#1646" class="Record">Time</a> <a id="10814" class="Symbol">→</a> <a id="10816" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="10823" class="Symbol">→</a> <a id="10825" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="10828" class="Symbol">_</a>
    <a id="10834" href="Test.Golden.html#10788" class="Function">printTiming</a> <a id="10846" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="10852" class="Symbol">_</a>    <a id="10857" href="Test.Golden.html#10857" class="Bound">msg</a> <a id="10861" class="Symbol">=</a> <a id="10863" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="10872" href="Test.Golden.html#10857" class="Bound">msg</a>
    <a id="10880" href="Test.Golden.html#10788" class="Function">printTiming</a> <a id="10892" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>  <a id="10898" href="Test.Golden.html#10898" class="Bound">time</a> <a id="10903" href="Test.Golden.html#10903" class="Bound">msg</a> <a id="10907" class="Symbol">=</a>
      <a id="10915" class="Keyword">let</a> <a id="10919" href="Test.Golden.html#10919" class="Bound">time</a>  <a id="10925" class="Symbol">=</a> <a id="10927" href="Data.Nat.Show.html#2025" class="Function">ℕ.show</a> <a id="10934" class="Symbol">(</a><a id="10935" href="Test.Golden.html#10898" class="Bound">time</a> <a id="10940" class="Symbol">.</a><a id="10941" href="System.Clock.html#1692" class="Field">seconds</a><a id="10948" class="Symbol">)</a> <a id="10950" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="10960" class="String">&quot;s&quot;</a>
          <a id="10974" href="Test.Golden.html#10974" class="Bound">spent</a> <a id="10980" class="Symbol">=</a> <a id="10982" class="Number">9</a> <a id="10984" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="10986" href="Data.Nat.ListAction.html#612" class="Function">sum</a> <a id="10990" class="Symbol">(</a><a id="10991" href="Data.List.Base.html#1612" class="Function">List.map</a> <a id="11000" href="Data.String.Base.html#2489" class="Function">String.length</a> <a id="11014" class="Symbol">(</a><a id="11015" href="Test.Golden.html#7405" class="Bound">testPath</a> <a id="11024" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11026" href="Test.Golden.html#10919" class="Bound">time</a> <a id="11031" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11033" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="11035" class="Symbol">))</a>
               <a id="11053" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="11129" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11212" href="Test.Golden.html#11212" class="Bound">pad</a>   <a id="11218" class="Symbol">=</a> <a id="11220" href="Data.String.Base.html#2540" class="Function">String.replicate</a> <a id="11237" class="Symbol">(</a><a id="11238" class="Number">72</a> <a id="11241" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="11243" href="Test.Golden.html#10974" class="Bound">spent</a><a id="11248" class="Symbol">)</a> <a id="11250" class="String">&#39; &#39;</a>
      <a id="11260" class="Keyword">in</a> <a id="11263" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="11272" class="Symbol">(</a><a id="11273" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="11280" class="Symbol">(</a><a id="11281" href="Test.Golden.html#10903" class="Bound">msg</a> <a id="11285" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11287" href="Test.Golden.html#11212" class="Bound">pad</a> <a id="11291" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11293" href="Test.Golden.html#10919" class="Bound">time</a> <a id="11298" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11300" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="11302" class="Symbol">))</a>

<a id="11306" class="Comment">-- A test pool is characterised by</a>
<a id="11341" class="Comment">--  + a name</a>
<a id="11354" class="Comment">--  + and a list of directory paths</a>
<a id="11390" class="Keyword">record</a> <a id="TestPool"></a><a id="11397" href="Test.Golden.html#11397" class="Record">TestPool</a> <a id="11406" class="Symbol">:</a> <a id="11408" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="11412" class="Keyword">where</a>
  <a id="11420" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11432" href="Test.Golden.html#11432" class="InductiveConstructor">mkTestPool</a>
  <a id="11445" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11455" href="Test.Golden.html#11455" class="Field">poolName</a> <a id="11464" class="Symbol">:</a> <a id="11466" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11477" href="Test.Golden.html#11477" class="Field">testCases</a> <a id="11487" class="Symbol">:</a> <a id="11489" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11494" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="11501" class="Keyword">open</a> <a id="11506" href="Test.Golden.html#11397" class="Module">TestPool</a>

<a id="11516" class="Keyword">module</a> <a id="Summary"></a><a id="11523" href="Test.Golden.html#11523" class="Module">Summary</a> <a id="11531" class="Keyword">where</a>

  <a id="11540" class="Comment">-- The summary of a test pool run</a>
  <a id="11576" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11583" href="Test.Golden.html#11583" class="Record">Summary</a> <a id="11591" class="Symbol">:</a> <a id="11593" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="11597" class="Keyword">where</a>
    <a id="11607" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11619" href="Test.Golden.html#11619" class="InductiveConstructor">mkSummary</a>
    <a id="11633" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11645" href="Test.Golden.html#11645" class="Field">success</a> <a id="11653" class="Symbol">:</a> <a id="11655" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11660" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11673" href="Test.Golden.html#11673" class="Field">failure</a> <a id="11681" class="Symbol">:</a> <a id="11683" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11688" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="11697" class="Keyword">open</a> <a id="11702" href="Test.Golden.html#11583" class="Module">Summary</a> <a id="11710" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11720" href="Test.Golden.html#11720" class="Function">init</a> <a id="11725" class="Symbol">:</a> <a id="11727" href="Test.Golden.html#11583" class="Record">Summary</a>
  <a id="11737" href="Test.Golden.html#11720" class="Function">init</a> <a id="11742" class="Symbol">=</a> <a id="11744" href="Test.Golden.html#11619" class="InductiveConstructor">mkSummary</a> <a id="11754" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="11757" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11763" href="Test.Golden.html#11763" class="Function">merge</a> <a id="11769" class="Symbol">:</a> <a id="11771" href="Test.Golden.html#11583" class="Record">Summary</a> <a id="11779" class="Symbol">→</a> <a id="11781" href="Test.Golden.html#11583" class="Record">Summary</a> <a id="11789" class="Symbol">→</a> <a id="11791" href="Test.Golden.html#11583" class="Record">Summary</a>
  <a id="11801" href="Test.Golden.html#11763" class="Function">merge</a> <a id="11807" class="Symbol">(</a><a id="11808" href="Test.Golden.html#11619" class="InductiveConstructor">mkSummary</a> <a id="11818" href="Test.Golden.html#11818" class="Bound">ws1</a> <a id="11822" href="Test.Golden.html#11822" class="Bound">ls1</a><a id="11825" class="Symbol">)</a> <a id="11827" class="Symbol">(</a><a id="11828" href="Test.Golden.html#11619" class="InductiveConstructor">mkSummary</a> <a id="11838" href="Test.Golden.html#11838" class="Bound">ws2</a> <a id="11842" href="Test.Golden.html#11842" class="Bound">ls2</a><a id="11845" class="Symbol">)</a> <a id="11847" class="Symbol">=</a>
   <a id="11852" href="Test.Golden.html#11619" class="InductiveConstructor">mkSummary</a> <a id="11862" class="Symbol">(</a><a id="11863" href="Test.Golden.html#11838" class="Bound">ws2</a> <a id="11867" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="11870" href="Test.Golden.html#11818" class="Bound">ws1</a><a id="11873" class="Symbol">)</a> <a id="11875" class="Symbol">(</a><a id="11876" href="Test.Golden.html#11842" class="Bound">ls2</a> <a id="11880" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="11883" href="Test.Golden.html#11822" class="Bound">ls1</a><a id="11886" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11891" href="Test.Golden.html#11891" class="Function">update</a> <a id="11898" class="Symbol">:</a> <a id="11900" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11905" href="Test.Golden.html#7254" class="Function">Result</a> <a id="11912" class="Symbol">→</a> <a id="11914" href="Test.Golden.html#11583" class="Record">Summary</a> <a id="11922" class="Symbol">→</a> <a id="11924" href="Test.Golden.html#11583" class="Record">Summary</a>
  <a id="11934" href="Test.Golden.html#11891" class="Function">update</a> <a id="11941" href="Test.Golden.html#11941" class="Bound">res</a> <a id="11945" href="Test.Golden.html#11945" class="Bound">sum</a> <a id="11949" class="Symbol">=</a>
    <a id="11955" class="Keyword">let</a> <a id="11959" class="Symbol">(</a><a id="11960" href="Test.Golden.html#11960" class="Bound">ls2</a> <a id="11964" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11966" href="Test.Golden.html#11966" class="Bound">ws2</a><a id="11969" class="Symbol">)</a> <a id="11971" class="Symbol">=</a> <a id="11973" href="Data.List.Base.html#3674" class="Function">partitionSums</a> <a id="11987" href="Test.Golden.html#11941" class="Bound">res</a> <a id="11991" class="Keyword">in</a>
    <a id="11998" href="Test.Golden.html#11763" class="Function">merge</a> <a id="12004" href="Test.Golden.html#11945" class="Bound">sum</a> <a id="12008" class="Symbol">(</a><a id="12009" href="Test.Golden.html#11619" class="InductiveConstructor">mkSummary</a> <a id="12019" href="Test.Golden.html#11966" class="Bound">ws2</a> <a id="12023" href="Test.Golden.html#11960" class="Bound">ls2</a><a id="12026" class="Symbol">)</a>

<a id="12029" class="Keyword">open</a> <a id="12034" href="Test.Golden.html#11523" class="Module">Summary</a> <a id="12042" class="Keyword">using</a> <a id="12048" class="Symbol">(</a><a id="12049" href="Test.Golden.html#11583" class="Record">Summary</a><a id="12056" class="Symbol">)</a> <a id="12058" class="Keyword">hiding</a> <a id="12065" class="Symbol">(</a><a id="12066" class="Keyword">module</a> <a id="12073" href="Test.Golden.html#11583" class="Module">Summary</a><a id="12080" class="Symbol">)</a>

<a id="12083" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="12131" href="Test.Golden.html#12131" class="Function">filterTests</a> <a id="12143" class="Symbol">:</a> <a id="12145" href="Test.Golden.html#4540" class="Record">Options</a> <a id="12153" class="Symbol">→</a> <a id="12155" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12160" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="12167" class="Symbol">→</a> <a id="12169" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12174" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="12181" href="Test.Golden.html#12131" class="Function">filterTests</a> <a id="12193" href="Test.Golden.html#12193" class="Bound">opts</a> <a id="12198" class="Symbol">=</a> <a id="12200" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="12205" href="Test.Golden.html#4693" class="Field">onlyNames</a> <a id="12215" href="Test.Golden.html#12193" class="Bound">opts</a> <a id="12220" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="12223" class="Symbol">λ</a> <a id="12225" class="Keyword">where</a>
  <a id="12233" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12236" class="Symbol">→</a> <a id="12238" href="Function.Base.html#704" class="Function">id</a>
  <a id="12243" href="Test.Golden.html#12243" class="CatchallClause Bound">xs</a> <a id="12246" class="Symbol">→</a> <a id="12248" class="Keyword">let</a> <a id="12252" href="Test.Golden.html#12252" class="Bound">names</a> <a id="12258" class="Symbol">=</a> <a id="12260" href="Data.List.Base.html#1612" class="Function">List.map</a> <a id="12269" href="Data.String.Base.html#1558" class="Primitive">String.toList</a> <a id="12283" href="Test.Golden.html#12243" class="Bound">xs</a> <a id="12286" class="Keyword">in</a>
       <a id="12296" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="12303" class="Symbol">(λ</a> <a id="12306" href="Test.Golden.html#12306" class="Bound">n</a> <a id="12308" class="Symbol">→</a> <a id="12310" href="Data.List.Relation.Unary.Any.html#2691" class="Function">any?</a> <a id="12315" class="Symbol">(λ</a> <a id="12318" href="Test.Golden.html#12318" class="Bound">m</a> <a id="12320" class="Symbol">→</a> <a id="12322" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6760" class="Function">infix?</a> <a id="12329" href="Data.Char.Properties.html#2550" class="Function Operator">Char._≟_</a> <a id="12338" href="Test.Golden.html#12318" class="Bound">m</a> <a id="12340" class="Symbol">(</a><a id="12341" href="Data.String.Base.html#1558" class="Primitive">String.toList</a> <a id="12355" href="Test.Golden.html#12306" class="Bound">n</a><a id="12356" class="Symbol">))</a> <a id="12359" href="Test.Golden.html#12252" class="Bound">names</a><a id="12364" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12367" href="Test.Golden.html#12367" class="Function">poolRunner</a> <a id="12378" class="Symbol">:</a> <a id="12380" href="Test.Golden.html#4540" class="Record">Options</a> <a id="12388" class="Symbol">→</a> <a id="12390" href="Test.Golden.html#11397" class="Record">TestPool</a> <a id="12399" class="Symbol">→</a> <a id="12401" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="12404" href="Test.Golden.html#11583" class="Record">Summary</a>
<a id="12412" href="Test.Golden.html#12367" class="Function">poolRunner</a> <a id="12423" href="Test.Golden.html#12423" class="Bound">opts</a> <a id="12428" href="Test.Golden.html#12428" class="Bound">pool</a> <a id="12433" class="Symbol">=</a> <a id="12435" class="Keyword">do</a>
  <a id="12440" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12501" class="Keyword">let</a> <a id="12505" href="Test.Golden.html#12505" class="Bound">tests</a> <a id="12511" class="Symbol">=</a> <a id="12513" href="Test.Golden.html#12131" class="Function">filterTests</a> <a id="12525" href="Test.Golden.html#12423" class="Bound">opts</a> <a id="12530" class="Symbol">(</a><a id="12531" href="Test.Golden.html#12428" class="Bound">pool</a> <a id="12536" class="Symbol">.</a><a id="12537" href="Test.Golden.html#11477" class="Field">testCases</a><a id="12546" class="Symbol">)</a>
  <a id="12550" class="Symbol">(_</a> <a id="12553" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12555" class="Symbol">_)</a> <a id="12558" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="12560" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="12565" href="Test.Golden.html#12505" class="Bound">tests</a>
    <a id="12575" class="Keyword">where</a> <a id="12581" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12584" class="Symbol">→</a> <a id="12586" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="12591" href="Test.Golden.html#11720" class="Function">Summary.init</a>

  <a id="12607" class="Comment">-- announce the test pool and run them</a>
  <a id="12648" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="12657" href="Test.Golden.html#12762" class="Function">banner</a>
  <a id="12666" href="Test.Golden.html#12892" class="Function">loop</a> <a id="12671" href="Test.Golden.html#11720" class="Function">Summary.init</a> <a id="12684" href="Test.Golden.html#12505" class="Bound">tests</a>

  <a id="12693" class="Keyword">where</a>

  <a id="12702" href="Test.Golden.html#12702" class="Function">separator</a> <a id="12712" class="Symbol">:</a> <a id="12714" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="12723" href="Test.Golden.html#12702" class="Function">separator</a> <a id="12733" class="Symbol">=</a> <a id="12735" href="Data.String.Base.html#2540" class="Function">String.replicate</a> <a id="12752" class="Number">72</a> <a id="12755" class="String">&#39;-&#39;</a>

  <a id="12762" href="Test.Golden.html#12762" class="Function">banner</a> <a id="12769" class="Symbol">:</a> <a id="12771" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="12780" href="Test.Golden.html#12762" class="Function">banner</a> <a id="12787" class="Symbol">=</a> <a id="12789" href="Data.String.Base.html#2826" class="Function">unlines</a>
         <a id="12806" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="12808" class="String">&quot;&quot;</a> <a id="12811" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12813" href="Test.Golden.html#12702" class="Function">separator</a>
         <a id="12832" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12834" href="Test.Golden.html#12428" class="Bound">pool</a> <a id="12839" class="Symbol">.</a><a id="12840" href="Test.Golden.html#11455" class="Field">poolName</a>
         <a id="12858" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12860" href="Test.Golden.html#12702" class="Function">separator</a> <a id="12870" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12872" class="String">&quot;&quot;</a>
         <a id="12884" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12886" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="12892" href="Test.Golden.html#12892" class="Function">loop</a> <a id="12897" class="Symbol">:</a> <a id="12899" href="Test.Golden.html#11583" class="Record">Summary</a> <a id="12907" class="Symbol">→</a> <a id="12909" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12914" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="12921" class="Symbol">→</a> <a id="12923" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="12926" href="Test.Golden.html#11583" class="Record">Summary</a>
  <a id="12936" href="Test.Golden.html#12892" class="Function">loop</a> <a id="12941" href="Test.Golden.html#12941" class="Bound">acc</a> <a id="12945" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12948" class="Symbol">=</a> <a id="12950" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="12955" href="Test.Golden.html#12941" class="Bound">acc</a>
  <a id="12961" href="Test.Golden.html#12892" class="Function">loop</a> <a id="12966" href="Test.Golden.html#12966" class="Bound">acc</a> <a id="12970" class="Symbol">(</a><a id="12971" href="Test.Golden.html#12971" class="Bound">test</a> <a id="12976" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12978" href="Test.Golden.html#12978" class="Bound">tests</a><a id="12983" class="Symbol">)</a> <a id="12985" class="Symbol">=</a> <a id="12987" class="Keyword">do</a>
    <a id="12994" href="Test.Golden.html#12994" class="Bound">res</a> <a id="12998" href="IO.Base.html#2209" class="Function Operator">&lt;-</a> <a id="13001" href="Test.Golden.html#7353" class="Function">runTest</a> <a id="13009" href="Test.Golden.html#12423" class="Bound">opts</a> <a id="13014" href="Test.Golden.html#12971" class="Bound">test</a>
    <a id="13023" href="Test.Golden.html#12892" class="Function">loop</a> <a id="13028" class="Symbol">(</a><a id="13029" href="Test.Golden.html#11891" class="Function">Summary.update</a> <a id="13044" class="Symbol">(</a><a id="13045" href="Test.Golden.html#12994" class="Bound">res</a> <a id="13049" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13051" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="13053" class="Symbol">)</a> <a id="13055" href="Test.Golden.html#12966" class="Bound">acc</a><a id="13058" class="Symbol">)</a> <a id="13060" href="Test.Golden.html#12978" class="Bound">tests</a>

<a id="runner"></a><a id="13067" href="Test.Golden.html#13067" class="Function">runner</a> <a id="13074" class="Symbol">:</a> <a id="13076" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="13081" href="Test.Golden.html#11397" class="Record">TestPool</a> <a id="13090" class="Symbol">→</a> <a id="13092" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="13095" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="13097" href="Test.Golden.html#13067" class="Function">runner</a> <a id="13104" href="Test.Golden.html#13104" class="Bound">tests</a> <a id="13110" class="Symbol">=</a> <a id="13112" class="Keyword">do</a>
  <a id="13117" href="IO.Handle.html#898" class="Function">hSetBuffering</a> <a id="13131" href="IO.Primitive.Handle.html#1565" class="Postulate">stdout</a> <a id="13138" href="IO.Primitive.Handle.html#500" class="InductiveConstructor">noBuffering</a>
  <a id="13152" class="Comment">-- figure out the options</a>
  <a id="13180" href="Test.Golden.html#13180" class="Bound">args</a> <a id="13185" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="13187" href="System.Environment.html#660" class="Function">getArgs</a>
  <a id="13197" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="13202" href="Test.Golden.html#13202" class="Bound">opts</a> <a id="13207" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="13209" href="Test.Golden.html#5728" class="Function">options</a> <a id="13217" href="Test.Golden.html#13180" class="Bound">args</a>
    <a id="13226" class="Keyword">where</a> <a id="13232" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="13237" href="Test.Golden.html#13237" class="Bound">err</a> <a id="13241" class="Symbol">→</a> <a id="13243" href="System.Exit.html#1366" class="Function">die</a> <a id="13247" class="Symbol">(</a><a id="13248" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="13256" class="Symbol">(</a><a id="13257" href="Test.Golden.html#5541" class="Function">show</a> <a id="13262" href="Test.Golden.html#13237" class="Bound">err</a> <a id="13266" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13268" href="Test.Golden.html#5245" class="Function">usage</a> <a id="13274" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13276" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="13278" class="Symbol">))</a>

  <a id="13284" class="Comment">-- run the tests</a>
  <a id="13303" href="Test.Golden.html#13303" class="Bound">ress</a> <a id="13308" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="13310" href="IO.html#2094" class="Function">List.mapM</a> <a id="13320" class="Symbol">(</a><a id="13321" href="Test.Golden.html#12367" class="Function">poolRunner</a> <a id="13332" href="Test.Golden.html#13202" class="Bound">opts</a><a id="13336" class="Symbol">)</a> <a id="13338" href="Test.Golden.html#13104" class="Bound">tests</a>
  <a id="13346" class="Keyword">let</a> <a id="13350" class="Keyword">open</a> <a id="13355" href="Test.Golden.html#11523" class="Module">Summary</a>
  <a id="13365" class="Keyword">let</a> <a id="13369" href="Test.Golden.html#13369" class="Bound">res</a> <a id="13373" class="Symbol">=</a> <a id="13375" href="Data.List.Base.html#4227" class="Function">List.foldl</a> <a id="13386" href="Test.Golden.html#11763" class="Function">merge</a> <a id="13392" href="Test.Golden.html#11720" class="Function">init</a> <a id="13397" href="Test.Golden.html#13303" class="Bound">ress</a>

  <a id="13405" class="Comment">-- report the result</a>
  <a id="13428" class="Keyword">let</a> <a id="13432" href="Test.Golden.html#13432" class="Bound">nsucc</a> <a id="13438" class="Symbol">=</a> <a id="13440" href="Data.List.Base.html#4746" class="Function">List.length</a> <a id="13452" class="Symbol">(</a><a id="13453" href="Test.Golden.html#13369" class="Bound">res</a> <a id="13457" class="Symbol">.</a><a id="13458" href="Test.Golden.html#11645" class="Field">success</a><a id="13465" class="Symbol">)</a>
  <a id="13469" class="Keyword">let</a> <a id="13473" href="Test.Golden.html#13473" class="Bound">nfail</a> <a id="13479" class="Symbol">=</a> <a id="13481" href="Data.List.Base.html#4746" class="Function">List.length</a> <a id="13493" class="Symbol">(</a><a id="13494" href="Test.Golden.html#13369" class="Bound">res</a> <a id="13498" class="Symbol">.</a><a id="13499" href="Test.Golden.html#11673" class="Field">failure</a><a id="13506" class="Symbol">)</a>
  <a id="13510" class="Keyword">let</a> <a id="13514" href="Test.Golden.html#13514" class="Bound">ntotal</a> <a id="13521" class="Symbol">=</a> <a id="13523" href="Test.Golden.html#13432" class="Bound">nsucc</a> <a id="13529" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="13531" href="Test.Golden.html#13473" class="Bound">nfail</a>
  <a id="13539" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="13548" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13550" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="13557" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13559" href="Data.Nat.Show.html#2025" class="Function">ℕ.show</a> <a id="13566" href="Test.Golden.html#13432" class="Bound">nsucc</a> <a id="13572" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13574" class="String">&quot;/&quot;</a> <a id="13578" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13580" href="Data.Nat.Show.html#2025" class="Function">ℕ.show</a> <a id="13587" href="Test.Golden.html#13514" class="Bound">ntotal</a> <a id="13594" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13596" class="String">&quot; tests successful&quot;</a> <a id="13616" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13618" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="13624" class="Comment">-- deal with failures</a>
  <a id="13648" class="Keyword">let</a> <a id="13652" href="Test.Golden.html#13652" class="Bound">list</a> <a id="13657" class="Symbol">=</a> <a id="13659" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="13667" class="Symbol">(</a><a id="13668" href="Test.Golden.html#13369" class="Bound">res</a> <a id="13672" class="Symbol">.</a><a id="13673" href="Test.Golden.html#11673" class="Field">failure</a><a id="13680" class="Symbol">)</a>
  <a id="13684" href="IO.Base.html#3580" class="Function">when</a> <a id="13689" class="Symbol">(</a><a id="13690" class="Number">0</a> <a id="13692" href="Data.Nat.Base.html#1463" class="Primitive Operator">&lt;ᵇ</a> <a id="13695" href="Test.Golden.html#13473" class="Bound">nfail</a><a id="13700" class="Symbol">)</a> <a id="13702" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13704" class="Keyword">do</a>
    <a id="13711" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="13720" class="String">&quot;Failing tests:&quot;</a>
    <a id="13741" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="13750" href="Test.Golden.html#13652" class="Bound">list</a>
  <a id="13757" href="IO.Base.html#3810" class="Function">whenJust</a> <a id="13766" class="Symbol">(</a><a id="13767" href="Test.Golden.html#13202" class="Bound">opts</a> <a id="13772" class="Symbol">.</a><a id="13773" href="Test.Golden.html#4918" class="Field">failureFile</a><a id="13784" class="Symbol">)</a> <a id="13786" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13788" class="Symbol">λ</a> <a id="13790" href="Test.Golden.html#13790" class="Bound">fp</a> <a id="13793" class="Symbol">→</a> <a id="13795" href="IO.Finite.html#1470" class="Function">writeFile</a> <a id="13805" href="Test.Golden.html#13790" class="Bound">fp</a> <a id="13808" href="Test.Golden.html#13652" class="Bound">list</a>

  <a id="13816" class="Comment">-- exit</a>
  <a id="13826" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="13829" class="Number">0</a> <a id="13831" href="Data.Nat.Base.html#1289" class="Primitive Operator">≡ᵇ</a> <a id="13834" href="Test.Golden.html#13473" class="Bound">nfail</a>
   <a id="13843" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="13848" href="System.Exit.html#1311" class="Function">exitSuccess</a>
   <a id="13863" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="13868" href="System.Exit.html#1248" class="Function">exitFailure</a>
</pre></body></html>