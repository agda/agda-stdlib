<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Codata.M</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- M-types (the dual of W-types)</a>
<a id="139" class="Comment">------------------------------------------------------------------------</a>

<a id="213" class="Keyword">module</a> <a id="220" href="Codata.M.html" class="Module">Codata.M</a> <a id="229" class="Keyword">where</a>

<a id="236" class="Keyword">open</a> <a id="241" class="Keyword">import</a> <a id="248" href="Size.html" class="Module">Size</a>
<a id="253" class="Keyword">open</a> <a id="258" class="Keyword">import</a> <a id="265" href="Level.html" class="Module">Level</a>
<a id="271" class="Keyword">open</a> <a id="276" class="Keyword">import</a> <a id="283" href="Codata.Thunk.html" class="Module">Codata.Thunk</a> <a id="296" class="Keyword">using</a> <a id="302" class="Symbol">(</a><a id="303" href="Codata.Thunk.html#418" class="Record">Thunk</a><a id="308" class="Symbol">;</a> <a id="310" href="Codata.Thunk.html#494" class="Field">force</a><a id="315" class="Symbol">)</a>
<a id="317" class="Keyword">open</a> <a id="322" class="Keyword">import</a> <a id="329" href="Data.Product.html" class="Module">Data.Product</a> <a id="342" class="Keyword">hiding</a> <a id="349" class="Symbol">(</a><a id="350" href="Data.Product.html#2154" class="Function">map</a><a id="353" class="Symbol">)</a>
<a id="355" class="Keyword">open</a> <a id="360" class="Keyword">import</a> <a id="367" href="Data.Container.Core.html" class="Module">Data.Container.Core</a>
<a id="387" class="Keyword">import</a> <a id="394" href="Data.Container.html" class="Module">Data.Container</a> <a id="409" class="Symbol">as</a> <a id="412" class="Module">C</a>

<a id="415" class="Keyword">data</a> <a id="M"></a><a id="420" href="Codata.M.html#420" class="Datatype">M</a> <a id="422" class="Symbol">{</a><a id="423" href="Codata.M.html#423" class="Bound">s</a> <a id="425" href="Codata.M.html#425" class="Bound">p</a><a id="426" class="Symbol">}</a> <a id="428" class="Symbol">(</a><a id="429" href="Codata.M.html#429" class="Bound">C</a> <a id="431" class="Symbol">:</a> <a id="433" href="Data.Container.Core.html#386" class="Record">Container</a> <a id="443" href="Codata.M.html#423" class="Bound">s</a> <a id="445" href="Codata.M.html#425" class="Bound">p</a><a id="446" class="Symbol">)</a> <a id="448" class="Symbol">(</a><a id="449" href="Codata.M.html#449" class="Bound">i</a> <a id="451" class="Symbol">:</a> <a id="453" href="Agda.Builtin.Size.html#114" class="Postulate">Size</a><a id="457" class="Symbol">)</a> <a id="459" class="Symbol">:</a> <a id="461" class="PrimitiveType">Set</a> <a id="465" class="Symbol">(</a><a id="466" href="Codata.M.html#423" class="Bound">s</a> <a id="468" href="Agda.Primitive.html#657" class="Primitive Operator">⊔</a> <a id="470" href="Codata.M.html#425" class="Bound">p</a><a id="471" class="Symbol">)</a> <a id="473" class="Keyword">where</a>
  <a id="M.inf"></a><a id="481" href="Codata.M.html#481" class="InductiveConstructor">inf</a> <a id="485" class="Symbol">:</a> <a id="487" href="Data.Container.Core.html#576" class="Function Operator">⟦</a> <a id="489" href="Codata.M.html#429" class="Bound">C</a> <a id="491" href="Data.Container.Core.html#576" class="Function Operator">⟧</a> <a id="493" class="Symbol">(</a><a id="494" href="Codata.Thunk.html#418" class="Record">Thunk</a> <a id="500" class="Symbol">(</a><a id="501" href="Codata.M.html#420" class="Datatype">M</a> <a id="503" href="Codata.M.html#429" class="Bound">C</a><a id="504" class="Symbol">)</a> <a id="506" href="Codata.M.html#449" class="Bound">i</a><a id="507" class="Symbol">)</a> <a id="509" class="Symbol">→</a> <a id="511" href="Codata.M.html#420" class="Datatype">M</a> <a id="513" href="Codata.M.html#429" class="Bound">C</a> <a id="515" href="Codata.M.html#449" class="Bound">i</a>

<a id="518" class="Keyword">module</a> <a id="525" href="Codata.M.html#525" class="Module">_</a> <a id="527" class="Symbol">{</a><a id="528" href="Codata.M.html#528" class="Bound">s</a> <a id="530" href="Codata.M.html#530" class="Bound">p</a><a id="531" class="Symbol">}</a> <a id="533" class="Symbol">{</a><a id="534" href="Codata.M.html#534" class="Bound">C</a> <a id="536" class="Symbol">:</a> <a id="538" href="Data.Container.Core.html#386" class="Record">Container</a> <a id="548" href="Codata.M.html#528" class="Bound">s</a> <a id="550" href="Codata.M.html#530" class="Bound">p</a><a id="551" class="Symbol">}</a> <a id="553" class="Symbol">(</a><a id="554" class="Keyword">open</a> <a id="559" href="Data.Container.Core.html#386" class="Module">Container</a> <a id="569" href="Codata.M.html#534" class="Bound">C</a><a id="570" class="Symbol">)</a> <a id="572" class="Keyword">where</a>

  <a id="581" href="Codata.M.html#581" class="Function">head</a> <a id="586" class="Symbol">:</a> <a id="588" class="Symbol">∀</a> <a id="590" class="Symbol">{</a><a id="591" href="Codata.M.html#591" class="Bound">i</a><a id="592" class="Symbol">}</a> <a id="594" class="Symbol">→</a> <a id="596" href="Codata.M.html#420" class="Datatype">M</a> <a id="598" href="Codata.M.html#534" class="Bound">C</a> <a id="600" href="Codata.M.html#591" class="Bound">i</a> <a id="602" class="Symbol">→</a> <a id="604" href="Data.Container.Core.html#466" class="Field">Shape</a>
  <a id="612" href="Codata.M.html#581" class="Function">head</a> <a id="617" class="Symbol">(</a><a id="618" href="Codata.M.html#481" class="InductiveConstructor">inf</a> <a id="622" class="Symbol">(</a><a id="623" href="Codata.M.html#623" class="Bound">x</a> <a id="625" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="627" href="Codata.M.html#627" class="Bound">f</a><a id="628" class="Symbol">))</a> <a id="631" class="Symbol">=</a> <a id="633" href="Codata.M.html#623" class="Bound">x</a>

  <a id="638" href="Codata.M.html#638" class="Function">tail</a> <a id="643" class="Symbol">:</a> <a id="645" class="Symbol">(</a><a id="646" href="Codata.M.html#646" class="Bound">x</a> <a id="648" class="Symbol">:</a> <a id="650" href="Codata.M.html#420" class="Datatype">M</a> <a id="652" href="Codata.M.html#534" class="Bound">C</a> <a id="654" href="Agda.Builtin.Size.html#210" class="Postulate">∞</a><a id="655" class="Symbol">)</a> <a id="657" class="Symbol">→</a> <a id="659" href="Data.Container.Core.html#487" class="Field">Position</a> <a id="668" class="Symbol">(</a><a id="669" href="Codata.M.html#581" class="Function">head</a> <a id="674" href="Codata.M.html#646" class="Bound">x</a><a id="675" class="Symbol">)</a> <a id="677" class="Symbol">→</a> <a id="679" href="Codata.M.html#420" class="Datatype">M</a> <a id="681" href="Codata.M.html#534" class="Bound">C</a> <a id="683" href="Agda.Builtin.Size.html#210" class="Postulate">∞</a>
  <a id="687" href="Codata.M.html#638" class="Function">tail</a> <a id="692" class="Symbol">(</a><a id="693" href="Codata.M.html#481" class="InductiveConstructor">inf</a> <a id="697" class="Symbol">(</a><a id="698" href="Codata.M.html#698" class="Bound">x</a> <a id="700" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="702" href="Codata.M.html#702" class="Bound">f</a><a id="703" class="Symbol">))</a> <a id="706" class="Symbol">=</a> <a id="708" class="Symbol">λ</a> <a id="710" href="Codata.M.html#710" class="Bound">p</a> <a id="712" class="Symbol">→</a> <a id="714" href="Codata.M.html#702" class="Bound">f</a> <a id="716" href="Codata.M.html#710" class="Bound">p</a> <a id="718" class="Symbol">.</a><a id="719" href="Codata.Thunk.html#494" class="Field">force</a>

<a id="726" class="Comment">-- map</a>

<a id="734" class="Keyword">module</a> <a id="741" href="Codata.M.html#741" class="Module">_</a> <a id="743" class="Symbol">{</a><a id="744" href="Codata.M.html#744" class="Bound">s₁</a> <a id="747" href="Codata.M.html#747" class="Bound">s₂</a> <a id="750" href="Codata.M.html#750" class="Bound">p₁</a> <a id="753" href="Codata.M.html#753" class="Bound">p₂</a><a id="755" class="Symbol">}</a> <a id="757" class="Symbol">{</a><a id="758" href="Codata.M.html#758" class="Bound">C₁</a> <a id="761" class="Symbol">:</a> <a id="763" href="Data.Container.Core.html#386" class="Record">Container</a> <a id="773" href="Codata.M.html#744" class="Bound">s₁</a> <a id="776" href="Codata.M.html#750" class="Bound">p₁</a><a id="778" class="Symbol">}</a> <a id="780" class="Symbol">{</a><a id="781" href="Codata.M.html#781" class="Bound">C₂</a> <a id="784" class="Symbol">:</a> <a id="786" href="Data.Container.Core.html#386" class="Record">Container</a> <a id="796" href="Codata.M.html#747" class="Bound">s₂</a> <a id="799" href="Codata.M.html#753" class="Bound">p₂</a><a id="801" class="Symbol">}</a>
         <a id="812" class="Symbol">(</a><a id="813" href="Codata.M.html#813" class="Bound">m</a> <a id="815" class="Symbol">:</a> <a id="817" href="Codata.M.html#758" class="Bound">C₁</a> <a id="820" href="Data.Container.Core.html#720" class="Record Operator">⇒</a> <a id="822" href="Codata.M.html#781" class="Bound">C₂</a><a id="824" class="Symbol">)</a> <a id="826" class="Keyword">where</a>

  <a id="835" href="Codata.M.html#835" class="Function">map</a> <a id="839" class="Symbol">:</a> <a id="841" class="Symbol">∀</a> <a id="843" class="Symbol">{</a><a id="844" href="Codata.M.html#844" class="Bound">i</a><a id="845" class="Symbol">}</a> <a id="847" class="Symbol">→</a> <a id="849" href="Codata.M.html#420" class="Datatype">M</a> <a id="851" href="Codata.M.html#758" class="Bound">C₁</a> <a id="854" href="Codata.M.html#844" class="Bound">i</a> <a id="856" class="Symbol">→</a> <a id="858" href="Codata.M.html#420" class="Datatype">M</a> <a id="860" href="Codata.M.html#781" class="Bound">C₂</a> <a id="863" href="Codata.M.html#844" class="Bound">i</a>
  <a id="867" href="Codata.M.html#835" class="Function">map</a> <a id="871" class="Symbol">(</a><a id="872" href="Codata.M.html#481" class="InductiveConstructor">inf</a> <a id="876" href="Codata.M.html#876" class="Bound">t</a><a id="877" class="Symbol">)</a> <a id="879" class="Symbol">=</a> <a id="881" href="Codata.M.html#481" class="InductiveConstructor">inf</a> <a id="885" class="Symbol">(</a><a id="886" href="Data.Container.Core.html#993" class="Function Operator">⟪</a> <a id="888" href="Codata.M.html#813" class="Bound">m</a> <a id="890" href="Data.Container.Core.html#993" class="Function Operator">⟫</a> <a id="892" class="Symbol">(</a><a id="893" href="Data.Container.html#2547" class="Function">C.map</a> <a id="899" class="Symbol">(λ</a> <a id="902" href="Codata.M.html#902" class="Bound">t</a> <a id="904" class="Symbol">→</a> <a id="906" class="Symbol">λ</a> <a id="908" class="Keyword">where</a> <a id="914" class="Symbol">.</a><a id="915" href="Codata.Thunk.html#494" class="Field">force</a> <a id="921" class="Symbol">→</a> <a id="923" href="Codata.M.html#835" class="Function">map</a> <a id="927" class="Symbol">(</a><a id="928" href="Codata.M.html#902" class="Bound">t</a> <a id="930" class="Symbol">.</a><a id="931" href="Codata.Thunk.html#494" class="Field">force</a><a id="936" class="Symbol">))</a> <a id="939" href="Codata.M.html#876" class="Bound">t</a><a id="940" class="Symbol">))</a>

<a id="944" class="Comment">-- unfold</a>

<a id="955" class="Keyword">module</a> <a id="962" href="Codata.M.html#962" class="Module">_</a> <a id="964" class="Symbol">{</a><a id="965" href="Codata.M.html#965" class="Bound">s</a> <a id="967" href="Codata.M.html#967" class="Bound">p</a> <a id="969" href="Codata.M.html#969" class="Bound">ℓ</a><a id="970" class="Symbol">}</a> <a id="972" class="Symbol">{</a><a id="973" href="Codata.M.html#973" class="Bound">C</a> <a id="975" class="Symbol">:</a> <a id="977" href="Data.Container.Core.html#386" class="Record">Container</a> <a id="987" href="Codata.M.html#965" class="Bound">s</a> <a id="989" href="Codata.M.html#967" class="Bound">p</a><a id="990" class="Symbol">}</a> <a id="992" class="Symbol">(</a><a id="993" class="Keyword">open</a> <a id="998" href="Data.Container.Core.html#386" class="Module">Container</a> <a id="1008" href="Codata.M.html#973" class="Bound">C</a><a id="1009" class="Symbol">)</a>
         <a id="1020" class="Symbol">{</a><a id="1021" href="Codata.M.html#1021" class="Bound">S</a> <a id="1023" class="Symbol">:</a> <a id="1025" class="PrimitiveType">Set</a> <a id="1029" href="Codata.M.html#969" class="Bound">ℓ</a><a id="1030" class="Symbol">}</a> <a id="1032" class="Symbol">(</a><a id="1033" href="Codata.M.html#1033" class="Bound">alg</a> <a id="1037" class="Symbol">:</a> <a id="1039" href="Codata.M.html#1021" class="Bound">S</a> <a id="1041" class="Symbol">→</a> <a id="1043" href="Data.Container.Core.html#576" class="Function Operator">⟦</a> <a id="1045" href="Codata.M.html#973" class="Bound">C</a> <a id="1047" href="Data.Container.Core.html#576" class="Function Operator">⟧</a> <a id="1049" href="Codata.M.html#1021" class="Bound">S</a><a id="1050" class="Symbol">)</a> <a id="1052" class="Keyword">where</a>

  <a id="1061" href="Codata.M.html#1061" class="Function">unfold</a> <a id="1068" class="Symbol">:</a> <a id="1070" href="Codata.M.html#1021" class="Bound">S</a> <a id="1072" class="Symbol">→</a> <a id="1074" class="Symbol">∀</a> <a id="1076" class="Symbol">{</a><a id="1077" href="Codata.M.html#1077" class="Bound">i</a><a id="1078" class="Symbol">}</a> <a id="1080" class="Symbol">→</a> <a id="1082" href="Codata.M.html#420" class="Datatype">M</a> <a id="1084" href="Codata.M.html#973" class="Bound">C</a> <a id="1086" href="Codata.M.html#1077" class="Bound">i</a>
  <a id="1090" href="Codata.M.html#1061" class="Function">unfold</a> <a id="1097" href="Codata.M.html#1097" class="Bound">seed</a> <a id="1102" class="Symbol">=</a> <a id="1104" class="Keyword">let</a> <a id="1108" class="Symbol">(</a><a id="1109" href="Codata.M.html#1109" class="Bound">x</a> <a id="1111" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1113" href="Codata.M.html#1113" class="Bound">next</a><a id="1117" class="Symbol">)</a> <a id="1119" class="Symbol">=</a> <a id="1121" href="Codata.M.html#1033" class="Bound">alg</a> <a id="1125" href="Codata.M.html#1097" class="Bound">seed</a> <a id="1130" class="Keyword">in</a>
                <a id="1149" href="Codata.M.html#481" class="InductiveConstructor">inf</a> <a id="1153" class="Symbol">(</a><a id="1154" href="Codata.M.html#1109" class="Bound">x</a> <a id="1156" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1158" class="Symbol">λ</a> <a id="1160" href="Codata.M.html#1160" class="Bound">p</a> <a id="1162" class="Symbol">→</a> <a id="1164" class="Symbol">λ</a> <a id="1166" class="Keyword">where</a> <a id="1172" class="Symbol">.</a><a id="1173" href="Codata.Thunk.html#494" class="Field">force</a> <a id="1179" class="Symbol">→</a> <a id="1181" href="Codata.M.html#1061" class="Function">unfold</a> <a id="1188" class="Symbol">(</a><a id="1189" href="Codata.M.html#1113" class="Bound">next</a> <a id="1194" href="Codata.M.html#1160" class="Bound">p</a><a id="1195" class="Symbol">))</a>


<a id="1200" class="Comment">------------------------------------------------------------------------</a>
<a id="1273" class="Comment">-- Legacy</a>

<a id="1284" class="Keyword">open</a> <a id="1289" class="Keyword">import</a> <a id="1296" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="1320" class="Keyword">using</a> <a id="1326" class="Symbol">(</a><a id="1327" href="Agda.Builtin.Coinduction.html#164" class="Field">♭</a><a id="1328" class="Symbol">;</a> <a id="1330" href="Agda.Builtin.Coinduction.html#129" class="CoinductiveConstructor Operator">♯_</a><a id="1332" class="Symbol">)</a>
<a id="1334" class="Keyword">import</a> <a id="1341" href="Codata.Musical.M.html" class="Module">Codata.Musical.M</a> <a id="1358" class="Symbol">as</a> <a id="1361" class="Module">M</a>

<a id="1364" class="Keyword">module</a> <a id="1371" href="Codata.M.html#1371" class="Module">_</a> <a id="1373" class="Symbol">{</a><a id="1374" href="Codata.M.html#1374" class="Bound">s</a> <a id="1376" href="Codata.M.html#1376" class="Bound">p</a><a id="1377" class="Symbol">}</a> <a id="1379" class="Symbol">{</a><a id="1380" href="Codata.M.html#1380" class="Bound">C</a> <a id="1382" class="Symbol">:</a> <a id="1384" href="Data.Container.Core.html#386" class="Record">Container</a> <a id="1394" href="Codata.M.html#1374" class="Bound">s</a> <a id="1396" href="Codata.M.html#1376" class="Bound">p</a><a id="1397" class="Symbol">}</a> <a id="1399" class="Keyword">where</a>

  <a id="1408" href="Codata.M.html#1408" class="Function">fromMusical</a> <a id="1420" class="Symbol">:</a> <a id="1422" class="Symbol">∀</a> <a id="1424" class="Symbol">{</a><a id="1425" href="Codata.M.html#1425" class="Bound">i</a><a id="1426" class="Symbol">}</a> <a id="1428" class="Symbol">→</a> <a id="1430" href="Codata.Musical.M.html#401" class="Datatype">M.M</a> <a id="1434" href="Codata.M.html#1380" class="Bound">C</a> <a id="1436" class="Symbol">→</a> <a id="1438" href="Codata.M.html#420" class="Datatype">M</a> <a id="1440" href="Codata.M.html#1380" class="Bound">C</a> <a id="1442" href="Codata.M.html#1425" class="Bound">i</a>
  <a id="1446" href="Codata.M.html#1408" class="Function">fromMusical</a> <a id="1458" class="Symbol">(</a><a id="1459" href="Codata.Musical.M.html#451" class="InductiveConstructor">M.inf</a> <a id="1465" href="Codata.M.html#1465" class="Bound">t</a><a id="1466" class="Symbol">)</a> <a id="1468" class="Symbol">=</a> <a id="1470" href="Codata.M.html#481" class="InductiveConstructor">inf</a> <a id="1474" class="Symbol">(</a><a id="1475" href="Data.Container.html#2547" class="Function">C.map</a> <a id="1481" href="Codata.M.html#1498" class="Function">rec</a> <a id="1485" href="Codata.M.html#1465" class="Bound">t</a><a id="1486" class="Symbol">)</a> <a id="1488" class="Keyword">where</a>
    <a id="1498" href="Codata.M.html#1498" class="Function">rec</a> <a id="1502" class="Symbol">=</a> <a id="1504" class="Symbol">λ</a> <a id="1506" href="Codata.M.html#1506" class="Bound">x</a> <a id="1508" class="Symbol">→</a> <a id="1510" class="Symbol">λ</a> <a id="1512" class="Keyword">where</a> <a id="1518" class="Symbol">.</a><a id="1519" href="Codata.Thunk.html#494" class="Field">force</a> <a id="1525" class="Symbol">→</a> <a id="1527" href="Codata.M.html#1408" class="Function">fromMusical</a> <a id="1539" class="Symbol">(</a><a id="1540" href="Agda.Builtin.Coinduction.html#164" class="Field">♭</a> <a id="1542" href="Codata.M.html#1506" class="Bound">x</a><a id="1543" class="Symbol">)</a>

  <a id="1548" href="Codata.M.html#1548" class="Function">toMusical</a> <a id="1558" class="Symbol">:</a> <a id="1560" href="Codata.M.html#420" class="Datatype">M</a> <a id="1562" href="Codata.M.html#1380" class="Bound">C</a> <a id="1564" href="Agda.Builtin.Size.html#210" class="Postulate">∞</a> <a id="1566" class="Symbol">→</a> <a id="1568" href="Codata.Musical.M.html#401" class="Datatype">M.M</a> <a id="1572" href="Codata.M.html#1380" class="Bound">C</a>
  <a id="1576" href="Codata.M.html#1548" class="Function">toMusical</a> <a id="1586" class="Symbol">(</a><a id="1587" href="Codata.M.html#481" class="InductiveConstructor">inf</a> <a id="1591" class="Symbol">(</a><a id="1592" href="Codata.M.html#1592" class="Bound">s</a> <a id="1594" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1596" href="Codata.M.html#1596" class="Bound">f</a><a id="1597" class="Symbol">))</a> <a id="1600" class="Symbol">=</a> <a id="1602" href="Codata.Musical.M.html#451" class="InductiveConstructor">M.inf</a> <a id="1608" class="Symbol">(</a><a id="1609" href="Codata.M.html#1592" class="Bound">s</a> <a id="1611" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1613" class="Symbol">λ</a> <a id="1615" href="Codata.M.html#1615" class="Bound">p</a> <a id="1617" class="Symbol">→</a> <a id="1619" href="Agda.Builtin.Coinduction.html#129" class="CoinductiveConstructor Operator">♯</a> <a id="1621" href="Codata.M.html#1548" class="Function">toMusical</a> <a id="1631" class="Symbol">(</a><a id="1632" href="Codata.M.html#1596" class="Bound">f</a> <a id="1634" href="Codata.M.html#1615" class="Bound">p</a> <a id="1636" class="Symbol">.</a><a id="1637" href="Codata.Thunk.html#494" class="Field">force</a><a id="1642" class="Symbol">))</a>
</pre></body></html>