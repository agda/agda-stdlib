<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containing the expected output of `run`</a>
<a id="1103" class="Comment">--</a>
<a id="1106" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1174" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1249" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1302" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1374" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1448" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1516" class="Comment">--</a>
<a id="1519" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1589" class="Comment">--</a>
<a id="1592" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1663" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1694" class="Comment">--</a>
<a id="1697" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1772" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1824" class="Comment">------------------------------------------------------------------------</a>
<a id="1897" class="Comment">-- Options</a>
<a id="1908" class="Comment">--</a>
<a id="1911" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1968" class="Comment">--</a>
<a id="1971" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2052" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2127" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2219" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2292" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2357" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2431" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2491" class="Comment">--</a>
<a id="2494" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2574" class="Comment">-- arguments and constructs this for you.</a>
<a id="2616" class="Comment">--</a>

<a id="2620" class="Comment">------------------------------------------------------------------------</a>
<a id="2693" class="Comment">-- Usage</a>
<a id="2702" class="Comment">--</a>
<a id="2705" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2762" class="Comment">--</a>
<a id="2765" class="Comment">--```sh</a>
<a id="2773" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2816" class="Comment">--   [--timing]</a>
<a id="2832" class="Comment">--   [--interactive]</a>
<a id="2853" class="Comment">--   [--only-file PATH]</a>
<a id="2877" class="Comment">--   [--failure-file PATH]</a>
<a id="2904" class="Comment">--   [--no-colour]</a>
<a id="2923" class="Comment">--   [--only [NAMES]]</a>
<a id="2945" class="Comment">--```</a>
<a id="2951" class="Comment">--</a>
<a id="2954" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3035" class="Symbol">{-#</a> <a id="3039" class="Keyword">OPTIONS</a> <a id="3047" class="Pragma">--cubical-compatible</a> <a id="3068" class="Pragma">--guardedness</a> <a id="3082" class="Symbol">#-}</a>

<a id="3087" class="Keyword">module</a> <a id="3094" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3106" class="Keyword">where</a>

<a id="3113" class="Keyword">open</a> <a id="3118" class="Keyword">import</a> <a id="3125" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3140" class="Keyword">using</a> <a id="3146" class="Symbol">(</a><a id="3147" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a><a id="3151" class="Symbol">;</a> <a id="3153" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="3157" class="Symbol">;</a> <a id="3159" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="3164" class="Symbol">;</a> <a id="3166" href="Data.Bool.Base.html#1515" class="Function Operator">if_then_else_</a><a id="3179" class="Symbol">)</a>
<a id="3181" class="Keyword">import</a> <a id="3188" href="Data.Char.html" class="Module">Data.Char</a> <a id="3198" class="Symbol">as</a> <a id="3201" class="Module">Char</a>
<a id="3206" class="Keyword">open</a> <a id="3211" class="Keyword">import</a> <a id="3218" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3227" class="Keyword">using</a> <a id="3233" class="Symbol">(</a><a id="3234" href="Data.Fin.html#700" class="Function Operator">#_</a><a id="3236" class="Symbol">)</a>
<a id="3238" class="Keyword">import</a> <a id="3245" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3263" class="Symbol">as</a> <a id="3266" class="Module">ℤ</a>
<a id="3268" class="Keyword">open</a> <a id="3273" class="Keyword">import</a> <a id="3280" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3295" class="Symbol">as</a> <a id="3298" class="Module">List</a> <a id="3303" class="Keyword">using</a> <a id="3309" class="Symbol">(</a><a id="3310" href="Agda.Builtin.List.html#147" class="Datatype">List</a><a id="3314" class="Symbol">;</a> <a id="3316" href="Data.List.Base.html#7301" class="InductiveConstructor">[]</a><a id="3318" class="Symbol">;</a> <a id="3320" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">_∷_</a><a id="3323" class="Symbol">;</a> <a id="3325" href="Data.List.Base.html#1712" class="Function Operator">_++_</a><a id="3329" class="Symbol">;</a> <a id="3331" href="Data.List.Base.html#10389" class="Function">filter</a><a id="3337" class="Symbol">;</a> <a id="3339" href="Data.List.Base.html#3674" class="Function">partitionSums</a><a id="3352" class="Symbol">)</a>
<a id="3354" class="Keyword">open</a> <a id="3359" class="Keyword">import</a> <a id="3366" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3423" class="Keyword">using</a> <a id="3429" class="Symbol">(</a><a id="3430" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6763" class="Function">infix?</a><a id="3436" class="Symbol">)</a>
<a id="3438" class="Keyword">open</a> <a id="3443" class="Keyword">import</a> <a id="3450" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3479" class="Keyword">using</a> <a id="3485" class="Symbol">(</a><a id="3486" href="Data.List.Relation.Unary.Any.html#2684" class="Function">any?</a><a id="3490" class="Symbol">)</a>
<a id="3492" class="Keyword">open</a> <a id="3497" class="Keyword">import</a> <a id="3504" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3520" class="Keyword">using</a> <a id="3526" class="Symbol">(</a><a id="3527" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a><a id="3532" class="Symbol">;</a> <a id="3534" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="3538" class="Symbol">;</a> <a id="3540" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="3547" class="Symbol">;</a> <a id="3549" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a><a id="3558" class="Symbol">)</a>
<a id="3560" class="Keyword">open</a> <a id="3565" class="Keyword">import</a> <a id="3572" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3586" class="Keyword">using</a> <a id="3592" class="Symbol">(</a><a id="3593" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="3594" class="Symbol">;</a> <a id="3596" href="Data.Nat.Base.html#1289" class="Primitive Operator">_≡ᵇ_</a><a id="3600" class="Symbol">;</a> <a id="3602" href="Data.Nat.Base.html#1463" class="Primitive Operator">_&lt;ᵇ_</a><a id="3606" class="Symbol">;</a> <a id="3608" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">_+_</a><a id="3611" class="Symbol">;</a> <a id="3613" href="Data.Nat.Base.html#4462" class="Primitive Operator">_∸_</a><a id="3616" class="Symbol">)</a>
<a id="3618" class="Keyword">open</a> <a id="3623" class="Keyword">import</a> <a id="3630" href="Data.Nat.ListAction.html" class="Module">Data.Nat.ListAction</a> <a id="3650" class="Keyword">using</a> <a id="3656" class="Symbol">(</a><a id="3657" href="Data.Nat.ListAction.html#612" class="Function">sum</a><a id="3660" class="Symbol">)</a>
<a id="3662" class="Keyword">import</a> <a id="3669" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3683" class="Symbol">as</a> <a id="3686" class="Module">ℕ</a> <a id="3688" class="Keyword">using</a> <a id="3694" class="Symbol">(</a><a id="3695" href="Data.Nat.Show.html#2025" class="Function">show</a><a id="3699" class="Symbol">)</a>
<a id="3701" class="Keyword">open</a> <a id="3706" class="Keyword">import</a> <a id="3713" href="Data.Product.Base.html" class="Module">Data.Product.Base</a> <a id="3731" class="Keyword">using</a> <a id="3737" class="Symbol">(</a><a id="3738" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="3741" class="Symbol">;</a> <a id="3743" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="3746" class="Symbol">)</a>
<a id="3748" class="Keyword">open</a> <a id="3753" class="Keyword">import</a> <a id="3760" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="3777" class="Symbol">as</a> <a id="3780" class="Module">String</a> <a id="3787" class="Keyword">using</a> <a id="3793" class="Symbol">(</a><a id="3794" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="3800" class="Symbol">;</a> <a id="3802" href="Data.String.Base.html#5230" class="Function">lines</a><a id="3807" class="Symbol">;</a> <a id="3809" href="Data.String.Base.html#2826" class="Function">unlines</a><a id="3816" class="Symbol">;</a> <a id="3818" href="Data.String.Base.html#2768" class="Function">unwords</a><a id="3825" class="Symbol">;</a> <a id="3827" href="Data.String.Base.html#2613" class="Function">concat</a><a id="3833" class="Symbol">)</a>
<a id="3835" class="Keyword">open</a> <a id="3840" class="Keyword">import</a> <a id="3847" href="Data.String.Properties.html" class="Module">Data.String.Properties</a> <a id="3870" class="Symbol">as</a> <a id="3873" class="Module">String</a> <a id="3880" class="Keyword">using</a> <a id="3886" class="Symbol">(</a><a id="3887" href="Data.String.Properties.html#2741" class="Function Operator">_≟_</a><a id="3890" class="Symbol">)</a>
<a id="3892" class="Keyword">open</a> <a id="3897" class="Keyword">import</a> <a id="3904" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3918" class="Keyword">using</a> <a id="3924" class="Symbol">(</a><a id="3925" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="3928" class="Symbol">;</a> <a id="3930" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="3934" class="Symbol">;</a> <a id="3936" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="3940" class="Symbol">)</a>
<a id="3942" class="Keyword">open</a> <a id="3947" class="Keyword">import</a> <a id="3954" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3969" class="Keyword">using</a> <a id="3975" class="Symbol">(</a><a id="3976" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a><a id="3977" class="Symbol">)</a>

<a id="3980" class="Keyword">open</a> <a id="3985" class="Keyword">import</a> <a id="3992" href="Function.Base.html" class="Module">Function.Base</a> <a id="4006" class="Keyword">using</a> <a id="4012" class="Symbol">(</a><a id="4013" href="Function.Base.html#704" class="Function">id</a><a id="4015" class="Symbol">;</a> <a id="4017" href="Function.Base.html#1993" class="Function Operator">_$_</a><a id="4020" class="Symbol">;</a> <a id="4022" href="Function.Base.html#4061" class="Function Operator">case_of_</a><a id="4030" class="Symbol">)</a>

<a id="4033" class="Keyword">open</a> <a id="4038" class="Keyword">import</a> <a id="4045" href="Relation.Nullary.Decidable.Core.html" class="Module">Relation.Nullary.Decidable.Core</a> <a id="4077" class="Keyword">using</a> <a id="4083" class="Symbol">(</a><a id="4084" href="Relation.Nullary.Decidable.Core.html#1975" class="Field">does</a><a id="4088" class="Symbol">)</a>

<a id="4091" class="Keyword">open</a> <a id="4096" class="Keyword">import</a> <a id="4103" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="4127" class="Keyword">using</a> <a id="4133" class="Symbol">(</a><a id="4134" href="Agda.Builtin.Coinduction.html#229" class="CoinductiveConstructor Operator">♯_</a><a id="4136" class="Symbol">)</a>
<a id="4138" class="Keyword">open</a> <a id="4143" class="Keyword">import</a> <a id="4150" href="IO.html" class="Module">IO</a>

<a id="4154" class="Keyword">open</a> <a id="4159" class="Keyword">import</a> <a id="4166" href="System.Clock.html" class="Module">System.Clock</a> <a id="4179" class="Symbol">as</a> <a id="4182" class="Module">Clock</a> <a id="4188" class="Keyword">using</a> <a id="4194" class="Symbol">(</a><a id="4195" href="System.Clock.html#2776" class="Function">time′</a><a id="4200" class="Symbol">;</a> <a id="4202" href="System.Clock.html#1931" class="Record">Time</a><a id="4206" class="Symbol">;</a> <a id="4208" href="System.Clock.html#1977" class="Field">seconds</a><a id="4215" class="Symbol">)</a>
<a id="4217" class="Keyword">open</a> <a id="4222" class="Keyword">import</a> <a id="4229" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4249" class="Keyword">open</a> <a id="4254" class="Keyword">import</a> <a id="4261" href="System.Directory.html" class="Module">System.Directory</a> <a id="4278" class="Keyword">using</a> <a id="4284" class="Symbol">(</a><a id="4285" href="System.Directory.html#3068" class="Function">doesFileExist</a><a id="4298" class="Symbol">;</a> <a id="4300" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a><a id="4318" class="Symbol">)</a>
<a id="4320" class="Keyword">open</a> <a id="4325" class="Keyword">import</a> <a id="4332" href="System.Environment.html" class="Module">System.Environment</a> <a id="4351" class="Keyword">using</a> <a id="4357" class="Symbol">(</a><a id="4358" href="System.Environment.html#660" class="Function">getArgs</a><a id="4365" class="Symbol">;</a> <a id="4367" href="System.Environment.html#777" class="Function">lookupEnv</a><a id="4376" class="Symbol">)</a>
<a id="4378" class="Keyword">open</a> <a id="4383" class="Keyword">import</a> <a id="4390" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4402" class="Keyword">open</a> <a id="4407" class="Keyword">import</a> <a id="4414" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4436" class="Keyword">using</a> <a id="4442" class="Symbol">(</a><a id="4443" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a><a id="4453" class="Symbol">)</a>
<a id="4455" class="Keyword">open</a> <a id="4460" class="Keyword">import</a> <a id="4467" href="System.Process.html" class="Module">System.Process</a> <a id="4482" class="Keyword">using</a> <a id="4488" class="Symbol">(</a><a id="4489" href="System.Process.html#655" class="Function">callCommand</a><a id="4500" class="Symbol">;</a> <a id="4502" href="System.Process.html#735" class="Function">system</a><a id="4508" class="Symbol">)</a>

<a id="4511" class="Keyword">record</a> <a id="Options"></a><a id="4518" href="Test.Golden.html#4518" class="Record">Options</a> <a id="4526" class="Symbol">:</a> <a id="4528" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4532" class="Keyword">where</a>
  <a id="4540" class="Keyword">field</a>
    <a id="4550" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4598" href="Test.Golden.html#4598" class="Field">exeUnderTest</a> <a id="4611" class="Symbol">:</a> <a id="4613" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4624" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4671" href="Test.Golden.html#4671" class="Field">onlyNames</a> <a id="4681" class="Symbol">:</a> <a id="4683" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4688" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4699" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4750" href="Test.Golden.html#4750" class="Field">interactive</a> <a id="4762" class="Symbol">:</a> <a id="4764" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="4773" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4818" href="Test.Golden.html#4818" class="Field">timing</a> <a id="4825" class="Symbol">:</a> <a id="4827" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="4836" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4896" href="Test.Golden.html#4896" class="Field">failureFile</a> <a id="4908" class="Symbol">:</a> <a id="4910" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="4916" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="4927" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="4988" href="Test.Golden.html#4988" class="Field">colour</a> <a id="4995" class="Symbol">:</a> <a id="4997" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
<a id="5002" class="Keyword">open</a> <a id="5007" href="Test.Golden.html#4518" class="Module">Options</a>

<a id="initOptions"></a><a id="5016" href="Test.Golden.html#5016" class="Function">initOptions</a> <a id="5028" class="Symbol">:</a> <a id="5030" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5037" class="Symbol">→</a> <a id="5039" href="Test.Golden.html#4518" class="Record">Options</a>
<a id="5047" href="Test.Golden.html#5016" class="Function">initOptions</a> <a id="5059" href="Test.Golden.html#5059" class="Bound">exe</a> <a id="5063" class="Symbol">=</a> <a id="5065" class="Keyword">record</a>
  <a id="5074" class="Symbol">{</a> <a id="5076" href="Test.Golden.html#4598" class="Field">exeUnderTest</a> <a id="5089" class="Symbol">=</a> <a id="5091" href="Test.Golden.html#5059" class="Bound">exe</a>
  <a id="5097" class="Symbol">;</a> <a id="5099" href="Test.Golden.html#4671" class="Field">onlyNames</a>    <a id="5112" class="Symbol">=</a> <a id="5114" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
  <a id="5119" class="Symbol">;</a> <a id="5121" href="Test.Golden.html#4750" class="Field">interactive</a>  <a id="5134" class="Symbol">=</a> <a id="5136" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
  <a id="5144" class="Symbol">;</a> <a id="5146" href="Test.Golden.html#4818" class="Field">timing</a>       <a id="5159" class="Symbol">=</a> <a id="5161" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
  <a id="5169" class="Symbol">;</a> <a id="5171" href="Test.Golden.html#4896" class="Field">failureFile</a>  <a id="5184" class="Symbol">=</a> <a id="5186" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
  <a id="5196" class="Symbol">;</a> <a id="5198" href="Test.Golden.html#4988" class="Field">colour</a>       <a id="5211" class="Symbol">=</a> <a id="5213" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
  <a id="5220" class="Symbol">}</a>

<a id="usage"></a><a id="5223" href="Test.Golden.html#5223" class="Function">usage</a> <a id="5229" class="Symbol">:</a> <a id="5231" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5238" href="Test.Golden.html#5223" class="Function">usage</a> <a id="5244" class="Symbol">=</a> <a id="5246" href="Data.String.Base.html#2768" class="Function">unwords</a>
  <a id="5256" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="5258" class="String">&quot;Usage:&quot;</a>
  <a id="5269" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5271" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5291" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5293" class="String">&quot;[--timing]&quot;</a>
  <a id="5308" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5310" class="String">&quot;[--interactive]&quot;</a>
  <a id="5330" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5332" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5358" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5360" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5383" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5385" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5403" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5405" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5426" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5428" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

<a id="5432" class="Keyword">data</a> <a id="Error"></a><a id="5437" href="Test.Golden.html#5437" class="Datatype">Error</a> <a id="5443" class="Symbol">:</a> <a id="5445" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="5449" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5457" href="Test.Golden.html#5457" class="InductiveConstructor">MissingExecutable</a> <a id="5475" class="Symbol">:</a> <a id="5477" href="Test.Golden.html#5437" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5485" href="Test.Golden.html#5485" class="InductiveConstructor">InvalidArgument</a> <a id="5501" class="Symbol">:</a> <a id="5503" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5510" class="Symbol">→</a> <a id="5512" href="Test.Golden.html#5437" class="Datatype">Error</a>

<a id="show"></a><a id="5519" href="Test.Golden.html#5519" class="Function">show</a> <a id="5524" class="Symbol">:</a> <a id="5526" href="Test.Golden.html#5437" class="Datatype">Error</a> <a id="5532" class="Symbol">→</a> <a id="5534" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5541" href="Test.Golden.html#5519" class="Function">show</a> <a id="5546" href="Test.Golden.html#5457" class="InductiveConstructor">MissingExecutable</a> <a id="5564" class="Symbol">=</a> <a id="5566" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5605" href="Test.Golden.html#5519" class="Function">show</a> <a id="5610" class="Symbol">(</a><a id="5611" href="Test.Golden.html#5485" class="InductiveConstructor">InvalidArgument</a> <a id="5627" href="Test.Golden.html#5627" class="Bound">arg</a><a id="5630" class="Symbol">)</a> <a id="5632" class="Symbol">=</a> <a id="5634" class="String">&quot;Invalid argument: &quot;</a> <a id="5655" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="5665" href="Test.Golden.html#5627" class="Bound">arg</a>

<a id="5670" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5706" href="Test.Golden.html#5706" class="Function">options</a> <a id="5714" class="Symbol">:</a> <a id="5716" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5721" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5728" class="Symbol">→</a> <a id="5730" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="5733" class="Symbol">(</a><a id="5734" href="Test.Golden.html#5437" class="Datatype">Error</a> <a id="5740" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5742" href="Test.Golden.html#4518" class="Record">Options</a><a id="5749" class="Symbol">)</a>
<a id="5751" href="Test.Golden.html#5706" class="Function">options</a><a id="5758" class="Symbol">(</a><a id="5759" href="Test.Golden.html#5759" class="Bound">exe</a> <a id="5763" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5765" href="Test.Golden.html#5765" class="Bound">rest</a><a id="5769" class="Symbol">)</a> <a id="5771" class="Symbol">=</a> <a id="5773" href="Test.Golden.html#6574" class="Function">mkOptions</a> <a id="5783" href="Test.Golden.html#5759" class="Bound">exe</a> <a id="5787" href="Test.Golden.html#5765" class="Bound">rest</a> <a id="5792" class="Keyword">where</a>

  <a id="5801" href="Test.Golden.html#5801" class="Function">go</a> <a id="5804" class="Symbol">:</a> <a id="5806" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5811" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5818" class="Symbol">→</a> <a id="5820" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5826" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5833" class="Symbol">→</a> <a id="5835" href="Test.Golden.html#4518" class="Record">Options</a> <a id="5843" class="Symbol">→</a> <a id="5845" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5852" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5854" class="Symbol">(</a><a id="5855" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5861" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="5868" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5870" href="Test.Golden.html#4518" class="Record">Options</a><a id="5877" class="Symbol">)</a>
  <a id="5881" href="Test.Golden.html#5801" class="Function">go</a> <a id="5884" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>                             <a id="5915" href="Test.Golden.html#5915" class="Bound">mfp</a> <a id="5919" href="Test.Golden.html#5919" class="Bound">opts</a> <a id="5924" class="Symbol">=</a> <a id="5926" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="5931" class="Symbol">(</a><a id="5932" href="Test.Golden.html#5915" class="Bound">mfp</a> <a id="5936" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5938" href="Test.Golden.html#5919" class="Bound">opts</a><a id="5942" class="Symbol">)</a>
  <a id="5946" href="Test.Golden.html#5801" class="Function">go</a> <a id="5949" class="Symbol">(</a><a id="5950" class="String">&quot;--timing&quot;</a>            <a id="5972" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5974" href="Test.Golden.html#5974" class="Bound">args</a><a id="5978" class="Symbol">)</a> <a id="5980" href="Test.Golden.html#5980" class="Bound">mfp</a> <a id="5984" href="Test.Golden.html#5984" class="Bound">opts</a> <a id="5989" class="Symbol">=</a>
    <a id="5995" href="Test.Golden.html#5801" class="Function">go</a> <a id="5998" href="Test.Golden.html#5974" class="Bound">args</a> <a id="6003" href="Test.Golden.html#5980" class="Bound">mfp</a> <a id="6007" class="Symbol">(</a><a id="6008" class="Keyword">record</a> <a id="6015" href="Test.Golden.html#5984" class="Bound">opts</a> <a id="6020" class="Symbol">{</a> <a id="6022" href="Test.Golden.html#4818" class="Field">timing</a> <a id="6029" class="Symbol">=</a> <a id="6031" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="6036" class="Symbol">})</a>
  <a id="6041" href="Test.Golden.html#5801" class="Function">go</a> <a id="6044" class="Symbol">(</a><a id="6045" class="String">&quot;--interactive&quot;</a>       <a id="6067" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6069" href="Test.Golden.html#6069" class="Bound">args</a><a id="6073" class="Symbol">)</a> <a id="6075" href="Test.Golden.html#6075" class="Bound">mfp</a> <a id="6079" href="Test.Golden.html#6079" class="Bound">opts</a> <a id="6084" class="Symbol">=</a>
    <a id="6090" href="Test.Golden.html#5801" class="Function">go</a> <a id="6093" href="Test.Golden.html#6069" class="Bound">args</a> <a id="6098" href="Test.Golden.html#6075" class="Bound">mfp</a> <a id="6102" class="Symbol">(</a><a id="6103" class="Keyword">record</a> <a id="6110" href="Test.Golden.html#6079" class="Bound">opts</a> <a id="6115" class="Symbol">{</a> <a id="6117" href="Test.Golden.html#4750" class="Field">interactive</a> <a id="6129" class="Symbol">=</a> <a id="6131" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="6136" class="Symbol">})</a>
  <a id="6141" href="Test.Golden.html#5801" class="Function">go</a> <a id="6144" class="Symbol">(</a><a id="6145" class="String">&quot;--failure-file&quot;</a> <a id="6162" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6164" href="Test.Golden.html#6164" class="Bound">fp</a> <a id="6167" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6169" href="Test.Golden.html#6169" class="Bound">args</a><a id="6173" class="Symbol">)</a> <a id="6175" href="Test.Golden.html#6175" class="Bound">mfp</a> <a id="6179" href="Test.Golden.html#6179" class="Bound">opts</a> <a id="6184" class="Symbol">=</a>
    <a id="6190" href="Test.Golden.html#5801" class="Function">go</a> <a id="6193" href="Test.Golden.html#6169" class="Bound">args</a> <a id="6198" href="Test.Golden.html#6175" class="Bound">mfp</a> <a id="6202" class="Symbol">(</a><a id="6203" class="Keyword">record</a> <a id="6210" href="Test.Golden.html#6179" class="Bound">opts</a> <a id="6215" class="Symbol">{</a> <a id="6217" href="Test.Golden.html#4896" class="Field">failureFile</a> <a id="6229" class="Symbol">=</a> <a id="6231" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6236" href="Test.Golden.html#6164" class="Bound">fp</a> <a id="6239" class="Symbol">})</a>
  <a id="6244" href="Test.Golden.html#5801" class="Function">go</a> <a id="6247" class="Symbol">(</a><a id="6248" class="String">&quot;--only&quot;</a>              <a id="6270" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6272" href="Test.Golden.html#6272" class="Bound">args</a><a id="6276" class="Symbol">)</a> <a id="6278" href="Test.Golden.html#6278" class="Bound">mfp</a> <a id="6282" href="Test.Golden.html#6282" class="Bound">opts</a> <a id="6287" class="Symbol">=</a>
    <a id="6293" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6298" class="Symbol">(</a><a id="6299" href="Test.Golden.html#6278" class="Bound">mfp</a> <a id="6303" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6305" class="Symbol">(</a><a id="6306" class="Keyword">record</a> <a id="6313" href="Test.Golden.html#6282" class="Bound">opts</a> <a id="6318" class="Symbol">{</a> <a id="6320" href="Test.Golden.html#4671" class="Field">onlyNames</a> <a id="6330" class="Symbol">=</a> <a id="6332" href="Test.Golden.html#6272" class="Bound">args</a> <a id="6337" class="Symbol">}))</a>
  <a id="6343" href="Test.Golden.html#5801" class="Function">go</a> <a id="6346" class="Symbol">(</a><a id="6347" class="String">&quot;--only-file&quot;</a> <a id="6361" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6363" href="Test.Golden.html#6363" class="Bound">fp</a>    <a id="6369" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6371" href="Test.Golden.html#6371" class="Bound">args</a><a id="6375" class="Symbol">)</a> <a id="6377" href="Test.Golden.html#6377" class="Bound">mfp</a> <a id="6381" href="Test.Golden.html#6381" class="Bound">opts</a> <a id="6386" class="Symbol">=</a>
    <a id="6392" href="Test.Golden.html#5801" class="Function">go</a> <a id="6395" href="Test.Golden.html#6371" class="Bound">args</a> <a id="6400" class="Symbol">(</a><a id="6401" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6406" href="Test.Golden.html#6363" class="Bound">fp</a><a id="6408" class="Symbol">)</a> <a id="6410" class="Symbol">(</a><a id="6411" class="Keyword">record</a> <a id="6418" href="Test.Golden.html#6381" class="Bound">opts</a> <a id="6423" class="Symbol">{</a> <a id="6425" href="Test.Golden.html#4671" class="Field">onlyNames</a> <a id="6435" class="Symbol">=</a> <a id="6437" href="Test.Golden.html#6371" class="Bound">args</a> <a id="6442" class="Symbol">})</a>
  <a id="6447" href="Test.Golden.html#5801" class="Function">go</a> <a id="6450" class="Symbol">(</a><a id="6451" class="String">&quot;--no-colour&quot;</a>         <a id="6473" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6475" href="Test.Golden.html#6475" class="Bound">args</a><a id="6479" class="Symbol">)</a> <a id="6481" href="Test.Golden.html#6481" class="Bound">mfp</a> <a id="6485" href="Test.Golden.html#6485" class="Bound">opts</a> <a id="6490" class="Symbol">=</a>
    <a id="6496" href="Test.Golden.html#5801" class="Function">go</a> <a id="6499" href="Test.Golden.html#6475" class="Bound">args</a> <a id="6504" href="Test.Golden.html#6481" class="Bound">mfp</a> <a id="6508" class="Symbol">(</a><a id="6509" class="Keyword">record</a> <a id="6516" href="Test.Golden.html#6485" class="Bound">opts</a> <a id="6521" class="Symbol">{</a> <a id="6523" href="Test.Golden.html#4988" class="Field">colour</a> <a id="6530" class="Symbol">=</a> <a id="6532" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6538" class="Symbol">})</a>
  <a id="6543" href="Test.Golden.html#5801" class="CatchallClause Function">go</a><a id="6545" class="CatchallClause"> </a><a id="6546" class="CatchallClause Symbol">(</a><a id="6547" href="Test.Golden.html#6547" class="CatchallClause Bound">arg</a><a id="6550" class="CatchallClause"> </a><a id="6551" href="Agda.Builtin.List.html#199" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6552" class="CatchallClause"> </a><a id="6553" class="CatchallClause Symbol">_)</a><a id="6555" class="CatchallClause"> </a><a id="6556" class="CatchallClause Symbol">_</a><a id="6557" class="CatchallClause"> </a><a id="6558" class="CatchallClause Symbol">_</a> <a id="6560" class="Symbol">=</a> <a id="6562" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6567" href="Test.Golden.html#6547" class="Bound">arg</a>

  <a id="6574" href="Test.Golden.html#6574" class="Function">mkOptions</a> <a id="6584" class="Symbol">:</a> <a id="6586" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="6593" class="Symbol">→</a> <a id="6595" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6600" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="6607" class="Symbol">→</a> <a id="6609" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="6612" class="Symbol">(</a><a id="6613" href="Test.Golden.html#5437" class="Datatype">Error</a> <a id="6619" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6621" href="Test.Golden.html#4518" class="Record">Options</a><a id="6628" class="Symbol">)</a>
  <a id="6632" href="Test.Golden.html#6574" class="Function">mkOptions</a> <a id="6642" href="Test.Golden.html#6642" class="Bound">exe</a> <a id="6646" href="Test.Golden.html#6646" class="Bound">rest</a> <a id="6651" class="Symbol">=</a> <a id="6653" class="Keyword">do</a>
    <a id="6660" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6665" class="Symbol">(</a><a id="6666" href="Test.Golden.html#6666" class="Bound">mfp</a> <a id="6670" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="6672" href="Test.Golden.html#6672" class="Bound">opts</a><a id="6676" class="Symbol">)</a> <a id="6678" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="6680" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="6685" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="6687" href="Test.Golden.html#5801" class="Function">go</a> <a id="6690" href="Test.Golden.html#6646" class="Bound">rest</a> <a id="6695" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="6703" class="Symbol">(</a><a id="6704" href="Test.Golden.html#5016" class="Function">initOptions</a> <a id="6716" href="Test.Golden.html#6642" class="Bound">exe</a><a id="6719" class="Symbol">)</a>
      <a id="6727" class="Keyword">where</a> <a id="6733" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6738" href="Test.Golden.html#6738" class="Bound">arg</a> <a id="6742" class="Symbol">→</a> <a id="6744" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="6749" class="Symbol">(</a><a id="6750" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6755" class="Symbol">(</a><a id="6756" href="Test.Golden.html#5485" class="InductiveConstructor">InvalidArgument</a> <a id="6772" href="Test.Golden.html#6738" class="Bound">arg</a><a id="6775" class="Symbol">))</a>
    <a id="6782" href="Test.Golden.html#6782" class="Bound">term</a> <a id="6787" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="6789" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a> <a id="6799" class="String">&quot;&quot;</a> <a id="6802" href="IO.Base.html#2098" class="Function Operator">&lt;$&gt;</a> <a id="6806" href="System.Environment.html#777" class="Function">lookupEnv</a> <a id="6816" class="String">&quot;TERM&quot;</a>
    <a id="6827" class="Keyword">let</a> <a id="6831" href="Test.Golden.html#6831" class="Bound">opts</a> <a id="6836" class="Symbol">=</a> <a id="6838" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="6841" href="Relation.Nullary.Decidable.Core.html#1975" class="Field">does</a> <a id="6846" class="Symbol">(</a><a id="6847" href="Test.Golden.html#6782" class="Bound">term</a> <a id="6852" href="Data.String.Properties.html#2741" class="Function Operator">≟</a> <a id="6854" class="String">&quot;DUMB&quot;</a><a id="6860" class="Symbol">)</a>
               <a id="6877" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="6882" class="Keyword">record</a> <a id="6889" href="Test.Golden.html#6672" class="Bound">opts</a> <a id="6894" class="Symbol">{</a> <a id="6896" href="Test.Golden.html#4988" class="Field">colour</a> <a id="6903" class="Symbol">=</a> <a id="6905" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="6911" class="Symbol">}</a>
               <a id="6928" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="6933" href="Test.Golden.html#6672" class="Bound">opts</a>
    <a id="6942" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6947" href="Test.Golden.html#6947" class="Bound">fp</a> <a id="6950" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="6952" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="6957" href="Test.Golden.html#6666" class="Bound">mfp</a>
      <a id="6967" class="Keyword">where</a> <a id="6973" class="CatchallClause Symbol">_</a> <a id="6975" class="Symbol">→</a> <a id="6977" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="6982" class="Symbol">(</a><a id="6983" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6988" href="Test.Golden.html#6831" class="Bound">opts</a><a id="6992" class="Symbol">)</a>
    <a id="6998" href="Test.Golden.html#6998" class="Bound">only</a> <a id="7003" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7005" href="IO.html#2922" class="Function">readFiniteFile</a> <a id="7020" href="Test.Golden.html#6947" class="Bound">fp</a>
    <a id="7027" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="7032" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7034" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="7039" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7041" class="Keyword">record</a> <a id="7048" href="Test.Golden.html#6831" class="Bound">opts</a> <a id="7053" class="Symbol">{</a> <a id="7055" href="Test.Golden.html#4671" class="Field">onlyNames</a> <a id="7065" class="Symbol">=</a> <a id="7067" href="Data.String.Base.html#5230" class="Function">lines</a> <a id="7073" href="Test.Golden.html#6998" class="Bound">only</a> <a id="7078" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="7081" href="Test.Golden.html#4671" class="Field">onlyNames</a> <a id="7091" href="Test.Golden.html#6831" class="Bound">opts</a> <a id="7096" class="Symbol">}</a>

<a id="7099" href="Test.Golden.html#5706" class="Function">options</a> <a id="7107" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="7110" class="Symbol">=</a> <a id="7112" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="7117" class="Symbol">(</a><a id="7118" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7123" href="Test.Golden.html#5457" class="InductiveConstructor">MissingExecutable</a><a id="7140" class="Symbol">)</a>


<a id="7144" class="Comment">-- The result of a test run</a>
<a id="7172" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7232" href="Test.Golden.html#7232" class="Function">Result</a> <a id="7239" class="Symbol">:</a> <a id="7241" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="7245" href="Test.Golden.html#7232" class="Function">Result</a> <a id="7252" class="Symbol">=</a> <a id="7254" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="7261" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="7263" href="Agda.Builtin.String.html#335" class="Postulate">String</a>

<a id="7271" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7331" href="Test.Golden.html#7331" class="Function">runTest</a> <a id="7339" class="Symbol">:</a> <a id="7341" href="Test.Golden.html#4518" class="Record">Options</a> <a id="7349" class="Symbol">→</a> <a id="7351" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="7358" class="Symbol">→</a> <a id="7360" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="7363" href="Test.Golden.html#7232" class="Function">Result</a>
<a id="7370" href="Test.Golden.html#7331" class="Function">runTest</a> <a id="7378" href="Test.Golden.html#7378" class="Bound">opts</a> <a id="7383" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="7392" class="Symbol">=</a> <a id="7394" class="Keyword">do</a>

  <a id="7400" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="7405" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7407" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a> <a id="7426" class="Symbol">(</a><a id="7427" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a> <a id="7438" href="Test.Golden.html#7383" class="Bound">testPath</a><a id="7446" class="Symbol">)</a>
    <a id="7452" class="Keyword">where</a> <a id="7458" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="7464" class="Symbol">→</a> <a id="7466" href="Test.Golden.html#9011" class="Function">fail</a> <a id="7471" href="Test.Golden.html#8632" class="Function">directoryNotFound</a>

  <a id="7492" href="Test.Golden.html#7492" class="Bound">time</a> <a id="7497" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7499" href="System.Clock.html#2776" class="Function">time′</a> <a id="7505" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7507" href="System.Process.html#655" class="Function">callCommand</a> <a id="7519" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7521" href="Data.String.Base.html#2768" class="Function">unwords</a>
           <a id="7540" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="7542" class="String">&quot;cd&quot;</a> <a id="7547" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7549" href="Test.Golden.html#7383" class="Bound">testPath</a>
           <a id="7569" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7571" class="String">&quot;&amp;&amp;&quot;</a> <a id="7576" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7578" class="String">&quot;sh ./run&quot;</a> <a id="7589" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7591" href="Test.Golden.html#7378" class="Bound">opts</a> <a id="7596" class="Symbol">.</a><a id="7597" href="Test.Golden.html#4598" class="Field">exeUnderTest</a>
           <a id="7621" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7623" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7659" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7661" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="7667" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7672" href="Test.Golden.html#7672" class="Bound">out</a> <a id="7676" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7678" href="Test.Golden.html#9112" class="Function">readLocalFile</a> <a id="7692" class="String">&quot;output&quot;</a>
    <a id="7705" class="Keyword">where</a> <a id="7711" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7719" class="Symbol">→</a> <a id="7721" href="Test.Golden.html#9011" class="Function">fail</a> <a id="7726" class="Symbol">(</a><a id="7727" href="Test.Golden.html#8811" class="Function">fileNotFound</a> <a id="7740" class="String">&quot;output&quot;</a><a id="7748" class="Symbol">)</a>
  <a id="7752" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7757" href="Test.Golden.html#7757" class="Bound">exp</a> <a id="7761" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="7763" href="Test.Golden.html#9112" class="Function">readLocalFile</a> <a id="7777" class="String">&quot;expected&quot;</a>
    <a id="7792" class="Keyword">where</a> <a id="7798" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7806" class="Symbol">→</a> <a id="7808" class="Keyword">do</a> <a id="7811" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="7814" href="Test.Golden.html#7378" class="Bound">opts</a> <a id="7819" class="Symbol">.</a><a id="7820" href="Test.Golden.html#4750" class="Field">interactive</a>
                         <a id="7857" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="7862" href="Test.Golden.html#9879" class="Function">mayOverwrite</a> <a id="7875" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7883" href="Test.Golden.html#7672" class="Bound">out</a>
                         <a id="7912" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="7917" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="7926" class="Symbol">(</a><a id="7927" href="Test.Golden.html#8811" class="Function">fileNotFound</a> <a id="7940" class="String">&quot;expected&quot;</a><a id="7950" class="Symbol">)</a>
                       <a id="7975" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="7980" class="Symbol">(</a><a id="7981" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7986" href="Test.Golden.html#7383" class="Bound">testPath</a><a id="7994" class="Symbol">)</a>

  <a id="7999" class="Keyword">let</a> <a id="8003" href="Test.Golden.html#8003" class="Bound">result</a> <a id="8010" class="Symbol">=</a> <a id="8012" href="Relation.Nullary.Decidable.Core.html#1975" class="Field">does</a> <a id="8017" class="Symbol">(</a><a id="8018" href="Test.Golden.html#7672" class="Bound">out</a> <a id="8022" href="Data.String.Properties.html#2741" class="Function Operator">String.≟</a> <a id="8031" href="Test.Golden.html#7757" class="Bound">exp</a><a id="8034" class="Symbol">)</a>

  <a id="8039" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8042" href="Test.Golden.html#8003" class="Bound">result</a>
    <a id="8053" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8058" href="Test.Golden.html#10695" class="Function">printTiming</a> <a id="8070" class="Symbol">(</a><a id="8071" href="Test.Golden.html#7378" class="Bound">opts</a> <a id="8076" class="Symbol">.</a><a id="8077" href="Test.Golden.html#4818" class="Field">timing</a><a id="8083" class="Symbol">)</a> <a id="8085" href="Test.Golden.html#7492" class="Bound">time</a>
           <a id="8101" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8103" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8106" href="Test.Golden.html#7378" class="Bound">opts</a> <a id="8111" class="Symbol">.</a><a id="8112" href="Test.Golden.html#4988" class="Field">colour</a>
               <a id="8134" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8139" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8151" class="Symbol">(</a><a id="8152" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8162" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8173" href="System.Console.ANSI.html#699" class="InductiveConstructor">classic</a> <a id="8181" href="System.Console.ANSI.html#623" class="InductiveConstructor">green</a><a id="8186" class="Symbol">)</a>
               <a id="8203" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8208" href="Function.Base.html#704" class="Function">id</a>
           <a id="8222" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8224" class="String">&quot;success&quot;</a>
    <a id="8238" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8243" class="Keyword">do</a> <a id="8246" href="Test.Golden.html#10695" class="Function">printTiming</a> <a id="8258" class="Symbol">(</a><a id="8259" href="Test.Golden.html#7378" class="Bound">opts</a> <a id="8264" class="Symbol">.</a><a id="8265" href="Test.Golden.html#4818" class="Field">timing</a><a id="8271" class="Symbol">)</a> <a id="8273" href="Test.Golden.html#7492" class="Bound">time</a>
             <a id="8291" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8293" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8296" href="Test.Golden.html#7378" class="Bound">opts</a> <a id="8301" class="Symbol">.</a><a id="8302" href="Test.Golden.html#4988" class="Field">colour</a>
               <a id="8324" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8329" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8341" class="Symbol">(</a><a id="8342" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8352" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8363" href="System.Console.ANSI.html#707" class="InductiveConstructor">bright</a> <a id="8370" href="System.Console.ANSI.html#619" class="InductiveConstructor">red</a><a id="8373" class="Symbol">)</a>
               <a id="8390" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8395" href="Function.Base.html#704" class="Function">id</a>
             <a id="8411" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8413" class="String">&quot;FAILURE&quot;</a>
            <a id="8435" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8438" href="Test.Golden.html#7378" class="Bound">opts</a> <a id="8443" class="Symbol">.</a><a id="8444" href="Test.Golden.html#4750" class="Field">interactive</a>
              <a id="8470" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8475" href="Test.Golden.html#9879" class="Function">mayOverwrite</a> <a id="8488" class="Symbol">(</a><a id="8489" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8494" href="Test.Golden.html#7757" class="Bound">exp</a><a id="8497" class="Symbol">)</a> <a id="8499" href="Test.Golden.html#7672" class="Bound">out</a>
              <a id="8517" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8522" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="8531" class="Symbol">(</a><a id="8532" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="8540" class="Symbol">(</a><a id="8541" href="Test.Golden.html#9645" class="Function">expVsOut</a> <a id="8550" href="Test.Golden.html#7757" class="Bound">exp</a> <a id="8554" href="Test.Golden.html#7672" class="Bound">out</a><a id="8557" class="Symbol">))</a>

  <a id="8563" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="8568" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8570" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="8573" href="Test.Golden.html#8003" class="Bound">result</a> <a id="8580" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="8585" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8590" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="8599" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="8604" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8609" href="Test.Golden.html#7383" class="Bound">testPath</a>

  <a id="8621" class="Keyword">where</a>

    <a id="8632" href="Test.Golden.html#8632" class="Function">directoryNotFound</a> <a id="8650" class="Symbol">:</a> <a id="8652" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8663" href="Test.Golden.html#8632" class="Function">directoryNotFound</a> <a id="8681" class="Symbol">=</a> <a id="8683" href="Data.String.Base.html#2768" class="Function">unwords</a>
                      <a id="8713" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8715" class="String">&quot;Directory&quot;</a>
                      <a id="8749" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8751" href="Test.Golden.html#7383" class="Bound">testPath</a>
                      <a id="8782" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8784" class="String">&quot;does not exist&quot;</a> <a id="8801" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8803" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="8811" href="Test.Golden.html#8811" class="Function">fileNotFound</a> <a id="8824" class="Symbol">:</a> <a id="8826" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="8833" class="Symbol">→</a> <a id="8835" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8846" href="Test.Golden.html#8811" class="Function">fileNotFound</a> <a id="8859" href="Test.Golden.html#8859" class="Bound">name</a> <a id="8864" class="Symbol">=</a> <a id="8866" href="Data.String.Base.html#2768" class="Function">unwords</a>
                      <a id="8896" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="8898" class="String">&quot;File&quot;</a>
                      <a id="8927" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8929" class="Symbol">(</a><a id="8930" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="8939" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="8949" class="String">&quot;/output&quot;</a><a id="8958" class="Symbol">)</a>
                      <a id="8982" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8984" class="String">&quot;does not exist&quot;</a> <a id="9001" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9003" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="9011" href="Test.Golden.html#9011" class="Function">fail</a> <a id="9016" class="Symbol">:</a> <a id="9018" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9025" class="Symbol">→</a> <a id="9027" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="9030" href="Test.Golden.html#7232" class="Function">Result</a>
    <a id="9041" href="Test.Golden.html#9011" class="Function">fail</a> <a id="9046" href="Test.Golden.html#9046" class="Bound">msg</a> <a id="9050" class="Symbol">=</a> <a id="9052" class="Keyword">do</a> <a id="9055" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="9064" href="Test.Golden.html#9046" class="Bound">msg</a>
                  <a id="9086" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9091" class="Symbol">(</a><a id="9092" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="9097" href="Test.Golden.html#7383" class="Bound">testPath</a><a id="9105" class="Symbol">)</a>

    <a id="9112" href="Test.Golden.html#9112" class="Function">readLocalFile</a> <a id="9126" class="Symbol">:</a> <a id="9128" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9135" class="Symbol">→</a> <a id="9137" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="9140" class="Symbol">(</a><a id="9141" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9147" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="9153" class="Symbol">)</a>
    <a id="9159" href="Test.Golden.html#9112" class="Function">readLocalFile</a> <a id="9173" href="Test.Golden.html#9173" class="Bound">name</a> <a id="9178" class="Symbol">=</a> <a id="9180" class="Keyword">do</a>
      <a id="9189" class="Keyword">let</a> <a id="9193" href="Test.Golden.html#9193" class="Bound">fp</a> <a id="9196" class="Symbol">=</a> <a id="9198" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="9205" class="Symbol">(</a><a id="9206" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="9215" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9217" class="String">&quot;/&quot;</a> <a id="9221" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9223" href="Test.Golden.html#9173" class="Bound">name</a> <a id="9228" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9230" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="9232" class="Symbol">)</a>
      <a id="9240" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="9245" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="9247" href="System.Directory.html#3068" class="Function">doesFileExist</a> <a id="9261" class="Symbol">(</a><a id="9262" href="System.FilePath.Posix.Primitive.html#2561" class="Postulate">mkFilePath</a> <a id="9273" href="Test.Golden.html#9193" class="Bound">fp</a><a id="9275" class="Symbol">)</a>
        <a id="9285" class="Keyword">where</a> <a id="9291" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9297" class="Symbol">→</a> <a id="9299" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9304" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
      <a id="9318" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9323" href="IO.Base.html#2098" class="Function Operator">&lt;$&gt;</a> <a id="9327" href="IO.html#2922" class="Function">readFiniteFile</a> <a id="9342" href="Test.Golden.html#9193" class="Bound">fp</a>

    <a id="9350" href="Test.Golden.html#9350" class="Function">getAnswer</a> <a id="9360" class="Symbol">:</a> <a id="9362" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="9365" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="9374" href="Test.Golden.html#9350" class="Function">getAnswer</a> <a id="9384" class="Symbol">=</a> <a id="9386" href="IO.Base.html#4375" class="Function">untilJust</a> <a id="9396" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="9398" class="Keyword">do</a>
      <a id="9407" href="Test.Golden.html#9407" class="Bound">str</a> <a id="9411" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="9413" href="IO.Finite.html#1239" class="Function">getLine</a>
      <a id="9427" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="9432" href="Test.Golden.html#9407" class="Bound">str</a> <a id="9436" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="9439" class="Symbol">λ</a> <a id="9441" class="Keyword">where</a>
        <a id="9455" class="String">&quot;y&quot;</a> <a id="9459" class="Symbol">→</a> <a id="9461" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9466" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="9468" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9473" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>
        <a id="9486" class="String">&quot;n&quot;</a> <a id="9490" class="Symbol">→</a> <a id="9492" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9497" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="9499" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9504" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
        <a id="9518" class="String">&quot;&quot;</a>  <a id="9522" class="Symbol">→</a> <a id="9524" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9529" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="9531" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9536" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="9542" class="Comment">-- default answer is no</a>
        <a id="9574" class="Symbol">_</a>   <a id="9578" class="Symbol">→</a> <a id="9580" class="Keyword">do</a> <a id="9583" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="9592" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9627" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="9632" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>

    <a id="9645" href="Test.Golden.html#9645" class="Function">expVsOut</a> <a id="9654" class="Symbol">:</a> <a id="9656" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9663" class="Symbol">→</a> <a id="9665" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9672" class="Symbol">→</a> <a id="9674" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9679" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="9690" href="Test.Golden.html#9645" class="Function">expVsOut</a> <a id="9699" href="Test.Golden.html#9699" class="Bound">exp</a> <a id="9703" href="Test.Golden.html#9703" class="Bound">out</a> <a id="9707" class="Symbol">=</a> <a id="9709" class="String">&quot;Expected:&quot;</a> <a id="9721" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9723" href="Test.Golden.html#9699" class="Bound">exp</a> <a id="9727" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9729" class="String">&quot;Given:&quot;</a> <a id="9738" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9740" href="Test.Golden.html#9703" class="Bound">out</a> <a id="9744" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="9746" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="9754" href="Test.Golden.html#9754" class="Function">hasFailed</a> <a id="9764" class="Symbol">:</a> <a id="9766" href="System.Exit.Primitive.html#402" class="Datatype">ExitCode</a> <a id="9775" class="Symbol">→</a> <a id="9777" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a>
    <a id="9786" href="Test.Golden.html#9754" class="Function">hasFailed</a> <a id="9796" href="System.Exit.Primitive.html#425" class="InductiveConstructor">ExitSuccess</a>        <a id="9815" class="Symbol">=</a> <a id="9817" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a>
    <a id="9827" href="Test.Golden.html#9754" class="Function">hasFailed</a> <a id="9837" class="Symbol">(</a><a id="9838" href="System.Exit.Primitive.html#450" class="InductiveConstructor">ExitFailure</a> <a id="9850" href="Test.Golden.html#9850" class="Bound">code</a><a id="9854" class="Symbol">)</a> <a id="9856" class="Symbol">=</a> <a id="9858" href="Test.Golden.html#9850" class="Bound">code</a> <a id="9863" href="Data.Integer.Base.html#2628" class="Function Operator">ℤ.≤ᵇ</a> <a id="9868" href="Agda.Builtin.Int.html#263" class="InductiveConstructor Operator">ℤ.+</a> <a id="9872" class="Number">0</a>

    <a id="9879" href="Test.Golden.html#9879" class="Function">mayOverwrite</a> <a id="9892" class="Symbol">:</a> <a id="9894" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="9900" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9907" class="Symbol">→</a> <a id="9909" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="9916" class="Symbol">→</a> <a id="9918" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="9921" class="Symbol">_</a>
    <a id="9927" href="Test.Golden.html#9879" class="Function">mayOverwrite</a> <a id="9940" href="Test.Golden.html#9940" class="Bound">mexp</a> <a id="9945" href="Test.Golden.html#9945" class="Bound">out</a> <a id="9949" class="Symbol">=</a> <a id="9951" class="Keyword">do</a>
      <a id="9960" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="9965" href="Test.Golden.html#9940" class="Bound">mexp</a> <a id="9970" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="9973" class="Symbol">λ</a> <a id="9975" class="Keyword">where</a>
        <a id="9989" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="9997" class="Symbol">→</a> <a id="9999" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="10008" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10010" href="Data.String.Base.html#2826" class="Function">unlines</a>
          <a id="10028" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10030" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="10097" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10099" href="Test.Golden.html#9945" class="Bound">out</a>
          <a id="10113" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10115" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10158" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10160" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
        <a id="10171" class="Symbol">(</a><a id="10172" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="10177" href="Test.Golden.html#10177" class="Bound">exp</a><a id="10180" class="Symbol">)</a> <a id="10182" class="Symbol">→</a> <a id="10184" class="Keyword">do</a>
          <a id="10197" href="Test.Golden.html#10197" class="Bound">code</a> <a id="10202" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="10204" href="System.Process.html#735" class="Function">system</a> <a id="10211" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10213" href="Data.String.Base.html#2613" class="Function">concat</a>
            <a id="10232" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10234" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10299" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10301" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="10310" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10312" class="String">&quot;/expected &quot;</a>
            <a id="10337" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10339" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="10348" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10350" class="String">&quot;/output&quot;</a>
            <a id="10372" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10374" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
          <a id="10387" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="10396" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10398" href="Data.String.Base.html#2826" class="Function">unlines</a>
            <a id="10418" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10420" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10474" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10476" class="Symbol">(</a><a id="10477" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="10480" href="Test.Golden.html#9754" class="Function">hasFailed</a> <a id="10490" href="Test.Golden.html#10197" class="Bound">code</a> <a id="10495" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="10500" href="Test.Golden.html#9645" class="Function">expVsOut</a> <a id="10509" href="Test.Golden.html#10177" class="Bound">exp</a> <a id="10513" href="Test.Golden.html#9945" class="Bound">out</a> <a id="10517" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="10522" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10524" class="Symbol">)</a>
            <a id="10538" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="10541" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10602" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10604" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="10614" href="Test.Golden.html#10614" class="Bound">b</a> <a id="10616" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="10618" href="Test.Golden.html#9350" class="Function">getAnswer</a>
      <a id="10634" href="IO.Base.html#3580" class="Function">when</a> <a id="10639" href="Test.Golden.html#10614" class="Bound">b</a> <a id="10641" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10643" href="IO.Finite.html#1470" class="Function">writeFile</a> <a id="10653" class="Symbol">(</a><a id="10654" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="10663" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="10673" class="String">&quot;/expected&quot;</a><a id="10684" class="Symbol">)</a> <a id="10686" href="Test.Golden.html#9945" class="Bound">out</a>

    <a id="10695" href="Test.Golden.html#10695" class="Function">printTiming</a> <a id="10707" class="Symbol">:</a> <a id="10709" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="10714" class="Symbol">→</a> <a id="10716" href="System.Clock.html#1931" class="Record">Time</a> <a id="10721" class="Symbol">→</a> <a id="10723" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="10730" class="Symbol">→</a> <a id="10732" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="10735" class="Symbol">_</a>
    <a id="10741" href="Test.Golden.html#10695" class="Function">printTiming</a> <a id="10753" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="10759" class="Symbol">_</a>    <a id="10764" href="Test.Golden.html#10764" class="Bound">msg</a> <a id="10768" class="Symbol">=</a> <a id="10770" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="10779" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="10781" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="10788" class="Symbol">(</a><a id="10789" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="10798" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10800" class="String">&quot;: &quot;</a> <a id="10805" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10807" href="Test.Golden.html#10764" class="Bound">msg</a> <a id="10811" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10813" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10815" class="Symbol">)</a>
    <a id="10821" href="Test.Golden.html#10695" class="Function">printTiming</a> <a id="10833" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>  <a id="10839" href="Test.Golden.html#10839" class="Bound">time</a> <a id="10844" href="Test.Golden.html#10844" class="Bound">msg</a> <a id="10848" class="Symbol">=</a>
      <a id="10856" class="Keyword">let</a> <a id="10860" href="Test.Golden.html#10860" class="Bound">time</a>  <a id="10866" class="Symbol">=</a> <a id="10868" href="Data.Nat.Show.html#2025" class="Function">ℕ.show</a> <a id="10875" class="Symbol">(</a><a id="10876" href="Test.Golden.html#10839" class="Bound">time</a> <a id="10881" class="Symbol">.</a><a id="10882" href="System.Clock.html#1977" class="Field">seconds</a><a id="10889" class="Symbol">)</a> <a id="10891" href="Data.String.Base.html#2425" class="Function Operator">String.++</a> <a id="10901" class="String">&quot;s&quot;</a>
          <a id="10915" href="Test.Golden.html#10915" class="Bound">spent</a> <a id="10921" class="Symbol">=</a> <a id="10923" class="Number">9</a> <a id="10925" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="10927" href="Data.Nat.ListAction.html#612" class="Function">sum</a> <a id="10931" class="Symbol">(</a><a id="10932" href="Data.List.Base.html#1612" class="Function">List.map</a> <a id="10941" href="Data.String.Base.html#2489" class="Function">String.length</a> <a id="10955" class="Symbol">(</a><a id="10956" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="10965" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10967" href="Test.Golden.html#10860" class="Bound">time</a> <a id="10972" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="10974" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="10976" class="Symbol">))</a>
               <a id="10994" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="11070" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11153" href="Test.Golden.html#11153" class="Bound">pad</a>   <a id="11159" class="Symbol">=</a> <a id="11161" href="Data.String.Base.html#2540" class="Function">String.replicate</a> <a id="11178" class="Symbol">(</a><a id="11179" class="Number">72</a> <a id="11182" href="Data.Nat.Base.html#4462" class="Primitive Operator">∸</a> <a id="11184" href="Test.Golden.html#10915" class="Bound">spent</a><a id="11189" class="Symbol">)</a> <a id="11191" class="String">&#39; &#39;</a>
      <a id="11201" class="Keyword">in</a> <a id="11204" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="11213" class="Symbol">(</a><a id="11214" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="11221" class="Symbol">(</a><a id="11222" href="Test.Golden.html#7383" class="Bound">testPath</a> <a id="11231" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11233" class="String">&quot;: &quot;</a> <a id="11238" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11240" href="Test.Golden.html#10844" class="Bound">msg</a> <a id="11244" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11246" href="Test.Golden.html#11153" class="Bound">pad</a> <a id="11250" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11252" href="Test.Golden.html#10860" class="Bound">time</a> <a id="11257" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11259" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="11261" class="Symbol">))</a>

<a id="11265" class="Comment">-- A test pool is characterised by</a>
<a id="11300" class="Comment">--  + a name</a>
<a id="11313" class="Comment">--  + and a list of directory paths</a>
<a id="11349" class="Keyword">record</a> <a id="TestPool"></a><a id="11356" href="Test.Golden.html#11356" class="Record">TestPool</a> <a id="11365" class="Symbol">:</a> <a id="11367" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="11371" class="Keyword">where</a>
  <a id="11379" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11391" href="Test.Golden.html#11391" class="InductiveConstructor">mkTestPool</a>
  <a id="11404" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11414" href="Test.Golden.html#11414" class="Field">poolName</a> <a id="11423" class="Symbol">:</a> <a id="11425" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11436" href="Test.Golden.html#11436" class="Field">testCases</a> <a id="11446" class="Symbol">:</a> <a id="11448" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11453" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="11460" class="Keyword">open</a> <a id="11465" href="Test.Golden.html#11356" class="Module">TestPool</a>

<a id="11475" class="Keyword">module</a> <a id="Summary"></a><a id="11482" href="Test.Golden.html#11482" class="Module">Summary</a> <a id="11490" class="Keyword">where</a>

  <a id="11499" class="Comment">-- The summary of a test pool run</a>
  <a id="11535" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11542" href="Test.Golden.html#11542" class="Record">Summary</a> <a id="11550" class="Symbol">:</a> <a id="11552" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="11556" class="Keyword">where</a>
    <a id="11566" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11578" href="Test.Golden.html#11578" class="InductiveConstructor">mkSummary</a>
    <a id="11592" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11604" href="Test.Golden.html#11604" class="Field">success</a> <a id="11612" class="Symbol">:</a> <a id="11614" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11619" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11632" href="Test.Golden.html#11632" class="Field">failure</a> <a id="11640" class="Symbol">:</a> <a id="11642" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11647" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="11656" class="Keyword">open</a> <a id="11661" href="Test.Golden.html#11542" class="Module">Summary</a> <a id="11669" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11679" href="Test.Golden.html#11679" class="Function">init</a> <a id="11684" class="Symbol">:</a> <a id="11686" href="Test.Golden.html#11542" class="Record">Summary</a>
  <a id="11696" href="Test.Golden.html#11679" class="Function">init</a> <a id="11701" class="Symbol">=</a> <a id="11703" href="Test.Golden.html#11578" class="InductiveConstructor">mkSummary</a> <a id="11713" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="11716" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11722" href="Test.Golden.html#11722" class="Function">merge</a> <a id="11728" class="Symbol">:</a> <a id="11730" href="Test.Golden.html#11542" class="Record">Summary</a> <a id="11738" class="Symbol">→</a> <a id="11740" href="Test.Golden.html#11542" class="Record">Summary</a> <a id="11748" class="Symbol">→</a> <a id="11750" href="Test.Golden.html#11542" class="Record">Summary</a>
  <a id="11760" href="Test.Golden.html#11722" class="Function">merge</a> <a id="11766" class="Symbol">(</a><a id="11767" href="Test.Golden.html#11578" class="InductiveConstructor">mkSummary</a> <a id="11777" href="Test.Golden.html#11777" class="Bound">ws1</a> <a id="11781" href="Test.Golden.html#11781" class="Bound">ls1</a><a id="11784" class="Symbol">)</a> <a id="11786" class="Symbol">(</a><a id="11787" href="Test.Golden.html#11578" class="InductiveConstructor">mkSummary</a> <a id="11797" href="Test.Golden.html#11797" class="Bound">ws2</a> <a id="11801" href="Test.Golden.html#11801" class="Bound">ls2</a><a id="11804" class="Symbol">)</a> <a id="11806" class="Symbol">=</a>
   <a id="11811" href="Test.Golden.html#11578" class="InductiveConstructor">mkSummary</a> <a id="11821" class="Symbol">(</a><a id="11822" href="Test.Golden.html#11797" class="Bound">ws2</a> <a id="11826" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="11829" href="Test.Golden.html#11777" class="Bound">ws1</a><a id="11832" class="Symbol">)</a> <a id="11834" class="Symbol">(</a><a id="11835" href="Test.Golden.html#11801" class="Bound">ls2</a> <a id="11839" href="Data.List.Base.html#1712" class="Function Operator">++</a> <a id="11842" href="Test.Golden.html#11781" class="Bound">ls1</a><a id="11845" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11850" href="Test.Golden.html#11850" class="Function">update</a> <a id="11857" class="Symbol">:</a> <a id="11859" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="11864" href="Test.Golden.html#7232" class="Function">Result</a> <a id="11871" class="Symbol">→</a> <a id="11873" href="Test.Golden.html#11542" class="Record">Summary</a> <a id="11881" class="Symbol">→</a> <a id="11883" href="Test.Golden.html#11542" class="Record">Summary</a>
  <a id="11893" href="Test.Golden.html#11850" class="Function">update</a> <a id="11900" href="Test.Golden.html#11900" class="Bound">res</a> <a id="11904" href="Test.Golden.html#11904" class="Bound">sum</a> <a id="11908" class="Symbol">=</a>
    <a id="11914" class="Keyword">let</a> <a id="11918" class="Symbol">(</a><a id="11919" href="Test.Golden.html#11919" class="Bound">ls2</a> <a id="11923" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="11925" href="Test.Golden.html#11925" class="Bound">ws2</a><a id="11928" class="Symbol">)</a> <a id="11930" class="Symbol">=</a> <a id="11932" href="Data.List.Base.html#3674" class="Function">partitionSums</a> <a id="11946" href="Test.Golden.html#11900" class="Bound">res</a> <a id="11950" class="Keyword">in</a>
    <a id="11957" href="Test.Golden.html#11722" class="Function">merge</a> <a id="11963" href="Test.Golden.html#11904" class="Bound">sum</a> <a id="11967" class="Symbol">(</a><a id="11968" href="Test.Golden.html#11578" class="InductiveConstructor">mkSummary</a> <a id="11978" href="Test.Golden.html#11925" class="Bound">ws2</a> <a id="11982" href="Test.Golden.html#11919" class="Bound">ls2</a><a id="11985" class="Symbol">)</a>

<a id="11988" class="Keyword">open</a> <a id="11993" href="Test.Golden.html#11482" class="Module">Summary</a> <a id="12001" class="Keyword">using</a> <a id="12007" class="Symbol">(</a><a id="12008" href="Test.Golden.html#11542" class="Record">Summary</a><a id="12015" class="Symbol">)</a> <a id="12017" class="Keyword">hiding</a> <a id="12024" class="Symbol">(</a><a id="12025" class="Keyword">module</a> <a id="12032" href="Test.Golden.html#11542" class="Module">Summary</a><a id="12039" class="Symbol">)</a>

<a id="12042" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="12090" href="Test.Golden.html#12090" class="Function">filterTests</a> <a id="12102" class="Symbol">:</a> <a id="12104" href="Test.Golden.html#4518" class="Record">Options</a> <a id="12112" class="Symbol">→</a> <a id="12114" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12119" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="12126" class="Symbol">→</a> <a id="12128" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12133" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="12140" href="Test.Golden.html#12090" class="Function">filterTests</a> <a id="12152" href="Test.Golden.html#12152" class="Bound">opts</a> <a id="12157" class="Symbol">=</a> <a id="12159" href="Function.Base.html#4061" class="Function Operator">case</a> <a id="12164" href="Test.Golden.html#4671" class="Field">onlyNames</a> <a id="12174" href="Test.Golden.html#12152" class="Bound">opts</a> <a id="12179" href="Function.Base.html#4061" class="Function Operator">of</a> <a id="12182" class="Symbol">λ</a> <a id="12184" class="Keyword">where</a>
  <a id="12192" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12195" class="Symbol">→</a> <a id="12197" href="Function.Base.html#704" class="Function">id</a>
  <a id="12202" href="Test.Golden.html#12202" class="CatchallClause Bound">xs</a> <a id="12205" class="Symbol">→</a> <a id="12207" class="Keyword">let</a> <a id="12211" href="Test.Golden.html#12211" class="Bound">names</a> <a id="12217" class="Symbol">=</a> <a id="12219" href="Data.List.Base.html#1612" class="Function">List.map</a> <a id="12228" href="Data.String.Base.html#1558" class="Primitive">String.toList</a> <a id="12242" href="Test.Golden.html#12202" class="Bound">xs</a> <a id="12245" class="Keyword">in</a>
       <a id="12255" href="Data.List.Base.html#10389" class="Function">filter</a> <a id="12262" class="Symbol">(λ</a> <a id="12265" href="Test.Golden.html#12265" class="Bound">n</a> <a id="12267" class="Symbol">→</a> <a id="12269" href="Data.List.Relation.Unary.Any.html#2684" class="Function">any?</a> <a id="12274" class="Symbol">(λ</a> <a id="12277" href="Test.Golden.html#12277" class="Bound">m</a> <a id="12279" class="Symbol">→</a> <a id="12281" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6763" class="Function">infix?</a> <a id="12288" href="Data.Char.Properties.html#2550" class="Function Operator">Char._≟_</a> <a id="12297" href="Test.Golden.html#12277" class="Bound">m</a> <a id="12299" class="Symbol">(</a><a id="12300" href="Data.String.Base.html#1558" class="Primitive">String.toList</a> <a id="12314" href="Test.Golden.html#12265" class="Bound">n</a><a id="12315" class="Symbol">))</a> <a id="12318" href="Test.Golden.html#12211" class="Bound">names</a><a id="12323" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12326" href="Test.Golden.html#12326" class="Function">poolRunner</a> <a id="12337" class="Symbol">:</a> <a id="12339" href="Test.Golden.html#4518" class="Record">Options</a> <a id="12347" class="Symbol">→</a> <a id="12349" href="Test.Golden.html#11356" class="Record">TestPool</a> <a id="12358" class="Symbol">→</a> <a id="12360" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="12363" href="Test.Golden.html#11542" class="Record">Summary</a>
<a id="12371" href="Test.Golden.html#12326" class="Function">poolRunner</a> <a id="12382" href="Test.Golden.html#12382" class="Bound">opts</a> <a id="12387" href="Test.Golden.html#12387" class="Bound">pool</a> <a id="12392" class="Symbol">=</a> <a id="12394" class="Keyword">do</a>
  <a id="12399" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12460" class="Keyword">let</a> <a id="12464" href="Test.Golden.html#12464" class="Bound">tests</a> <a id="12470" class="Symbol">=</a> <a id="12472" href="Test.Golden.html#12090" class="Function">filterTests</a> <a id="12484" href="Test.Golden.html#12382" class="Bound">opts</a> <a id="12489" class="Symbol">(</a><a id="12490" href="Test.Golden.html#12387" class="Bound">pool</a> <a id="12495" class="Symbol">.</a><a id="12496" href="Test.Golden.html#11436" class="Field">testCases</a><a id="12505" class="Symbol">)</a>
  <a id="12509" class="Symbol">(_</a> <a id="12512" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12514" class="Symbol">_)</a> <a id="12517" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="12519" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="12524" href="Test.Golden.html#12464" class="Bound">tests</a>
    <a id="12534" class="Keyword">where</a> <a id="12540" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12543" class="Symbol">→</a> <a id="12545" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="12550" href="Test.Golden.html#11679" class="Function">Summary.init</a>

  <a id="12566" class="Comment">-- announce the test pool and run them</a>
  <a id="12607" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="12616" href="Test.Golden.html#12721" class="Function">banner</a>
  <a id="12625" href="Test.Golden.html#12851" class="Function">loop</a> <a id="12630" href="Test.Golden.html#11679" class="Function">Summary.init</a> <a id="12643" href="Test.Golden.html#12464" class="Bound">tests</a>

  <a id="12652" class="Keyword">where</a>

  <a id="12661" href="Test.Golden.html#12661" class="Function">separator</a> <a id="12671" class="Symbol">:</a> <a id="12673" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="12682" href="Test.Golden.html#12661" class="Function">separator</a> <a id="12692" class="Symbol">=</a> <a id="12694" href="Data.String.Base.html#2540" class="Function">String.replicate</a> <a id="12711" class="Number">72</a> <a id="12714" class="String">&#39;-&#39;</a>

  <a id="12721" href="Test.Golden.html#12721" class="Function">banner</a> <a id="12728" class="Symbol">:</a> <a id="12730" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
  <a id="12739" href="Test.Golden.html#12721" class="Function">banner</a> <a id="12746" class="Symbol">=</a> <a id="12748" href="Data.String.Base.html#2826" class="Function">unlines</a>
         <a id="12765" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="12767" class="String">&quot;&quot;</a> <a id="12770" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12772" href="Test.Golden.html#12661" class="Function">separator</a>
         <a id="12791" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12793" href="Test.Golden.html#12387" class="Bound">pool</a> <a id="12798" class="Symbol">.</a><a id="12799" href="Test.Golden.html#11414" class="Field">poolName</a>
         <a id="12817" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12819" href="Test.Golden.html#12661" class="Function">separator</a> <a id="12829" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12831" class="String">&quot;&quot;</a>
         <a id="12843" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12845" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="12851" href="Test.Golden.html#12851" class="Function">loop</a> <a id="12856" class="Symbol">:</a> <a id="12858" href="Test.Golden.html#11542" class="Record">Summary</a> <a id="12866" class="Symbol">→</a> <a id="12868" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="12873" href="Agda.Builtin.String.html#335" class="Postulate">String</a> <a id="12880" class="Symbol">→</a> <a id="12882" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="12885" href="Test.Golden.html#11542" class="Record">Summary</a>
  <a id="12895" href="Test.Golden.html#12851" class="Function">loop</a> <a id="12900" href="Test.Golden.html#12900" class="Bound">acc</a> <a id="12904" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="12907" class="Symbol">=</a> <a id="12909" href="IO.Base.html#1374" class="InductiveConstructor">pure</a> <a id="12914" href="Test.Golden.html#12900" class="Bound">acc</a>
  <a id="12920" href="Test.Golden.html#12851" class="Function">loop</a> <a id="12925" href="Test.Golden.html#12925" class="Bound">acc</a> <a id="12929" class="Symbol">(</a><a id="12930" href="Test.Golden.html#12930" class="Bound">test</a> <a id="12935" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12937" href="Test.Golden.html#12937" class="Bound">tests</a><a id="12942" class="Symbol">)</a> <a id="12944" class="Symbol">=</a> <a id="12946" class="Keyword">do</a>
    <a id="12953" href="Test.Golden.html#12953" class="Bound">res</a> <a id="12957" href="IO.Base.html#2209" class="Function Operator">&lt;-</a> <a id="12960" href="Test.Golden.html#7331" class="Function">runTest</a> <a id="12968" href="Test.Golden.html#12382" class="Bound">opts</a> <a id="12973" href="Test.Golden.html#12930" class="Bound">test</a>
    <a id="12982" href="Test.Golden.html#12851" class="Function">loop</a> <a id="12987" class="Symbol">(</a><a id="12988" href="Test.Golden.html#11850" class="Function">Summary.update</a> <a id="13003" class="Symbol">(</a><a id="13004" href="Test.Golden.html#12953" class="Bound">res</a> <a id="13008" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13010" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="13012" class="Symbol">)</a> <a id="13014" href="Test.Golden.html#12925" class="Bound">acc</a><a id="13017" class="Symbol">)</a> <a id="13019" href="Test.Golden.html#12937" class="Bound">tests</a>

<a id="runner"></a><a id="13026" href="Test.Golden.html#13026" class="Function">runner</a> <a id="13033" class="Symbol">:</a> <a id="13035" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="13040" href="Test.Golden.html#11356" class="Record">TestPool</a> <a id="13049" class="Symbol">→</a> <a id="13051" href="IO.Base.html#1305" class="Datatype">IO</a> <a id="13054" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="13056" href="Test.Golden.html#13026" class="Function">runner</a> <a id="13063" href="Test.Golden.html#13063" class="Bound">tests</a> <a id="13069" class="Symbol">=</a> <a id="13071" class="Keyword">do</a>
  <a id="13076" class="Comment">-- figure out the options</a>
  <a id="13104" href="Test.Golden.html#13104" class="Bound">args</a> <a id="13109" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="13111" href="System.Environment.html#660" class="Function">getArgs</a>
  <a id="13121" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="13126" href="Test.Golden.html#13126" class="Bound">opts</a> <a id="13131" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="13133" href="Test.Golden.html#5706" class="Function">options</a> <a id="13141" href="Test.Golden.html#13104" class="Bound">args</a>
    <a id="13150" class="Keyword">where</a> <a id="13156" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="13161" href="Test.Golden.html#13161" class="Bound">err</a> <a id="13165" class="Symbol">→</a> <a id="13167" href="System.Exit.html#1366" class="Function">die</a> <a id="13171" class="Symbol">(</a><a id="13172" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="13180" class="Symbol">(</a><a id="13181" href="Test.Golden.html#5519" class="Function">show</a> <a id="13186" href="Test.Golden.html#13161" class="Bound">err</a> <a id="13190" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13192" href="Test.Golden.html#5223" class="Function">usage</a> <a id="13198" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13200" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="13202" class="Symbol">))</a>

  <a id="13208" class="Comment">-- run the tests</a>
  <a id="13227" href="Test.Golden.html#13227" class="Bound">ress</a> <a id="13232" href="IO.Base.html#2209" class="Function Operator">←</a> <a id="13234" href="IO.html#2094" class="Function">List.mapM</a> <a id="13244" class="Symbol">(</a><a id="13245" href="Test.Golden.html#12326" class="Function">poolRunner</a> <a id="13256" href="Test.Golden.html#13126" class="Bound">opts</a><a id="13260" class="Symbol">)</a> <a id="13262" href="Test.Golden.html#13063" class="Bound">tests</a>
  <a id="13270" class="Keyword">let</a> <a id="13274" class="Keyword">open</a> <a id="13279" href="Test.Golden.html#11482" class="Module">Summary</a>
  <a id="13289" class="Keyword">let</a> <a id="13293" href="Test.Golden.html#13293" class="Bound">res</a> <a id="13297" class="Symbol">=</a> <a id="13299" href="Data.List.Base.html#4227" class="Function">List.foldl</a> <a id="13310" href="Test.Golden.html#11722" class="Function">merge</a> <a id="13316" href="Test.Golden.html#11679" class="Function">init</a> <a id="13321" href="Test.Golden.html#13227" class="Bound">ress</a>

  <a id="13329" class="Comment">-- report the result</a>
  <a id="13352" class="Keyword">let</a> <a id="13356" href="Test.Golden.html#13356" class="Bound">nsucc</a> <a id="13362" class="Symbol">=</a> <a id="13364" href="Data.List.Base.html#4746" class="Function">List.length</a> <a id="13376" class="Symbol">(</a><a id="13377" href="Test.Golden.html#13293" class="Bound">res</a> <a id="13381" class="Symbol">.</a><a id="13382" href="Test.Golden.html#11604" class="Field">success</a><a id="13389" class="Symbol">)</a>
  <a id="13393" class="Keyword">let</a> <a id="13397" href="Test.Golden.html#13397" class="Bound">nfail</a> <a id="13403" class="Symbol">=</a> <a id="13405" href="Data.List.Base.html#4746" class="Function">List.length</a> <a id="13417" class="Symbol">(</a><a id="13418" href="Test.Golden.html#13293" class="Bound">res</a> <a id="13422" class="Symbol">.</a><a id="13423" href="Test.Golden.html#11632" class="Field">failure</a><a id="13430" class="Symbol">)</a>
  <a id="13434" class="Keyword">let</a> <a id="13438" href="Test.Golden.html#13438" class="Bound">ntotal</a> <a id="13445" class="Symbol">=</a> <a id="13447" href="Test.Golden.html#13356" class="Bound">nsucc</a> <a id="13453" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="13455" href="Test.Golden.html#13397" class="Bound">nfail</a>
  <a id="13463" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="13472" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13474" href="Data.String.Base.html#2613" class="Function">concat</a> <a id="13481" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13483" href="Data.Nat.Show.html#2025" class="Function">ℕ.show</a> <a id="13490" href="Test.Golden.html#13356" class="Bound">nsucc</a> <a id="13496" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13498" class="String">&quot;/&quot;</a> <a id="13502" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13504" href="Data.Nat.Show.html#2025" class="Function">ℕ.show</a> <a id="13511" href="Test.Golden.html#13438" class="Bound">ntotal</a> <a id="13518" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13520" class="String">&quot; tests successful&quot;</a> <a id="13540" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="13542" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

  <a id="13548" class="Comment">-- deal with failures</a>
  <a id="13572" class="Keyword">let</a> <a id="13576" href="Test.Golden.html#13576" class="Bound">list</a> <a id="13581" class="Symbol">=</a> <a id="13583" href="Data.String.Base.html#2826" class="Function">unlines</a> <a id="13591" class="Symbol">(</a><a id="13592" href="Test.Golden.html#13293" class="Bound">res</a> <a id="13596" class="Symbol">.</a><a id="13597" href="Test.Golden.html#11632" class="Field">failure</a><a id="13604" class="Symbol">)</a>
  <a id="13608" href="IO.Base.html#3580" class="Function">when</a> <a id="13613" class="Symbol">(</a><a id="13614" class="Number">0</a> <a id="13616" href="Data.Nat.Base.html#1463" class="Primitive Operator">&lt;ᵇ</a> <a id="13619" href="Test.Golden.html#13397" class="Bound">nfail</a><a id="13624" class="Symbol">)</a> <a id="13626" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13628" class="Keyword">do</a>
    <a id="13635" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="13644" class="String">&quot;Failing tests:&quot;</a>
    <a id="13665" href="IO.Finite.html#1700" class="Function">putStrLn</a> <a id="13674" href="Test.Golden.html#13576" class="Bound">list</a>
  <a id="13681" href="IO.Base.html#3810" class="Function">whenJust</a> <a id="13690" class="Symbol">(</a><a id="13691" href="Test.Golden.html#13126" class="Bound">opts</a> <a id="13696" class="Symbol">.</a><a id="13697" href="Test.Golden.html#4896" class="Field">failureFile</a><a id="13708" class="Symbol">)</a> <a id="13710" href="Function.Base.html#1993" class="Function Operator">$</a> <a id="13712" class="Symbol">λ</a> <a id="13714" href="Test.Golden.html#13714" class="Bound">fp</a> <a id="13717" class="Symbol">→</a> <a id="13719" href="IO.Finite.html#1470" class="Function">writeFile</a> <a id="13729" href="Test.Golden.html#13714" class="Bound">fp</a> <a id="13732" href="Test.Golden.html#13576" class="Bound">list</a>

  <a id="13740" class="Comment">-- exit</a>
  <a id="13750" href="Data.Bool.Base.html#1515" class="Function Operator">if</a> <a id="13753" class="Number">0</a> <a id="13755" href="Data.Nat.Base.html#1289" class="Primitive Operator">≡ᵇ</a> <a id="13758" href="Test.Golden.html#13397" class="Bound">nfail</a>
   <a id="13767" href="Data.Bool.Base.html#1515" class="Function Operator">then</a> <a id="13772" href="System.Exit.html#1311" class="Function">exitSuccess</a>
   <a id="13787" href="Data.Bool.Base.html#1515" class="Function Operator">else</a> <a id="13792" href="System.Exit.html#1248" class="Function">exitFailure</a>
</pre></body></html>