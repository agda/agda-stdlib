<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Format.Generic</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Format strings for Printf and Scanf</a>
<a id="145" class="Comment">------------------------------------------------------------------------</a>

<a id="219" class="Symbol">{-#</a> <a id="223" class="Keyword">OPTIONS</a> <a id="231" class="Pragma">--without-K</a> <a id="243" class="Pragma">--safe</a> <a id="250" class="Symbol">#-}</a>

<a id="255" class="Keyword">open</a> <a id="260" class="Keyword">import</a> <a id="267" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="282" class="Keyword">using</a> <a id="288" class="Symbol">(</a><a id="289" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a><a id="293" class="Symbol">)</a>
<a id="295" class="Keyword">open</a> <a id="300" class="Keyword">import</a> <a id="307" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="323" class="Keyword">using</a> <a id="329" class="Symbol">(</a><a id="330" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a><a id="335" class="Symbol">)</a>

<a id="338" class="Keyword">module</a> <a id="345" href="Text.Format.Generic.html" class="Module">Text.Format.Generic</a> <a id="365" class="Keyword">where</a>

<a id="372" class="Keyword">open</a> <a id="377" class="Keyword">import</a> <a id="384" href="Level.html" class="Module">Level</a> <a id="390" class="Keyword">using</a> <a id="396" class="Symbol">(</a><a id="397" href="Level.html#512" class="Function">0ℓ</a><a id="399" class="Symbol">)</a>
<a id="401" class="Keyword">open</a> <a id="406" class="Keyword">import</a> <a id="413" href="Category.Applicative.html" class="Module">Category.Applicative</a>
<a id="434" class="Keyword">open</a> <a id="439" class="Keyword">import</a> <a id="446" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="461" class="Symbol">as</a> <a id="464" class="Module">List</a>
<a id="469" class="Keyword">open</a> <a id="474" class="Keyword">import</a> <a id="481" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="492" class="Symbol">as</a> <a id="495" class="Module">Maybe</a>
<a id="501" class="Keyword">open</a> <a id="506" class="Keyword">import</a> <a id="513" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="527" class="Keyword">open</a> <a id="532" class="Keyword">import</a> <a id="539" href="Data.Product.html" class="Module">Data.Product</a>
<a id="552" class="Keyword">open</a> <a id="557" class="Keyword">import</a> <a id="564" href="Data.Product.Nary.NonDependent.html" class="Module">Data.Product.Nary.NonDependent</a>
<a id="595" class="Keyword">open</a> <a id="600" class="Keyword">import</a> <a id="607" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a>
<a id="621" class="Keyword">open</a> <a id="626" class="Keyword">import</a> <a id="633" href="Data.String.Base.html" class="Module">Data.String.Base</a>
<a id="650" class="Keyword">import</a> <a id="657" href="Data.Sum.Categorical.Left.html" class="Module">Data.Sum.Categorical.Left</a> <a id="683" class="Symbol">as</a> <a id="686" class="Module">Sumₗ</a>
<a id="691" class="Keyword">open</a> <a id="696" class="Keyword">import</a> <a id="703" href="Function.html" class="Module">Function</a>
<a id="712" class="Keyword">open</a> <a id="717" class="Keyword">import</a> <a id="724" href="Function.Nary.NonDependent.html" class="Module">Function.Nary.NonDependent</a> <a id="751" class="Keyword">using</a> <a id="757" class="Symbol">(</a><a id="758" href="Function.Nary.NonDependent.html#1531" class="Function">0ℓs</a><a id="761" class="Symbol">;</a> <a id="763" href="Function.Nary.NonDependent.Base.html#2325" class="Function">Sets</a><a id="767" class="Symbol">)</a>
<a id="769" class="Keyword">open</a> <a id="774" class="Keyword">import</a> <a id="781" href="Strict.html" class="Module">Strict</a>

<a id="789" class="Comment">------------------------------------------------------------------------</a>
<a id="862" class="Comment">-- Format specifications.</a>
<a id="888" class="Comment">-- Defines the supported %-codes.</a>

<a id="923" class="Keyword">record</a> <a id="FormatSpec"></a><a id="930" href="Text.Format.Generic.html#930" class="Record">FormatSpec</a> <a id="941" class="Symbol">:</a> <a id="943" href="Agda.Primitive.html#326" class="Primitive">Set₁</a> <a id="948" class="Keyword">where</a>
  <a id="956" class="Keyword">field</a>
    <a id="FormatSpec.ArgChunk"></a><a id="966" href="Text.Format.Generic.html#966" class="Field">ArgChunk</a> <a id="975" class="Symbol">:</a> <a id="977" href="Agda.Primitive.html#326" class="Primitive">Set</a>
    <a id="FormatSpec.ArgType"></a><a id="985" href="Text.Format.Generic.html#985" class="Field">ArgType</a>  <a id="994" class="Symbol">:</a> <a id="996" href="Text.Format.Generic.html#966" class="Field">ArgChunk</a> <a id="1005" class="Symbol">→</a> <a id="1007" href="Agda.Primitive.html#326" class="Primitive">Set</a>
    <a id="FormatSpec.lexArg"></a><a id="1015" href="Text.Format.Generic.html#1015" class="Field">lexArg</a>   <a id="1024" class="Symbol">:</a> <a id="1026" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="1031" class="Symbol">→</a> <a id="1033" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="1039" href="Text.Format.Generic.html#966" class="Field">ArgChunk</a>

<a id="1049" class="Keyword">module</a> <a id="1056" href="Text.Format.Generic.html#1056" class="Module">_</a> <a id="1058" class="Keyword">where</a>
  <a id="1066" class="Keyword">open</a> <a id="1071" href="Text.Format.Generic.html#930" class="Module">FormatSpec</a>

  <a id="1085" class="Comment">-- Left-biased union of format specs.</a>
  <a id="1125" href="Text.Format.Generic.html#1125" class="Function">unionSpec</a> <a id="1135" class="Symbol">:</a> <a id="1137" href="Text.Format.Generic.html#930" class="Record">FormatSpec</a> <a id="1148" class="Symbol">→</a> <a id="1150" href="Text.Format.Generic.html#930" class="Record">FormatSpec</a> <a id="1161" class="Symbol">→</a> <a id="1163" href="Text.Format.Generic.html#930" class="Record">FormatSpec</a>
  <a id="1176" href="Text.Format.Generic.html#1125" class="Function">unionSpec</a> <a id="1186" href="Text.Format.Generic.html#1186" class="Bound">spec₁</a> <a id="1192" href="Text.Format.Generic.html#1192" class="Bound">spec₂</a> <a id="1198" class="Symbol">.</a><a id="1199" href="Text.Format.Generic.html#966" class="Field">ArgChunk</a>  <a id="1209" class="Symbol">=</a> <a id="1211" href="Text.Format.Generic.html#1186" class="Bound">spec₁</a> <a id="1217" class="Symbol">.</a><a id="1218" href="Text.Format.Generic.html#966" class="Field">ArgChunk</a> <a id="1227" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="1229" href="Text.Format.Generic.html#1192" class="Bound">spec₂</a> <a id="1235" class="Symbol">.</a><a id="1236" href="Text.Format.Generic.html#966" class="Field">ArgChunk</a>
  <a id="1247" href="Text.Format.Generic.html#1125" class="Function">unionSpec</a> <a id="1257" href="Text.Format.Generic.html#1257" class="Bound">spec₁</a> <a id="1263" href="Text.Format.Generic.html#1263" class="Bound">spec₂</a> <a id="1269" class="Symbol">.</a><a id="1270" href="Text.Format.Generic.html#985" class="Field">ArgType</a> <a id="1278" class="Symbol">(</a><a id="1279" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="1284" href="Text.Format.Generic.html#1284" class="Bound">a</a><a id="1285" class="Symbol">)</a> <a id="1287" class="Symbol">=</a> <a id="1289" href="Text.Format.Generic.html#1257" class="Bound">spec₁</a> <a id="1295" class="Symbol">.</a><a id="1296" href="Text.Format.Generic.html#985" class="Field">ArgType</a> <a id="1304" href="Text.Format.Generic.html#1284" class="Bound">a</a>
  <a id="1308" href="Text.Format.Generic.html#1125" class="Function">unionSpec</a> <a id="1318" href="Text.Format.Generic.html#1318" class="Bound">spec₁</a> <a id="1324" href="Text.Format.Generic.html#1324" class="Bound">spec₂</a> <a id="1330" class="Symbol">.</a><a id="1331" href="Text.Format.Generic.html#985" class="Field">ArgType</a> <a id="1339" class="Symbol">(</a><a id="1340" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="1345" href="Text.Format.Generic.html#1345" class="Bound">a</a><a id="1346" class="Symbol">)</a> <a id="1348" class="Symbol">=</a> <a id="1350" href="Text.Format.Generic.html#1324" class="Bound">spec₂</a> <a id="1356" class="Symbol">.</a><a id="1357" href="Text.Format.Generic.html#985" class="Field">ArgType</a> <a id="1365" href="Text.Format.Generic.html#1345" class="Bound">a</a>
  <a id="1369" href="Text.Format.Generic.html#1125" class="Function">unionSpec</a> <a id="1379" href="Text.Format.Generic.html#1379" class="Bound">spec₁</a> <a id="1385" href="Text.Format.Generic.html#1385" class="Bound">spec₂</a> <a id="1391" class="Symbol">.</a><a id="1392" href="Text.Format.Generic.html#1015" class="Field">lexArg</a>  <a id="1400" href="Text.Format.Generic.html#1400" class="Bound">c</a> <a id="1402" class="Symbol">=</a>
    <a id="1408" href="Data.Maybe.Base.html#2020" class="Function">Maybe.map</a> <a id="1418" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="1423" class="Symbol">(</a><a id="1424" href="Text.Format.Generic.html#1379" class="Bound">spec₁</a> <a id="1430" class="Symbol">.</a><a id="1431" href="Text.Format.Generic.html#1015" class="Field">lexArg</a> <a id="1438" href="Text.Format.Generic.html#1400" class="Bound">c</a><a id="1439" class="Symbol">)</a> <a id="1441" href="Data.Maybe.Base.html#2335" class="Function Operator">&lt;∣&gt;</a>
    <a id="1449" href="Data.Maybe.Base.html#2020" class="Function">Maybe.map</a> <a id="1459" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="1464" class="Symbol">(</a><a id="1465" href="Text.Format.Generic.html#1385" class="Bound">spec₂</a> <a id="1471" class="Symbol">.</a><a id="1472" href="Text.Format.Generic.html#1015" class="Field">lexArg</a> <a id="1479" href="Text.Format.Generic.html#1400" class="Bound">c</a><a id="1480" class="Symbol">)</a>

<a id="1483" class="Keyword">module</a> <a id="Format"></a><a id="1490" href="Text.Format.Generic.html#1490" class="Module">Format</a> <a id="1497" class="Symbol">(</a><a id="1498" href="Text.Format.Generic.html#1498" class="Bound">spec</a> <a id="1503" class="Symbol">:</a> <a id="1505" href="Text.Format.Generic.html#930" class="Record">FormatSpec</a><a id="1515" class="Symbol">)</a> <a id="1517" class="Keyword">where</a>

  <a id="1526" class="Keyword">open</a> <a id="1531" href="Text.Format.Generic.html#930" class="Module">FormatSpec</a> <a id="1542" href="Text.Format.Generic.html#1498" class="Bound">spec</a>

  <a id="1550" class="Comment">------------------------------------------------------------------------</a>
  <a id="1625" class="Comment">-- Basic types</a>

  <a id="1643" class="Keyword">data</a> <a id="Format.Chunk"></a><a id="1648" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a> <a id="1654" class="Symbol">:</a> <a id="1656" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1660" class="Keyword">where</a>
    <a id="Format.Chunk.Arg"></a><a id="1670" href="Text.Format.Generic.html#1670" class="InductiveConstructor">Arg</a> <a id="1674" class="Symbol">:</a> <a id="1676" href="Text.Format.Generic.html#966" class="Field">ArgChunk</a> <a id="1685" class="Symbol">→</a> <a id="1687" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a>
    <a id="Format.Chunk.Raw"></a><a id="1697" href="Text.Format.Generic.html#1697" class="InductiveConstructor">Raw</a> <a id="1701" class="Symbol">:</a> <a id="1703" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="1710" class="Symbol">→</a> <a id="1712" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a>

  <a id="Format.Format"></a><a id="1721" href="Text.Format.Generic.html#1721" class="Function">Format</a> <a id="1728" class="Symbol">:</a> <a id="1730" href="Agda.Primitive.html#326" class="Primitive">Set</a>
  <a id="1736" href="Text.Format.Generic.html#1721" class="Function">Format</a> <a id="1743" class="Symbol">=</a> <a id="1745" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1750" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a>

  <a id="1759" class="Comment">------------------------------------------------------------------------</a>
  <a id="1834" class="Comment">-- Semantics</a>

  <a id="Format.size"></a><a id="1850" href="Text.Format.Generic.html#1850" class="Function">size</a> <a id="1855" class="Symbol">:</a> <a id="1857" href="Text.Format.Generic.html#1721" class="Function">Format</a> <a id="1864" class="Symbol">→</a> <a id="1866" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="1870" href="Text.Format.Generic.html#1850" class="Function">size</a> <a id="1875" class="Symbol">=</a> <a id="1877" href="Data.List.Base.html#4497" class="Function">List.sum</a> <a id="1886" href="Function.Base.html#3706" class="Function Operator">∘′</a> <a id="1889" href="Data.List.Base.html#1497" class="Function">List.map</a> <a id="1898" class="Symbol">λ</a> <a id="1900" class="Symbol">{</a> <a id="1902" class="Symbol">(</a><a id="1903" href="Text.Format.Generic.html#1697" class="InductiveConstructor">Raw</a> <a id="1907" class="Symbol">_)</a> <a id="1910" class="Symbol">→</a> <a id="1912" class="Number">0</a><a id="1913" class="Symbol">;</a> <a id="1915" class="CatchallClause Symbol">_</a> <a id="1917" class="Symbol">→</a> <a id="1919" class="Number">1</a> <a id="1921" class="Symbol">}</a>

  <a id="1926" class="Comment">-- Meaning of a format as a list of value types</a>

  <a id="Format.⟦_⟧"></a><a id="1977" href="Text.Format.Generic.html#1977" class="Function Operator">⟦_⟧</a> <a id="1981" class="Symbol">:</a> <a id="1983" class="Symbol">(</a><a id="1984" href="Text.Format.Generic.html#1984" class="Bound">fmt</a> <a id="1988" class="Symbol">:</a> <a id="1990" href="Text.Format.Generic.html#1721" class="Function">Format</a><a id="1996" class="Symbol">)</a> <a id="1998" class="Symbol">→</a> <a id="2000" href="Function.Nary.NonDependent.Base.html#2325" class="Function">Sets</a> <a id="2005" class="Symbol">(</a><a id="2006" href="Text.Format.Generic.html#1850" class="Function">size</a> <a id="2011" href="Text.Format.Generic.html#1984" class="Bound">fmt</a><a id="2014" class="Symbol">)</a> <a id="2016" href="Function.Nary.NonDependent.html#1531" class="Function">0ℓs</a>
  <a id="2022" href="Text.Format.Generic.html#1977" class="Function Operator">⟦</a> <a id="2024" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>          <a id="2036" href="Text.Format.Generic.html#1977" class="Function Operator">⟧</a> <a id="2038" class="Symbol">=</a> <a id="2040" class="Symbol">_</a>
  <a id="2044" href="Text.Format.Generic.html#1977" class="Function Operator">⟦</a> <a id="2046" href="Text.Format.Generic.html#1670" class="InductiveConstructor">Arg</a> <a id="2050" href="Text.Format.Generic.html#2050" class="Bound">a</a>  <a id="2053" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2055" href="Text.Format.Generic.html#2055" class="Bound">cs</a> <a id="2058" href="Text.Format.Generic.html#1977" class="Function Operator">⟧</a> <a id="2060" class="Symbol">=</a> <a id="2062" href="Text.Format.Generic.html#985" class="Field">ArgType</a> <a id="2070" href="Text.Format.Generic.html#2050" class="Bound">a</a> <a id="2072" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2074" href="Text.Format.Generic.html#1977" class="Function Operator">⟦</a> <a id="2076" href="Text.Format.Generic.html#2055" class="Bound">cs</a> <a id="2079" href="Text.Format.Generic.html#1977" class="Function Operator">⟧</a>
  <a id="2083" href="Text.Format.Generic.html#1977" class="Function Operator">⟦</a> <a id="2085" href="Text.Format.Generic.html#1697" class="InductiveConstructor">Raw</a> <a id="2089" class="Symbol">_</a>  <a id="2092" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2094" href="Text.Format.Generic.html#2094" class="Bound">cs</a> <a id="2097" href="Text.Format.Generic.html#1977" class="Function Operator">⟧</a> <a id="2099" class="Symbol">=</a>             <a id="2113" href="Text.Format.Generic.html#1977" class="Function Operator">⟦</a> <a id="2115" href="Text.Format.Generic.html#2094" class="Bound">cs</a> <a id="2118" href="Text.Format.Generic.html#1977" class="Function Operator">⟧</a>

  <a id="2123" class="Comment">------------------------------------------------------------------------</a>
  <a id="2198" class="Comment">-- Lexer: from Strings to Formats</a>

  <a id="2235" class="Comment">-- Lexing may fail. To have a useful error message, we defined the following</a>
  <a id="2314" class="Comment">-- enumerated type</a>

  <a id="2336" class="Keyword">data</a> <a id="Format.Error"></a><a id="2341" href="Text.Format.Generic.html#2341" class="Datatype">Error</a> <a id="2347" class="Symbol">:</a> <a id="2349" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2353" class="Keyword">where</a>
    <a id="Format.Error.UnexpectedEndOfString"></a><a id="2363" href="Text.Format.Generic.html#2363" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="2385" class="Symbol">:</a> <a id="2387" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2394" class="Symbol">→</a> <a id="2396" href="Text.Format.Generic.html#2341" class="Datatype">Error</a>
    <a id="2406" class="Comment">-- ^ expected a type declaration; found an empty string</a>
    <a id="Format.Error.InvalidType"></a><a id="2466" href="Text.Format.Generic.html#2466" class="InductiveConstructor">InvalidType</a> <a id="2478" class="Symbol">:</a> <a id="2480" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2487" class="Symbol">→</a> <a id="2489" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="2494" class="Symbol">→</a> <a id="2496" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2503" class="Symbol">→</a> <a id="2505" href="Text.Format.Generic.html#2341" class="Datatype">Error</a>
    <a id="2515" class="Comment">-- ^ invalid type declaration</a>
    <a id="2549" class="Comment">--   return a focus: prefix processed, character causing failure, rest</a>

  <a id="Format.lexer"></a><a id="2623" href="Text.Format.Generic.html#2623" class="Function">lexer</a> <a id="2629" class="Symbol">:</a> <a id="2631" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="2638" class="Symbol">→</a> <a id="2640" href="Text.Format.Generic.html#2341" class="Datatype">Error</a> <a id="2646" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="2648" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2653" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a>
  <a id="2661" href="Text.Format.Generic.html#2623" class="Function">lexer</a> <a id="2667" href="Text.Format.Generic.html#2667" class="Bound">input</a> <a id="2673" class="Symbol">=</a> <a id="2675" href="Text.Format.Generic.html#3218" class="Function">loop</a> <a id="2680" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="2683" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="2686" class="Symbol">(</a><a id="2687" href="Data.String.Base.html#1513" class="Primitive">toList</a> <a id="2694" href="Text.Format.Generic.html#2667" class="Bound">input</a><a id="2699" class="Symbol">)</a> <a id="2701" class="Keyword">where</a>

    <a id="2712" class="Keyword">open</a> <a id="2717" href="Category.Applicative.html#602" class="Module">RawApplicative</a> <a id="2732" class="Symbol">(</a><a id="2733" href="Data.Sum.Categorical.Left.html#950" class="Function">Sumₗ.applicative</a> <a id="2750" href="Text.Format.Generic.html#2341" class="Datatype">Error</a> <a id="2756" href="Level.html#512" class="Function">0ℓ</a><a id="2758" class="Symbol">)</a>

    <a id="2765" class="Comment">-- Type synonyms used locally to document the code</a>
    <a id="2820" href="Text.Format.Generic.html#2820" class="Function">RevWord</a> <a id="2828" class="Symbol">=</a> <a id="2830" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2835" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="2840" class="Comment">-- Mere characters accumulated so far</a>
    <a id="2882" href="Text.Format.Generic.html#2882" class="Function">Prefix</a>  <a id="2890" class="Symbol">=</a> <a id="2892" href="Text.Format.Generic.html#2820" class="Function">RevWord</a>   <a id="2902" class="Comment">-- Prefix of the input String already read</a>

    <a id="2950" href="Text.Format.Generic.html#2950" class="Function">toRevString</a> <a id="2962" class="Symbol">:</a> <a id="2964" href="Text.Format.Generic.html#2820" class="Function">RevWord</a> <a id="2972" class="Symbol">→</a> <a id="2974" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
    <a id="2985" href="Text.Format.Generic.html#2950" class="Function">toRevString</a> <a id="2997" class="Symbol">=</a> <a id="2999" href="Data.String.Base.html#1546" class="Primitive">fromList</a> <a id="3008" href="Function.Base.html#3706" class="Function Operator">∘′</a> <a id="3011" href="Data.List.Base.html#9441" class="Function">reverse</a>

    <a id="3024" class="Comment">-- Push a Raw token if we have accumulated some mere characters</a>
    <a id="3092" href="Text.Format.Generic.html#3092" class="Function">push</a> <a id="3097" class="Symbol">:</a> <a id="3099" href="Text.Format.Generic.html#2820" class="Function">RevWord</a> <a id="3107" class="Symbol">→</a> <a id="3109" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3114" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a> <a id="3120" class="Symbol">→</a> <a id="3122" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3127" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a>
    <a id="3137" href="Text.Format.Generic.html#3092" class="Function">push</a> <a id="3142" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3145" href="Text.Format.Generic.html#3145" class="Bound">ks</a> <a id="3148" class="Symbol">=</a> <a id="3150" href="Text.Format.Generic.html#3145" class="Bound">ks</a>
    <a id="3157" href="Text.Format.Generic.html#3092" class="CatchallClause Function">push</a><a id="3161" class="CatchallClause"> </a><a id="3162" href="Text.Format.Generic.html#3162" class="CatchallClause Bound">cs</a><a id="3164" class="CatchallClause"> </a><a id="3165" href="Text.Format.Generic.html#3165" class="CatchallClause Bound">ks</a> <a id="3168" class="Symbol">=</a> <a id="3170" href="Text.Format.Generic.html#1697" class="InductiveConstructor">Raw</a> <a id="3174" class="Symbol">(</a><a id="3175" href="Text.Format.Generic.html#2950" class="Function">toRevString</a> <a id="3187" href="Text.Format.Generic.html#3162" class="Bound">cs</a><a id="3189" class="Symbol">)</a> <a id="3191" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3193" href="Text.Format.Generic.html#3165" class="Bound">ks</a>

    <a id="3201" class="Comment">-- Main loop</a>
    <a id="3218" href="Text.Format.Generic.html#3218" class="Function">loop</a> <a id="3223" class="Symbol">:</a> <a id="3225" href="Text.Format.Generic.html#2820" class="Function">RevWord</a> <a id="3233" class="Symbol">→</a> <a id="3235" href="Text.Format.Generic.html#2882" class="Function">Prefix</a> <a id="3242" class="Symbol">→</a> <a id="3244" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3249" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3254" class="Symbol">→</a> <a id="3256" href="Text.Format.Generic.html#2341" class="Datatype">Error</a> <a id="3262" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="3264" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3269" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a>
    <a id="3279" href="Text.Format.Generic.html#3279" class="Function">type</a> <a id="3284" class="Symbol">:</a>           <a id="3296" href="Text.Format.Generic.html#2882" class="Function">Prefix</a> <a id="3303" class="Symbol">→</a> <a id="3305" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3310" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3315" class="Symbol">→</a> <a id="3317" href="Text.Format.Generic.html#2341" class="Datatype">Error</a> <a id="3323" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="3325" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3330" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a>

    <a id="3341" href="Text.Format.Generic.html#3218" class="Function">loop</a> <a id="3346" href="Text.Format.Generic.html#3346" class="Bound">acc</a> <a id="3350" href="Text.Format.Generic.html#3350" class="Bound">bef</a> <a id="3354" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>               <a id="3371" class="Symbol">=</a> <a id="3373" href="Category.Applicative.Indexed.html#1003" class="Function">pure</a> <a id="3378" class="Symbol">(</a><a id="3379" href="Text.Format.Generic.html#3092" class="Function">push</a> <a id="3384" href="Text.Format.Generic.html#3346" class="Bound">acc</a> <a id="3388" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="3390" class="Symbol">)</a>
    <a id="3396" class="Comment">-- escaped &#39;%&#39; character: treat like a mere character</a>
    <a id="3454" href="Text.Format.Generic.html#3218" class="Function">loop</a> <a id="3459" href="Text.Format.Generic.html#3459" class="Bound">acc</a> <a id="3463" href="Text.Format.Generic.html#3463" class="Bound">bef</a> <a id="3467" class="Symbol">(</a><a id="3468" class="String">&#39;%&#39;</a> <a id="3472" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3474" class="String">&#39;%&#39;</a> <a id="3478" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3480" href="Text.Format.Generic.html#3480" class="Bound">cs</a><a id="3482" class="Symbol">)</a> <a id="3484" class="Symbol">=</a> <a id="3486" href="Text.Format.Generic.html#3218" class="Function">loop</a> <a id="3491" class="Symbol">(</a><a id="3492" class="String">&#39;%&#39;</a> <a id="3496" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3498" href="Text.Format.Generic.html#3459" class="Bound">acc</a><a id="3501" class="Symbol">)</a> <a id="3503" class="Symbol">(</a><a id="3504" class="String">&#39;%&#39;</a> <a id="3508" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3510" class="String">&#39;%&#39;</a> <a id="3514" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3516" href="Text.Format.Generic.html#3463" class="Bound">bef</a><a id="3519" class="Symbol">)</a> <a id="3521" href="Text.Format.Generic.html#3480" class="Bound">cs</a>
    <a id="3528" class="Comment">-- non escaped &#39;%&#39;: type declaration following</a>
    <a id="3579" href="Text.Format.Generic.html#3218" class="CatchallClause Function">loop</a><a id="3583" class="CatchallClause"> </a><a id="3584" href="Text.Format.Generic.html#3584" class="CatchallClause Bound">acc</a><a id="3587" class="CatchallClause"> </a><a id="3588" href="Text.Format.Generic.html#3588" class="CatchallClause Bound">bef</a><a id="3591" class="CatchallClause"> </a><a id="3592" class="CatchallClause Symbol">(</a><a id="3593" class="CatchallClause String">&#39;%&#39;</a><a id="3596" class="CatchallClause"> </a><a id="3597" href="Agda.Builtin.List.html#200" class="CatchallClause InductiveConstructor Operator">∷</a><a id="3598" class="CatchallClause"> </a><a id="3599" href="Text.Format.Generic.html#3599" class="CatchallClause Bound">cs</a><a id="3601" class="CatchallClause Symbol">)</a>       <a id="3609" class="Symbol">=</a> <a id="3611" href="Text.Format.Generic.html#3092" class="Function">push</a> <a id="3616" href="Text.Format.Generic.html#3584" class="Bound">acc</a> <a id="3620" href="Category.Functor.html#608" class="Function Operator">&lt;$&gt;</a> <a id="3624" href="Text.Format.Generic.html#3279" class="Function">type</a> <a id="3629" class="Symbol">(</a><a id="3630" class="String">&#39;%&#39;</a> <a id="3634" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3636" href="Text.Format.Generic.html#3588" class="Bound">bef</a><a id="3639" class="Symbol">)</a> <a id="3641" href="Text.Format.Generic.html#3599" class="Bound">cs</a>
    <a id="3648" class="Comment">-- mere character: push onto the accumulator</a>
    <a id="3697" href="Text.Format.Generic.html#3218" class="Function">loop</a> <a id="3702" href="Text.Format.Generic.html#3702" class="Bound">acc</a> <a id="3706" href="Text.Format.Generic.html#3706" class="Bound">bef</a> <a id="3710" class="Symbol">(</a><a id="3711" href="Text.Format.Generic.html#3711" class="Bound">c</a> <a id="3713" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3715" href="Text.Format.Generic.html#3715" class="Bound">cs</a><a id="3717" class="Symbol">)</a>         <a id="3727" class="Symbol">=</a> <a id="3729" href="Text.Format.Generic.html#3218" class="Function">loop</a> <a id="3734" class="Symbol">(</a><a id="3735" href="Text.Format.Generic.html#3711" class="Bound">c</a> <a id="3737" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3739" href="Text.Format.Generic.html#3702" class="Bound">acc</a><a id="3742" class="Symbol">)</a> <a id="3744" class="Symbol">(</a><a id="3745" href="Text.Format.Generic.html#3711" class="Bound">c</a> <a id="3747" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3749" href="Text.Format.Generic.html#3706" class="Bound">bef</a><a id="3752" class="Symbol">)</a> <a id="3754" href="Text.Format.Generic.html#3715" class="Bound">cs</a>

    <a id="3762" href="Text.Format.Generic.html#3279" class="Function">type</a> <a id="3767" href="Text.Format.Generic.html#3767" class="Bound">bef</a> <a id="3771" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>       <a id="3780" class="Symbol">=</a> <a id="3782" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="3787" class="Symbol">(</a><a id="3788" href="Text.Format.Generic.html#2363" class="InductiveConstructor">UnexpectedEndOfString</a> <a id="3810" href="Text.Format.Generic.html#2667" class="Bound">input</a><a id="3815" class="Symbol">)</a>
    <a id="3821" href="Text.Format.Generic.html#3279" class="Function">type</a> <a id="3826" href="Text.Format.Generic.html#3826" class="Bound">bef</a> <a id="3830" class="Symbol">(</a><a id="3831" href="Text.Format.Generic.html#3831" class="Bound">c</a> <a id="3833" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3835" href="Text.Format.Generic.html#3835" class="Bound">cs</a><a id="3837" class="Symbol">)</a> <a id="3839" class="Symbol">=</a> <a id="3841" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a> <a id="3845" href="Category.Functor.html#608" class="Function Operator">&lt;$&gt;</a> <a id="3849" href="Text.Format.Generic.html#3893" class="Function">chunk</a> <a id="3855" href="Text.Format.Generic.html#3831" class="Bound">c</a> <a id="3857" href="Category.Applicative.Indexed.html#1034" class="Function Operator">⊛</a> <a id="3859" href="Text.Format.Generic.html#3218" class="Function">loop</a> <a id="3864" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3867" class="Symbol">(</a><a id="3868" href="Text.Format.Generic.html#3831" class="Bound">c</a> <a id="3870" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3872" href="Text.Format.Generic.html#3826" class="Bound">bef</a><a id="3875" class="Symbol">)</a> <a id="3877" href="Text.Format.Generic.html#3835" class="Bound">cs</a> <a id="3880" class="Keyword">where</a>

      <a id="3893" href="Text.Format.Generic.html#3893" class="Function">chunk</a> <a id="3899" class="Symbol">:</a> <a id="3901" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="3906" class="Symbol">→</a> <a id="3908" href="Text.Format.Generic.html#2341" class="Datatype">Error</a> <a id="3914" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="3916" href="Text.Format.Generic.html#1648" class="Datatype">Chunk</a>
      <a id="3928" href="Text.Format.Generic.html#3893" class="Function">chunk</a> <a id="3934" href="Text.Format.Generic.html#3934" class="Bound">c</a> <a id="3936" class="Symbol">=</a>
        <a id="3946" href="Function.Base.html#4121" class="Function Operator">case</a> <a id="3951" href="Text.Format.Generic.html#1015" class="Field">lexArg</a> <a id="3958" href="Text.Format.Generic.html#3934" class="Bound">c</a> <a id="3960" href="Function.Base.html#4121" class="Function Operator">of</a> <a id="3963" class="Symbol">λ</a> <a id="3965" class="Keyword">where</a>
          <a id="3981" class="Symbol">(</a><a id="3982" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3987" href="Text.Format.Generic.html#3987" class="Bound">ch</a><a id="3989" class="Symbol">)</a> <a id="3991" class="Symbol">→</a> <a id="3993" href="Category.Applicative.Indexed.html#1003" class="Function">pure</a> <a id="3998" class="Symbol">(</a><a id="3999" href="Text.Format.Generic.html#1670" class="InductiveConstructor">Arg</a> <a id="4003" href="Text.Format.Generic.html#3987" class="Bound">ch</a><a id="4005" class="Symbol">)</a>
          <a id="4017" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>   <a id="4027" class="Symbol">→</a>
            <a id="4041" href="Strict.html#515" class="Function">force′</a> <a id="4048" class="Symbol">(</a><a id="4049" href="Text.Format.Generic.html#2950" class="Function">toRevString</a> <a id="4061" href="Text.Format.Generic.html#3826" class="Bound">bef</a><a id="4064" class="Symbol">)</a> <a id="4066" class="Symbol">λ</a> <a id="4068" href="Text.Format.Generic.html#4068" class="Bound">prefix</a> <a id="4075" class="Symbol">→</a>
            <a id="4089" href="Strict.html#515" class="Function">force′</a> <a id="4096" class="Symbol">(</a><a id="4097" href="Data.String.Base.html#1546" class="Primitive">fromList</a> <a id="4106" href="Text.Format.Generic.html#3835" class="Bound">cs</a><a id="4108" class="Symbol">)</a>     <a id="4114" class="Symbol">λ</a> <a id="4116" href="Text.Format.Generic.html#4116" class="Bound">suffix</a> <a id="4123" class="Symbol">→</a>
            <a id="4137" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="4142" class="Symbol">(</a><a id="4143" href="Text.Format.Generic.html#2466" class="InductiveConstructor">InvalidType</a> <a id="4155" href="Text.Format.Generic.html#4068" class="Bound">prefix</a> <a id="4162" href="Text.Format.Generic.html#3934" class="Bound">c</a> <a id="4164" href="Text.Format.Generic.html#4116" class="Bound">suffix</a><a id="4170" class="Symbol">)</a>
</pre></body></html>